"declare      @CPU_Usage_Percentage int,      @Total_SQL_Server_Memory_MB int   -- CPU WITH y AS (     SELECT               CONVERT(VARCHAR(5), 100 - ca.c.value('.', 'INT')) AS system_idle,         CONVERT(VARCHAR(30), rb.event_date) AS event_date,         CONVERT(VARCHAR(8000), rb.record) AS record     FROM (            SELECT              CONVERT(XML, dorb.record) AS record,             DATEADD(ms, ( ts.ms_ticks - dorb.timestamp ), GETDATE()) AS event_date         FROM   sys.dm_os_ring_buffers AS dorb             CROSS JOIN (                  SELECT                      dosi.ms_ticks                  FROM sys.dm_os_sys_info AS dosi ) AS ts                 WHERE   dorb.ring_buffer_type = N'RING_BUFFER_SCHEDULER_MONITOR'                         AND record LIKE '%%' ) AS rb             CROSS APPLY rb.record.nodes('/Record/SchedulerMonitorEvent/SystemHealth/SystemIdle') AS ca(c)         )     SELECT @CPU_Usage_Percentage = (select          TOP 1 y.system_idle     FROM y      ORDER BY y.event_date DESC)   -- memory select @Total_SQL_Server_Memory_MB = (select      cntr_value / 1024 from sys.dm_os_performance_counters pc where   [object_name] = 'SQLServer:Memory Manager'         and counter_name = 'Total Server Memory (KB)'                                                                                                         )   select      @CPU_Usage_Percentage           [CPU_Usage_Percentage],      @Total_SQL_Server_Memory_MB     [Total_SQL_Server_Memory_MB]; 	 WITH DB_CPU_Stats AS (SELECT pa.DatabaseID, DB_Name(pa.DatabaseID) AS [Database Name], SUM(qs.total_worker_time/1000) AS [CPU_Time_Ms]  FROM sys.dm_exec_query_stats AS qs WITH (NOLOCK)  CROSS APPLY (SELECT CONVERT(int, value) AS [DatabaseID]               FROM sys.dm_exec_plan_attributes(qs.plan_handle)               WHERE attribute = N'dbid') AS pa  GROUP BY DatabaseID) SELECT ROW_NUMBER() OVER(ORDER BY [CPU_Time_Ms] DESC) AS [CPU Rank],        [Database Name], [CPU_Time_Ms] AS [CPU Time (ms)],        CAST([CPU_Time_Ms] * 1.0 / SUM([CPU_Time_Ms]) OVER() * 100.0 AS DECIMAL(5, 2)) AS [CPU Percent] FROM DB_CPU_Stats WHERE DatabaseID <> 32767 -- ResourceDB ORDER BY [CPU Rank] OPTION (RECOMPILE);   DECLARE @total_buffer INT;  SELECT @total_buffer = cntr_value FROM sys.dm_os_performance_counters  WHERE RTRIM([object_name]) LIKE '%Buffer Manager' AND counter_name = 'Database Pages';  ;WITH src AS (   SELECT    database_id, db_buffer_pages = COUNT_BIG(*)   FROM sys.dm_os_buffer_descriptors   --WHERE database_id BETWEEN 5 AND 32766   GROUP BY database_id ) SELECT [db_name] = CASE [database_id] WHEN 32767  THEN 'Resource DB'  ELSE DB_NAME([database_id]) END, db_buffer_pages, db_buffer_MB = db_buffer_pages / 128, db_buffer_percent = CONVERT(DECIMAL(6,3),  db_buffer_pages * 100.0 / @total_buffer) FROM src ORDER BY db_buffer_MB DESC;  ",2338,2481,-143,0,0,2338
" DECLARE @total_buffer INT;  SELECT @total_buffer = cntr_value FROM sys.dm_os_performance_counters  WHERE RTRIM([object_name]) LIKE '%Buffer Manager' AND counter_name = 'Database Pages';  ;WITH src AS (   SELECT    database_id, db_buffer_pages = COUNT_BIG(*)   FROM sys.dm_os_buffer_descriptors   --WHERE database_id BETWEEN 5 AND 32766   GROUP BY database_id ) SELECT [db_name] = CASE [database_id] WHEN 32767  THEN 'Resource DB'  ELSE DB_NAME([database_id]) END, db_buffer_pages, db_buffer_MB = db_buffer_pages / 128, db_buffer_percent = CONVERT(DECIMAL(6,3),  db_buffer_pages * 100.0 / @total_buffer) FROM src ORDER BY db_buffer_MB DESC;  ",2223,2362,-139,0,0,2223
"declare      @CPU_Usage_Percentage int,      @Total_SQL_Server_Memory_MB int   -- CPU WITH y AS (     SELECT               CONVERT(VARCHAR(5), 100 - ca.c.value('.', 'INT')) AS system_idle,         CONVERT(VARCHAR(30), rb.event_date) AS event_date,         CONVERT(VARCHAR(8000), rb.record) AS record     FROM (            SELECT              CONVERT(XML, dorb.record) AS record,             DATEADD(ms, ( ts.ms_ticks - dorb.timestamp ), GETDATE()) AS event_date         FROM   sys.dm_os_ring_buffers AS dorb             CROSS JOIN (                  SELECT                      dosi.ms_ticks                  FROM sys.dm_os_sys_info AS dosi ) AS ts                 WHERE   dorb.ring_buffer_type = N'RING_BUFFER_SCHEDULER_MONITOR'                         AND record LIKE '%%' ) AS rb             CROSS APPLY rb.record.nodes('/Record/SchedulerMonitorEvent/SystemHealth/SystemIdle') AS ca(c)         )     SELECT @CPU_Usage_Percentage = (select          TOP 1 y.system_idle     FROM y      ORDER BY y.event_date DESC)   -- memory select @Total_SQL_Server_Memory_MB = (select      cntr_value / 1024 from sys.dm_os_performance_counters pc where   [object_name] = 'SQLServer:Memory Manager'         and counter_name = 'Total Server Memory (KB)'                                                                                                         )   select      @CPU_Usage_Percentage           [CPU_Usage_Percentage],      @Total_SQL_Server_Memory_MB     [Total_SQL_Server_Memory_MB]; 	 WITH DB_CPU_Stats AS (SELECT pa.DatabaseID, DB_Name(pa.DatabaseID) AS [Database Name], SUM(qs.total_worker_time/1000) AS [CPU_Time_Ms]  FROM sys.dm_exec_query_stats AS qs WITH (NOLOCK)  CROSS APPLY (SELECT CONVERT(int, value) AS [DatabaseID]               FROM sys.dm_exec_plan_attributes(qs.plan_handle)               WHERE attribute = N'dbid') AS pa  GROUP BY DatabaseID) SELECT ROW_NUMBER() OVER(ORDER BY [CPU_Time_Ms] DESC) AS [CPU Rank],        [Database Name], [CPU_Time_Ms] AS [CPU Time (ms)],        CAST([CPU_Time_Ms] * 1.0 / SUM([CPU_Time_Ms]) OVER() * 100.0 AS DECIMAL(5, 2)) AS [CPU Percent] FROM DB_CPU_Stats WHERE DatabaseID <> 32767 -- ResourceDB ORDER BY [CPU Rank] OPTION (RECOMPILE);   DECLARE @total_buffer INT;  SELECT @total_buffer = cntr_value FROM sys.dm_os_performance_counters  WHERE RTRIM([object_name]) LIKE '%Buffer Manager' AND counter_name = 'Database Pages';  ;WITH src AS (   SELECT    database_id, db_buffer_pages = COUNT_BIG(*)   FROM sys.dm_os_buffer_descriptors   --WHERE database_id BETWEEN 5 AND 32766   GROUP BY database_id ) SELECT [db_name] = CASE [database_id] WHEN 32767  THEN 'Resource DB'  ELSE DB_NAME([database_id]) END, db_buffer_pages, db_buffer_MB = db_buffer_pages / 128, db_buffer_percent = CONVERT(DECIMAL(6,3),  db_buffer_pages * 100.0 / @total_buffer) FROM src ORDER BY db_buffer_MB DESC;  ",1157,1156,1,0,0,2314
" DECLARE @total_buffer INT;  SELECT @total_buffer = cntr_value FROM sys.dm_os_performance_counters  WHERE RTRIM([object_name]) LIKE '%Buffer Manager' AND counter_name = 'Database Pages';  ;WITH src AS (   SELECT    database_id, db_buffer_pages = COUNT_BIG(*)   FROM sys.dm_os_buffer_descriptors   --WHERE database_id BETWEEN 5 AND 32766   GROUP BY database_id ) SELECT [db_name] = CASE [database_id] WHEN 32767  THEN 'Resource DB'  ELSE DB_NAME([database_id]) END, db_buffer_pages, db_buffer_MB = db_buffer_pages / 128, db_buffer_percent = CONVERT(DECIMAL(6,3),  db_buffer_pages * 100.0 / @total_buffer) FROM src ORDER BY db_buffer_MB DESC;  ",1126,1126,0,0,0,2252
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSOD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSOD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSOD\StakeSOD_backup_2024_03_21_120001_7989744.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSOD_backup_2024_03_21_120001_7989744', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",1117,143,974,148,0,1117
"declare @Path nvarchar(255) declare @Name nvarchar(255)   select @Path = N'G:\Backup_SQL\STAKEHD\Transaction'   select @Name = null;           create table #filetmpfin (Name nvarchar(255) NOT NULL, IsFile bit NULL, FullName nvarchar(300) not NULL)         declare @FullName nvarchar(300)         declare @UseLegacyXPs bit = 1          if exists (select 1 from sys.all_objects where name = 'dm_os_enumerate_filesystem' and type = 'IF' and is_ms_shipped = 1)            select @UseLegacyXPs = IIF((LOWER(@Name) = N'nul') AND (exists (select 1 from sys.dm_os_host_info where host_platform = 'Windows')), 1, 0)          if @UseLegacyXPs = 0         begin            if (@Name is null)           begin                insert #filetmpfin select file_or_directory_name, 1 - is_directory, full_filesystem_path from sys.dm_os_enumerate_filesystem(@Path, '*') where [level] = 0           end            if (NOT @Name is null)           begin              if(@Path is null)                select @FullName = @Name             else               select @FullName = @Path 	+ convert(nvarchar(1), serverproperty('PathSeparator')) + @Name              create table #filetmp3 ( Exist bit NOT NULL, IsDir bit NOT NULL, DirExist bit NULL )              insert #filetmp3 select file_exists, file_is_a_directory, parent_directory_exists from sys.dm_os_file_exists(@FullName)              insert #filetmpfin select @Name, 1-IsDir, @FullName from #filetmp3 where Exist = 1 or IsDir = 1              drop table #filetmp3            end         end         else         begin           if(@Name is null)           begin             if (right(@Path, 1) = '\')               select @Path= substring(@Path, 1, len(@Path) - charindex('\', reverse(@Path)))             create table #filetmp (Name nvarchar(255) NOT NULL, depth int NOT NULL, IsFile bit NULL )             insert #filetmp EXECUTE master.dbo.xp_dirtree @Path, 1, 1             insert #filetmpfin select Name, IsFile, @Path + '\' + Name from #filetmp f             drop table #filetmp           end            if(NOT @Name is null)           begin             if(@Path is null)               select @FullName = @Name             else               select @FullName = @Path +  '\' + @Name             if (right(@FullName, 1) = '\')               select @Path= substring(@Path, 1, len(@FullName) - charindex('\', reverse(@FullName)))             create table #filetmp2 ( Exist bit NOT NULL, IsDir bit NOT NULL, DirExist bit NULL )             insert #filetmp2 EXECUTE master.dbo.xp_fileexist @FullName             insert #filetmpfin select @Name, 1-IsDir, @FullName from #filetmp2 where Exist = 1 or IsDir = 1              drop table #filetmp2           end          end           SELECT Name AS [Name], IsFile AS [IsFile], FullName AS [FullName] FROM #filetmpfin ORDER BY [IsFile] ASC,[Name] ASC drop table #filetmpfin ",815,257,558,21419,264,1631
"()                 begin try                 declare @enable int;                 select top 1 @enable = convert(int,value_in_use) from sys.configurations where name = 'default trace enabled'                 if @enable = 1 --default trace is enabled                 begin                 declare @curr_tracefilename varchar(500);                 declare @base_tracefilename varchar(500);                 declare @indx int ;                 declare @temp_trace table (                 StartTime datetime                 ,       EventSubClass int                 ,       IntegerData int                 );                 declare @path_separator CHAR(1) ;                 set @path_separator = ISNULL(CONVERT(CHAR(1), serverproperty('PathSeparator')), '\') ;                  select @curr_tracefilename = path from sys.traces where is_default = 1 ;                 set @curr_tracefilename = reverse(@curr_tracefilename)                 select @indx  = PATINDEX('%'+@path_separator+'%', @curr_tracefilename)                 set @curr_tracefilename = reverse(@curr_tracefilename)                 set @base_tracefilename = LEFT( @curr_tracefilename, len(@curr_tracefilename) - @indx) + @path_separator + 'log.trc';                  insert into @temp_trace                 select StartTime                 ,       EventSubClass                 ,       IntegerData                 from ::fn_trace_gettable( @base_tracefilename, default )                 where EventClass = 81;                  update @temp_trace set IntegerData = -IntegerData where EventSubClass = 2;                  select   1 as row_no                 ,       StartTime                 ,       EventSubClass                 ,       IntegerData                 ,       case when IntegerData < 0                 then -IntegerData                 else IntegerData                 end ""Absolute""                 from @temp_trace                 where (datediff(dd,StartTime,getdate()) < 7) order by StartTime ;                 end                 else                 begin                 select top 0 1 as row_no, 1 as StartTime , 1 as EventSubClass, 1 as IntegerData, 1 as Absolute                 end                 end try                 begin catch                 select  -100 as row_no                 ,       ERROR_NUMBER()  as StartTime                 ,       ERROR_SEVERITY() as EventSubClass                 ,       ERROR_STATE()  as   IntegerData                 ,       ERROR_MESSAGE() as Absolute                 end catch               ",713,712,1,0,0,2140
"       SELECT       db_id() AS database_id,       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.is_filestream,       c.encryption_type,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END AS is_user,       COUNT_BIG(*) AS [ColCount],       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END AS collation_name,       AVG(c.max_length) AS avg_max_length       FROM sys.columns c WITH (NOLOCK)       LEFT OUTER JOIN sys.objects o WITH (NOLOCK)       ON o.object_id = c.object_id       AND o.type = 'U'       GROUP BY       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.encryption_type,       c.is_filestream,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END,       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END     ",430,251,179,231,0,28419
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_02_110005_2894483.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_02_110005_2894483', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",392,202,190,236,0,392
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSOD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSOD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSOD\StakeSOD_backup_2024_04_02_110005_4272273.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSOD_backup_2024_04_02_110005_4272273', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",385,132,253,151,0,385
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP DATABASE [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Full\StakeSTO_DEV\StakeSTO_DEV_backup_2024_04_09_230002_0122877.bak' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_04_09_230002_0122877', SKIP, REWIND, NOUNLOAD,  STATS = 10 END ",301,106,195,148,0,301
"       SELECT       db_id() AS database_id,       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.is_filestream,       c.encryption_type,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END AS is_user,       COUNT_BIG(*) AS [ColCount],       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END AS collation_name,       AVG(c.max_length) AS avg_max_length       FROM sys.columns c WITH (NOLOCK)       LEFT OUTER JOIN sys.objects o WITH (NOLOCK)       ON o.object_id = c.object_id       AND o.type = 'U'       GROUP BY       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.encryption_type,       c.is_filestream,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END,       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END     ",279,162,117,188,0,18418
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO\StakeSTO_backup_2024_04_07_180001_8104108.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_backup_2024_04_07_180001_8104108', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",272,135,137,148,0,272
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('Svdms'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [Svdms] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\Svdms\Svdms_backup_2024_04_22_230001_7288246.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'Svdms_backup_2024_04_22_230001_7288246', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",270,127,143,151,0,270
"(@_msparam_0 nvarchar(4000))       select * into #tmpag_availability_groups from master.sys.availability_groups        SELECT AG.name AS [Name] FROM #tmpag_availability_groups AS AG WHERE (AG.name=@_msparam_0)        drop table #tmpag_availability_groups      ",258,8,250,174,0,1035
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSOD'))  IF (@preferredReplica = 1) BEGIN     BACKUP DATABASE [StakeSOD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Full\StakeSOD\StakeSOD_backup_2024_04_15_230002_3961583.bak' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSOD_backup_2024_04_15_230002_3961583', SKIP, REWIND, NOUNLOAD,  STATS = 10 END ",249,80,169,151,0,249
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_01_140001_3896972.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_01_140001_3896972', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",231,100,131,236,0,231
"       SELECT       db_id() AS database_id,       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.is_filestream,       c.encryption_type,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END AS is_user,       COUNT_BIG(*) AS [ColCount],       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END AS collation_name,       AVG(c.max_length) AS avg_max_length       FROM sys.columns c WITH (NOLOCK)       LEFT OUTER JOIN sys.objects o WITH (NOLOCK)       ON o.object_id = c.object_id       AND o.type = 'U'       GROUP BY       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.encryption_type,       c.is_filestream,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END,       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END     ",221,130,91,176,0,14590
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_04_16_230002_1799840.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_04_16_230002_1799840', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",220,82,138,148,0,220
"       SELECT       db_id() AS database_id,       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.is_filestream,       c.encryption_type,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END AS is_user,       COUNT_BIG(*) AS [ColCount],       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END AS collation_name,       AVG(c.max_length) AS avg_max_length       FROM sys.columns c WITH (NOLOCK)       LEFT OUTER JOIN sys.objects o WITH (NOLOCK)       ON o.object_id = c.object_id       AND o.type = 'U'       GROUP BY       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.encryption_type,       c.is_filestream,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END,       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END     ",220,128,92,177,0,14526
"       SELECT       db_id() AS database_id,       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.is_filestream,       c.encryption_type,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END AS is_user,       COUNT_BIG(*) AS [ColCount],       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END AS collation_name,       AVG(c.max_length) AS avg_max_length       FROM sys.columns c WITH (NOLOCK)       LEFT OUTER JOIN sys.objects o WITH (NOLOCK)       ON o.object_id = c.object_id       AND o.type = 'U'       GROUP BY       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.encryption_type,       c.is_filestream,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END,       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END     ",215,125,90,176,0,14208
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('Svdms'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [Svdms] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\Svdms\Svdms_backup_2024_03_25_230001_2102624.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'Svdms_backup_2024_03_25_230001_2102624', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",208,105,103,151,0,208
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_03_21_120001_6651894.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_03_21_120001_6651894', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",206,124,82,148,0,206
"       SELECT       db_id() AS database_id,       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.is_filestream,       c.encryption_type,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END AS is_user,       COUNT_BIG(*) AS [ColCount],       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END AS collation_name,       AVG(c.max_length) AS avg_max_length       FROM sys.columns c WITH (NOLOCK)       LEFT OUTER JOIN sys.objects o WITH (NOLOCK)       ON o.object_id = c.object_id       AND o.type = 'U'       GROUP BY       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.encryption_type,       c.is_filestream,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END,       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END     ",201,120,81,176,0,13287
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_03_30_170001_8171953.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_03_30_170001_8171953', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",200,78,122,151,0,200
"SELECT     DB_NAME (database_id) as [Database Name],     name as [Database File Name],     [Type] = CASE WHEN Type_Desc = 'ROWS' THEN 'Data File(s)'             WHEN Type_Desc = 'LOG'  THEN 'Log File(s)'             ELSE Type_Desc END,     size*8/1024 as 'Size (MB)',     physical_name as [Database_File_Location] FROM sys.master_files ORDER BY 1,3  IF OBJECT_ID('tempdb.dbo.#space') IS NOT NULL     DROP TABLE #space  CREATE TABLE #space (       database_id INT PRIMARY KEY     , data_used_size DECIMAL(18,2)     , log_used_size DECIMAL(18,2) )  DECLARE @SQL NVARCHAR(MAX)  SELECT @SQL = STUFF((     SELECT '     USE [' + d.name + ']     INSERT INTO #space (database_id, data_used_size, log_used_size)     SELECT           DB_ID()         , SUM(CASE WHEN [type] = 0 THEN space_used END)         , SUM(CASE WHEN [type] = 1 THEN space_used END)     FROM (         SELECT s.[type], space_used = SUM(FILEPROPERTY(s.name, ''SpaceUsed'') * 8. / 1024)         FROM sys.database_files s         GROUP BY s.[type]     ) t;'     FROM sys.databases d     WHERE d.[state] = 0     FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')  EXEC sys.sp_executesql @SQL  SELECT       d.database_id     , d.name     , d.state_desc     , d.recovery_model_desc     , t.total_size     , t.data_size     , s.data_used_size     , t.log_size     , s.log_used_size     , bu.full_last_date     , bu.full_size     , bu.log_last_date     , bu.log_size FROM (     SELECT           database_id         , log_size = CAST(SUM(CASE WHEN [type] = 1 THEN size END) * 8. / 1024 AS DECIMAL(18,2))         , data_size = CAST(SUM(CASE WHEN [type] = 0 THEN size END) * 8. / 1024 AS DECIMAL(18,2))         , total_size = CAST(SUM(size) * 8. / 1024 AS DECIMAL(18,2))     FROM sys.master_files     GROUP BY database_id ) t JOIN sys.databases d ON d.database_id = t.database_id LEFT JOIN #space s ON d.database_id = s.database_id LEFT JOIN (     SELECT           database_name         , full_last_date = MAX(CASE WHEN [type] = 'D' THEN backup_finish_date END)         , full_size = MAX(CASE WHEN [type] = 'D' THEN backup_size END)         , log_last_date = MAX(CASE WHEN [type] = 'L' THEN backup_finish_date END)         , log_size = MAX(CASE WHEN [type] = 'L' THEN backup_size END)     FROM (         SELECT               s.database_name             , s.[type]             , s.backup_finish_date             , backup_size =                         CAST(CASE WHEN s.backup_size = s.compressed_backup_size                                     THEN s.backup_size                                     ELSE s.compressed_backup_size                         END / 1048576.0 AS DECIMAL(18,2))             , RowNum = ROW_NUMBER() OVER (PARTITION BY s.database_name, s.[type] ORDER BY s.backup_finish_date DESC)         FROM msdb.dbo.backupset s         WHERE s.[type] IN ('D', 'L')     ) f     WHERE f.RowNum = 1     GROUP BY f.database_name ) bu ON d.name = bu.database_name ORDER BY t.total_size DESC  SELECT      req.session_id     , req.total_elapsed_time AS duration_ms     , req.cpu_time AS cpu_time_ms     , req.total_elapsed_time - req.cpu_time AS wait_time     , req.logical_reads     , SUBSTRING (REPLACE (REPLACE (SUBSTRING (ST.text, (req.statement_start_offset/2) + 1,         ((CASE statement_end_offset            WHEN -1            THEN DATALENGTH(ST.text)              ELSE req.statement_end_offset          END - req.statement_start_offset)/2) + 1) , CHAR(10), ' '), CHAR(13), ' '),        1, 512)  AS statement_text   FROM sys.dm_exec_requests AS req     CROSS APPLY sys.dm_exec_sql_text(req.sql_handle) AS ST ORDER BY total_elapsed_time DESC;  SELECT top 100 t.text,      (qs.total_elapsed_time/1000) / qs.execution_count AS avg_elapsed_time,      (qs.total_worker_time/1000) / qs.execution_count AS avg_cpu_time,      ((qs.total_elapsed_time/1000) / qs.execution_count ) - ((qs.total_worker_time/1000) / qs.execution_count) AS avg_wait_time,      qs.total_logical_reads / qs.execution_count AS avg_logical_reads,      qs.total_logical_writes / qs.execution_count AS avg_writes,      (qs.total_elapsed_time/1000) AS cumulative_elapsed_time_all_executions FROM sys.dm_exec_query_stats qs      CROSS apply sys.Dm_exec_sql_text (sql_handle) t -- WHERE t.text like '<Your Query>%' -- Replace <Your Query> with your query or the beginning part of your query. The special chars like '[','_','%','^' in the query should be escaped. ORDER BY (qs.total_elapsed_time / qs.execution_count) DESC  --Deadlock sql check SELECT     session_id,     start_time,      [status],     command,     blocking_session_id,     wait_type,     wait_time,     open_transaction_count,     transaction_id,     total_elapsed_time,     Definition = CAST(text AS VARCHAR(MAX)) FROM     SYS.DM_EXEC_REQUESTS     CROSS APPLY sys.dm_exec_sql_text(sql_handle)  WHERE blocking_session_id != 0  SELECT sqlserver_start_time, (committed_kb/1024) AS Total_Server_Memory_MB, (committed_target_kb/1024)  AS Target_Server_Memory_MB FROM sys.dm_os_sys_info; ",194,96,98,58293,1902,389
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO\StakeSTO_backup_2024_04_19_230002_2063342.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_backup_2024_04_19_230002_2063342', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",190,80,110,151,0,190
"       SELECT       db_id() AS database_id,       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.is_filestream,       c.encryption_type,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END AS is_user,       COUNT_BIG(*) AS [ColCount],       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END AS collation_name,       AVG(c.max_length) AS avg_max_length       FROM sys.columns c WITH (NOLOCK)       LEFT OUTER JOIN sys.objects o WITH (NOLOCK)       ON o.object_id = c.object_id       AND o.type = 'U'       GROUP BY       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.encryption_type,       c.is_filestream,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END,       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END     ",189,112,77,154,0,12493
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_04_05_230001_4081277.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_04_05_230001_4081277', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",184,62,122,148,0,184
"       SELECT       db_id() AS database_id,       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.is_filestream,       c.encryption_type,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END AS is_user,       COUNT_BIG(*) AS [ColCount],       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END AS collation_name,       AVG(c.max_length) AS avg_max_length       FROM sys.columns c WITH (NOLOCK)       LEFT OUTER JOIN sys.objects o WITH (NOLOCK)       ON o.object_id = c.object_id       AND o.type = 'U'       GROUP BY       c.system_type_id,       c.user_type_id,       c.is_sparse,       c.is_column_set,       c.encryption_type,       c.is_filestream,       CASE WHEN o.object_id IS NOT NULL THEN 1 ELSE 0 END,       CASE WHEN c.collation_name IS NULL THEN CONVERT(VARCHAR(128), SERVERPROPERTY('Collation')) ELSE c.collation_name END     ",184,107,77,170,0,12153
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('Svdms'))  IF (@preferredReplica = 1) BEGIN     BACKUP DATABASE [Svdms] TO  DISK = N'G:\Backup_SQL\STAKEHD\Full\Svdms\Svdms_backup_2024_04_22_230001_7707566.bak' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'Svdms_backup_2024_04_22_230001_7707566', SKIP, REWIND, NOUNLOAD,  STATS = 10 END ",178,86,92,148,0,178
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_17_230002_2250132.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_17_230002_2250132', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",178,98,80,272,0,178
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSOD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSOD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSOD\StakeSOD_backup_2024_03_21_230001_7477994.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSOD_backup_2024_03_21_230001_7477994', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",175,85,90,151,0,175
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_04_12_230001_6696698.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_04_12_230001_6696698', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",164,71,93,148,0,164
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_03_31_230001_5359117.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_03_31_230001_5359117', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",163,83,80,151,0,163
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_03_27_230001_7424771.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_03_27_230001_7424771', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",161,66,95,151,0,161
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO\StakeSTO_backup_2024_03_29_230001_7983135.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_backup_2024_03_29_230001_7983135', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",157,70,87,151,0,157
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('Svdms'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [Svdms] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\Svdms\Svdms_backup_2024_04_07_180001_8343724.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'Svdms_backup_2024_04_07_180001_8343724', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",157,58,99,148,0,157
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_03_23_230001_5991559.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_03_23_230001_5991559', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",156,78,78,151,0,156
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_03_20_230001_8917132.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_03_20_230001_8917132', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",155,105,50,148,0,155
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_03_23_230001_7519074.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_03_23_230001_7519074', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",153,56,97,148,0,153
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO_DEV\StakeSTO_DEV_backup_2024_04_10_230002_1908162.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_04_10_230002_1908162', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",153,66,87,151,0,153
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_03_28_100001_6034423.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_03_28_100001_6034423', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",152,90,62,151,0,152
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO_DEV\StakeSTO_DEV_backup_2024_04_09_230001_9344125.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_04_09_230001_9344125', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",151,83,68,151,0,151
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_04_20_180001_8282572.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_04_20_180001_8282572', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",151,78,73,151,0,151
"()begin try select top 10 rank() over(order by (total_worker_time+0.0)/execution_count desc,sql_handle,statement_start_offset ) as row_no ,       (rank() over(order by (total_worker_time+0.0)/execution_count desc,sql_handle,statement_start_offset ))%2 as l1 ,       creation_time ,       last_execution_time  ,       (total_worker_time+0.0)/1000 as total_worker_time ,       (total_worker_time+0.0)/(execution_count*1000) as [AvgCPUTime] ,       total_logical_reads as [LogicalReads] ,       total_logical_writes as [LogicalWrites] ,       execution_count ,       total_logical_reads+total_logical_writes as [AggIO] ,       (total_logical_reads+total_logical_writes)/(execution_count+0.0) as [AvgIO] ,       case when sql_handle IS NULL                 then ' '                 else ( substring(st.text,(qs.statement_start_offset+2)/2,       (case when qs.statement_end_offset = -1         then len(convert(nvarchar(MAX),st.text))*2      else qs.statement_end_offset    end - qs.statement_start_offset) /2  ) )         end as query_text  ,       db_name(st.dbid) as db_name ,       st.objectid as object_id from sys.dm_exec_query_stats  qs cross apply sys.dm_exec_sql_text(sql_handle) st where total_worker_time  > 0  order by [AvgCPUTime] desc end try begin catch select -100 as row_no ,       1 as l1, 1 as create_time,1 as last_execution_time,1 as total_worker_time,1 as AvgCPUTime,1 as LogicalReads,1 as LogicalWrites ,       ERROR_NUMBER() as execution_count ,       ERROR_SEVERITY() as AggIO ,       ERROR_STATE() as AvgIO ,       ERROR_MESSAGE() as query_text ,       0 as db_name ,       0 as object_name end catch",151,150,1,130697,3494,302
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_04_05_230001_3881601.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_04_05_230001_3881601', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",147,60,87,148,0,147
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSOD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSOD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSOD\StakeSOD_backup_2024_04_13_190000_8560325.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSOD_backup_2024_04_13_190000_8560325', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",147,55,92,148,0,147
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_04_16_230002_1600159.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_04_16_230002_1600159', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",145,67,78,148,0,145
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO\StakeSTO_backup_2024_03_20_230001_8238205.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_backup_2024_03_20_230001_8238205', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",145,91,54,151,0,145
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_13_190000_8121030.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_13_190000_8121030', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",141,96,45,148,0,141
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_04_09_230001_8215941.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_04_09_230001_8215941', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",139,57,82,151,0,139
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO_DEV\StakeSTO_DEV_backup_2024_04_13_230001_5692074.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_04_13_230001_5692074', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",136,57,79,151,0,136
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_18_110001_1029053.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_18_110001_1029053', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",136,78,58,236,0,136
"SELECT     DB_NAME (database_id) as [Database Name],     name as [Database File Name],     [Type] = CASE WHEN Type_Desc = 'ROWS' THEN 'Data File(s)'             WHEN Type_Desc = 'LOG'  THEN 'Log File(s)'             ELSE Type_Desc END,     size*8/1024 as 'Size (MB)',     physical_name as [Database_File_Location] FROM sys.master_files ORDER BY 1,3  IF OBJECT_ID('tempdb.dbo.#space') IS NOT NULL     DROP TABLE #space  CREATE TABLE #space (       database_id INT PRIMARY KEY     , data_used_size DECIMAL(18,2)     , log_used_size DECIMAL(18,2) )  DECLARE @SQL NVARCHAR(MAX)  SELECT @SQL = STUFF((     SELECT '     USE [' + d.name + ']     INSERT INTO #space (database_id, data_used_size, log_used_size)     SELECT           DB_ID()         , SUM(CASE WHEN [type] = 0 THEN space_used END)         , SUM(CASE WHEN [type] = 1 THEN space_used END)     FROM (         SELECT s.[type], space_used = SUM(FILEPROPERTY(s.name, ''SpaceUsed'') * 8. / 1024)         FROM sys.database_files s         GROUP BY s.[type]     ) t;'     FROM sys.databases d     WHERE d.[state] = 0     FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')  EXEC sys.sp_executesql @SQL  SELECT       d.database_id     , d.name     , d.state_desc     , d.recovery_model_desc     , t.total_size     , t.data_size     , s.data_used_size     , t.log_size     , s.log_used_size     , bu.full_last_date     , bu.full_size     , bu.log_last_date     , bu.log_size FROM (     SELECT           database_id         , log_size = CAST(SUM(CASE WHEN [type] = 1 THEN size END) * 8. / 1024 AS DECIMAL(18,2))         , data_size = CAST(SUM(CASE WHEN [type] = 0 THEN size END) * 8. / 1024 AS DECIMAL(18,2))         , total_size = CAST(SUM(size) * 8. / 1024 AS DECIMAL(18,2))     FROM sys.master_files     GROUP BY database_id ) t JOIN sys.databases d ON d.database_id = t.database_id LEFT JOIN #space s ON d.database_id = s.database_id LEFT JOIN (     SELECT           database_name         , full_last_date = MAX(CASE WHEN [type] = 'D' THEN backup_finish_date END)         , full_size = MAX(CASE WHEN [type] = 'D' THEN backup_size END)         , log_last_date = MAX(CASE WHEN [type] = 'L' THEN backup_finish_date END)         , log_size = MAX(CASE WHEN [type] = 'L' THEN backup_size END)     FROM (         SELECT               s.database_name             , s.[type]             , s.backup_finish_date             , backup_size =                         CAST(CASE WHEN s.backup_size = s.compressed_backup_size                                     THEN s.backup_size                                     ELSE s.compressed_backup_size                         END / 1048576.0 AS DECIMAL(18,2))             , RowNum = ROW_NUMBER() OVER (PARTITION BY s.database_name, s.[type] ORDER BY s.backup_finish_date DESC)         FROM msdb.dbo.backupset s         WHERE s.[type] IN ('D', 'L')     ) f     WHERE f.RowNum = 1     GROUP BY f.database_name ) bu ON d.name = bu.database_name ORDER BY t.total_size DESC  SELECT      req.session_id     , req.total_elapsed_time AS duration_ms     , req.cpu_time AS cpu_time_ms     , req.total_elapsed_time - req.cpu_time AS wait_time     , req.logical_reads     , SUBSTRING (REPLACE (REPLACE (SUBSTRING (ST.text, (req.statement_start_offset/2) + 1,         ((CASE statement_end_offset            WHEN -1            THEN DATALENGTH(ST.text)              ELSE req.statement_end_offset          END - req.statement_start_offset)/2) + 1) , CHAR(10), ' '), CHAR(13), ' '),        1, 512)  AS statement_text   FROM sys.dm_exec_requests AS req     CROSS APPLY sys.dm_exec_sql_text(req.sql_handle) AS ST ORDER BY total_elapsed_time DESC;  SELECT top 100 t.text,      (qs.total_elapsed_time/1000) / qs.execution_count AS avg_elapsed_time,      (qs.total_worker_time/1000) / qs.execution_count AS avg_cpu_time,      ((qs.total_elapsed_time/1000) / qs.execution_count ) - ((qs.total_worker_time/1000) / qs.execution_count) AS avg_wait_time,      qs.total_logical_reads / qs.execution_count AS avg_logical_reads,      qs.total_logical_writes / qs.execution_count AS avg_writes,      (qs.total_elapsed_time/1000) AS cumulative_elapsed_time_all_executions FROM sys.dm_exec_query_stats qs      CROSS apply sys.Dm_exec_sql_text (sql_handle) t -- WHERE t.text like '<Your Query>%' -- Replace <Your Query> with your query or the beginning part of your query. The special chars like '[','_','%','^' in the query should be escaped. ORDER BY (qs.total_elapsed_time / qs.execution_count) DESC  --Deadlock sql check SELECT     session_id,     start_time,      [status],     command,     blocking_session_id,     wait_type,     wait_time,     open_transaction_count,     transaction_id,     total_elapsed_time,     Definition = CAST(text AS VARCHAR(MAX)) FROM     SYS.DM_EXEC_REQUESTS     CROSS APPLY sys.dm_exec_sql_text(sql_handle)  WHERE blocking_session_id != 0   ",131,38,93,24838,1110,263
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP DATABASE [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Full\StakeholderProfile\StakeholderProfile_backup_2024_04_16_230002_1200794.bak' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_04_16_230002_1200794', SKIP, REWIND, NOUNLOAD,  STATS = 10 END ",129,83,46,148,0,129
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_03_27_230001_7015427.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_03_27_230001_7015427', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",129,67,62,236,0,129
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_04_02_110005_6698384.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_04_02_110005_6698384', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",128,44,84,151,0,128
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_04_21_230001_8292109.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_04_21_230001_8292109', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",127,84,43,151,0,127
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP DATABASE [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Full\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_13_230001_4753564.bak' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_13_230001_4753564', SKIP, REWIND, NOUNLOAD,  STATS = 10 END ",126,54,72,151,0,126
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO_DEV\StakeSTO_DEV_backup_2024_04_20_190001_5213685.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_04_20_190001_5213685', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",125,55,70,148,0,125
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_04_04_230001_6645256.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_04_04_230001_6645256', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",125,66,59,151,0,125
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSOD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSOD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSOD\StakeSOD_backup_2024_03_27_230001_7774204.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSOD_backup_2024_03_27_230001_7774204', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",124,56,68,151,0,124
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSOD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSOD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSOD\StakeSOD_backup_2024_03_22_110000_8990044.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSOD_backup_2024_03_22_110000_8990044', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",124,67,57,151,0,124
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSOD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSOD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSOD\StakeSOD_backup_2024_04_14_230001_3925950.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSOD_backup_2024_04_14_230001_3925950', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",120,60,60,151,0,120
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_04_11_230001_7210826.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_04_11_230001_7210826', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",120,68,52,151,0,120
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_04_17_150000_7922398.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_04_17_150000_7922398', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",119,83,36,148,0,119
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_15_230002_2064625.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_15_230002_2064625', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",118,71,47,236,0,118
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO\StakeSTO_backup_2024_03_28_100001_5455361.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_backup_2024_03_28_100001_5455361', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",118,61,57,148,0,118
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_20_230002_0609667.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_20_230002_0609667', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",117,79,38,236,0,117
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_04_14_230001_5832848.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_04_14_230001_5832848', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",115,68,47,151,0,115
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO_DEV\StakeSTO_DEV_backup_2024_04_18_230002_2950558.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_04_18_230002_2950558', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",115,67,48,151,0,115
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP DATABASE [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Full\StakeholderProfile\StakeholderProfile_backup_2024_04_19_230002_2372830.bak' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_04_19_230002_2372830', SKIP, REWIND, NOUNLOAD,  STATS = 10 END ",114,49,65,148,0,114
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_04_03_200001_2910622.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_04_03_200001_2910622', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",112,48,64,151,0,112
"(@_msparam_0 nvarchar(4000))       select * into #tmpag_availability_groups from master.sys.availability_groups        SELECT arcn.replica_server_name AS [ReplicaName], cm.member_name AS [NodeName], cm.member_type AS [MemberType], cm.member_state AS [MemberState], ISNULL(cm.number_of_quorum_votes, -1) AS [NumberOfQuorumVotes], 'Server[@Name=' + quotename(CAST(         serverproperty(N'Servername')        AS sysname),'''') + ']' + '/AvailabilityGroup[@Name=' + quotename(AG.name,'''') + ']' + '/ReplicaClusterNode[@ReplicaName=' + quotename(arcn.replica_server_name,'''') + ' and @NodeName=' + quotename(cm.member_name,'''') + ']' AS [Urn] FROM #tmpag_availability_groups AS AG INNER JOIN master.sys.dm_hadr_availability_replica_cluster_nodes AS arcn ON arcn.group_name=AG.name LEFT OUTER JOIN master.sys.dm_hadr_cluster_members AS cm ON UPPER(arcn.node_name) = UPPER(cm.member_name) WHERE (AG.name=@_msparam_0)        drop table #tmpag_availability_groups       ",111,86,25,5,0,111
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_04_03_230001_5476325.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_04_03_230001_5476325', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",110,63,47,151,0,110
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_04_13_230001_4394144.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_04_13_230001_4394144', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",110,62,48,151,0,110
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO_DEV\StakeSTO_DEV_backup_2024_03_26_230001_8437570.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_03_26_230001_8437570', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",107,47,60,151,0,107
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO\StakeSTO_backup_2024_04_12_230001_6017787.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_backup_2024_04_12_230001_6017787', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",107,54,53,151,0,107
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_04_17_230002_4077186.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_04_17_230002_4077186', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",107,67,40,151,0,107
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_13_230001_3635350.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_13_230001_3635350', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",106,85,21,236,0,106
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO'))  IF (@preferredReplica = 1) BEGIN     BACKUP DATABASE [StakeSTO] TO  DISK = N'G:\Backup_SQL\STAKEHD\Full\StakeSTO\StakeSTO_backup_2024_04_01_230001_2352919.bak' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_backup_2024_04_01_230001_2352919', SKIP, REWIND, NOUNLOAD,  STATS = 10 END ",105,53,52,148,0,105
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_04_13_230001_6570675.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_04_13_230001_6570675', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",105,60,45,151,0,105
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_REPORT'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_REPORT] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_REPORT\SVDMS_REPORT_backup_2024_04_17_230002_4476538.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_REPORT_backup_2024_04_17_230002_4476538', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",103,70,33,151,0,103
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP DATABASE [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Full\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_18_230002_1912216.bak' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_18_230002_1912216', SKIP, REWIND, NOUNLOAD,  STATS = 10 END ",103,60,43,151,0,103
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_03_26_100000_9979721.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_03_26_100000_9979721', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",103,62,41,151,0,103
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO_DEV\StakeSTO_DEV_backup_2024_03_31_230001_6407402.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_03_31_230001_6407402', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",103,65,38,151,0,103
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('Svdms'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [Svdms] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\Svdms\Svdms_backup_2024_04_19_230002_2961868.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'Svdms_backup_2024_04_19_230002_2961868', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",102,71,31,151,0,102
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeSTO_DEV'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeSTO_DEV] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeSTO_DEV\StakeSTO_DEV_backup_2024_04_06_230001_7773752.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeSTO_DEV_backup_2024_04_06_230001_7773752', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",102,61,41,151,0,102
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_03_28_100001_5105922.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_03_28_100001_5105922', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",102,48,54,148,0,102
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('StakeholderProfile'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [StakeholderProfile] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\StakeholderProfile\StakeholderProfile_backup_2024_04_07_230001_8933257.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'StakeholderProfile_backup_2024_04_07_230001_8933257', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",101,51,50,151,0,101
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('Svdms'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [Svdms] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\Svdms\Svdms_backup_2024_03_29_150001_8571956.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'Svdms_backup_2024_03_29_150001_8571956', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",101,63,38,148,0,101
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_08_110001_0651895.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_08_110001_0651895', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",101,68,33,236,0,101
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('SVDMS_LOG'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [SVDMS_LOG] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\SVDMS_LOG\SVDMS_LOG_backup_2024_04_07_230002_0540693.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'SVDMS_LOG_backup_2024_04_07_230002_0540693', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",101,71,30,151,0,101
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_23_120000_7368463.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_23_120000_7368463', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",100,69,31,148,0,100
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('Svdms'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [Svdms] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\Svdms\Svdms_backup_2024_04_03_230001_4597780.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'Svdms_backup_2024_04_03_230001_4597780', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",99,55,44,151,0,99
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('Svdms'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [Svdms] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\Svdms\Svdms_backup_2024_03_31_230001_6686947.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'Svdms_backup_2024_03_31_230001_6686947', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",98,62,36,151,0,98
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_03_22_020000_7331211.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_03_22_020000_7331211', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",98,82,16,236,0,98
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_20_170001_6830978.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_20_170001_6830978', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",97,82,15,236,0,97
"DECLARE @preferredReplica int  SET @preferredReplica = (SELECT [master].sys.fn_hadr_backup_is_preferred_replica('MDW_STAKEHD'))  IF (@preferredReplica = 1) BEGIN     BACKUP LOG [MDW_STAKEHD] TO  DISK = N'G:\Backup_SQL\STAKEHD\Transaction\MDW_STAKEHD\MDW_STAKEHD_backup_2024_04_03_230001_1712528.trn' WITH  RETAINDAYS = 7, NOFORMAT, NOINIT,  NAME = N'MDW_STAKEHD_backup_2024_04_03_230001_1712528', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10 END ",97,76,21,236,0,97
