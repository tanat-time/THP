"SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   --and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-04-16' 	   and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID  	 and year(L_MAILITMS.CAPTURE_GMT_DT) = year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 	 AND						 month(L_MAILITMS.CAPTURE_GMT_DT) = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	  where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 not in			(select RKEY   								from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 								and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 								--where convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 								where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  								) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",6102629,47949990,-41847361,1478681105,0,6102629
"    -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_UPDATE_T_EMS_CN31_CN33_DETAIL]  	 AS BEGIN 	--TRUNCATE TABLE T_EMS_CN31_CN33_DETAIL;  -- +  +  +   +   + รายจ่าย +  +  +  +  +  +  +  	UPDATE		[dbo].[T_EMS_CN31_CN33_DETAIL] 	SET			[ITEM_WEIGHT] = UP.MAILITM_WEIGHT 				,RECPTCL_WEIGHT = UP.RECPTCL_WEIGHT 				,RECPTCL_ITEMS = UP.RECPTCL_MAILITMS_NO 				,[OBSERVATION] = UP.Observation 				,[UPDATE_DATE] = getdate() 				 	FROM    (SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,substring(R.RECPTCL_FID,21,3) as [BAG_NO] 						 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 					  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 					  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 				FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 				INNER JOIN				[MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 				LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 				LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 				INNER JOIN				(select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 													L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 													L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 													case when L_MAILITM_EVENTS.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else L_MAILITM_EVENTS.[RECPTCL_PID] end  as RECPTCL_PID 													,max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT 											from    MonitasDB.[dbo].[L_MAILITMS]  											left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID] and (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 											group by L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 													L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 													L_MAILITMS.MAILITM_WEIGHT  , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 													case when L_MAILITM_EVENTS.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else L_MAILITM_EVENTS.[RECPTCL_PID] end  										   ) as L_MAILITMS 				 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID 				 INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 				  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 				 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  				  where					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --and L_DESPTCHS.[DEST_OFFICE_FCD] like('CNSH%') 				  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 				  --and	convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = convert(date,getdate()-1) 				 and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 				 --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 				-- and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-02-05' 				 				 and   substring(R.RECPTCL_FID,21,3) not like 'T%' 				  --and month(L_DESPTCHS.DESPTCH_DEPARTURE_DT) ='10' 				  --and right(L_DESPTCHS.DESPTCH_FID,4)='2535' 			 ) as UP 			 INNER JOIN		T_EMS_CN31_CN33_DETAIL ON T_EMS_CN31_CN33_DETAIL.[RECPTCL_FID] = UP.RECPTCL_FID collate thai_ci_as and T_EMS_CN31_CN33_DETAIL.ITEMS_ID = UP.MAILITM_FID collate thai_ci_as     -- +  +  +   +   + รายได้ +  +  +  +  +  +  + 	UPDATE		[dbo].[T_EMS_CN31_CN33_DETAIL] 	SET			[ITEM_WEIGHT] = UP.MAIL_WEIGHT 				,RECPTCL_WEIGHT = UP.RECPTCL_WEIGHT 				,RECPTCL_ITEMS = UP.RECPTCL_MAILITMS_NO 				,[OBSERVATION] = UP.Observation 				,[UPDATE_DATE] = getdate()  	FROM	(SELECT			substring(R.RECPTCL_FID,1,20) as DISPATCHING_ID ,T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ, substring(R.RECPTCL_FID,21,3) as [BAG_NO] 							,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 							,N_EDI_MAILITMS.MAIL_WEIGHT ,RE_EDI.RECPTCL_WEIGHT	,RE_EDI.RECPTCL_MAILITMS_NO	,RE_EDI.RECPTCL_FID 							, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  							,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 							,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 							,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 			FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA	 			INNER JOIN			[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 			INNER JOIN          [MonitasDB].[dbo].N_EDI_MAILITMS ON RE_EDI.RECPTCL_PID = N_EDI_MAILITMS.RECPTCL_PID 			INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON RE_EDI.RECPTCL_FID = R.RECPTCL_FID 			INNER JOIN			[MonitasDB].[dbo].L_MAILITMS ON L_MAILITMS.MAILITM_FID = N_EDI_MAILITMS.MAILITM_FID 			INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(RE_EDI.RECPTCL_FID,1,5) collate THAI_CI_AS 			INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(RE_EDI.RECPTCL_FID,7,5) collate THAI_CI_AS 			INNER JOIN			C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 			INNER JOIN				T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= substring(RE_EDI.RECPTCL_FID,1,20) collate THAI_CI_AS 			AND					   T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)    			where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and substring(R.RECPTCL_FID,1,6) like 'IDJKT%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month		 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-02-05' 			 		 			and					substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 		--and                 substring(RE_EDI.RECPTCL_FID,1,20) = 'AUSYDBTHBKKBAED40008' 	  ) as UP 	INNER JOIN		T_EMS_CN31_CN33_DETAIL ON T_EMS_CN31_CN33_DETAIL.[RECPTCL_FID] = UP.RECPTCL_FID collate thai_ci_as  and T_EMS_CN31_CN33_DETAIL.ITEMS_ID = UP.MAILITM_FID collate thai_ci_as   END ",1052590,1652921,-600331,135328387,580,1052590
"--INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] --				([DISPATCHING_ID],[CN31EMS_SEQ], RKEY, --				[BAG_NO], [ITEMS_ID] ,[OFFICE_LODGING] ,[ITEM_WEIGHT] --				,RECPTCL_WEIGHT,RECPTCL_ITEMS ,RECPTCL_FID --				,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] --				,[CREATE_USER_ID] ,[CREATE_DATE] ,[UPDATE_USER_ID],[UPDATE_DATE] --				) 	SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-01-01' 	   --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				(select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 										case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 										LME.CAPTURE_GMT_DT 							 from    MonitasDB.[dbo].[L_MAILITMS]  							 left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  												FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 												WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 												GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 											)  							 AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 							and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 							 --where L_MAILITMS.MAILITM_FID = 'EE187476734TH'  							 where year(LME.CAPTURE_GMT_DT) = '2023' and month(LME.CAPTURE_GMT_DT) = '1' and L_MAILITMS.MAIL_CLASS_CD = 'E' 							   ) as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID  	 and year(L_MAILITMS.CAPTURE_GMT_DT) = year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 	 AND						 month(L_MAILITMS.CAPTURE_GMT_DT) = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	 -- where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 --not in			(select RKEY   		--						from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 		--						and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 		--						where convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 		--						--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  		--						) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",412434,2275637,-1863203,16568225,0,412434
"INSERT INTO [dbo].[TR_BGS_CN66_DETAIL] 	([CN66_SEQ],CN66_PK       ,[CN66_DATE]       ,[CN66_MAIL_NO]       ,[CN66_DISP_OFFICE]       ,[CN66_DESTINATION]       ,[CN66_FLIGHT_NO],CN66_SUB_CLASS       ,[CN66_W_LCAO],[CN66_RATE_LCAO] 	  ,[CN66_W_CP] ,[CN66_RATE_CP]       ,[CN66_CONSIGNMENT_ID],[CN66_OBSERV]       ,[DEL_FLAG]       ,[RECORD_STATUS]       ,[CREATE_USER_ID]       ,[CREATE_DATE] )  SELECT			TR_BGS_CN66_MAIN.CN66_SEQ ,CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID) as CN66_PK 				, day([CN38_DATE_OF_DEPART]) as [CN66_DATE] ,CN38_DESP_SERIAL_NO 				,C_OFFICES.OFFICE_SEQ as CN66_DISP_OFFICE,DEST_OFFICE.OFFICE_SEQ as CN66_DESTINATION 				,TR_BGS_CN66_MAIN.CN66_FLIGHT_NO ,TR_BGS_CN66_MAIN.CN66_SUB_CLASS,  				sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) as  CN38_GROSS_WEIGHT_LETTER_POST 				,case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS 				else 0 end as [CN66_RATE_LCAO]    				,sum([CN38_GROSS_WEIGHT_CP]) as CN38_GROSS_WEIGHT_CP 				,case when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS  				else 0 end as [CN66_RATE_CP] 				,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID  				,(case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 then sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST)  				  * case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS 				else 0 end 						else sum([CN38_GROSS_WEIGHT_CP]) * case when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS  				else 0 end end) as OB 				,'N' as DEL_FLAG,'A' as RECORD_STATUS,1 as CREATE_USER_ID,getdate()  as CREATE_DATE  FROM [dbo].[TR_BGS_CN38A_MAIN]   INNER JOIN (SELECT distinct [CN38_SEQ] ,[CN38_OFFICE_ORIGIN] ,[CN38_OFFICE_DESTINATION],[CN38_MAIL_CATEGORY] 				,[CN38_YEAR],[CN38_DESP_SERIAL_NO],DEL_FLAG  ,[CN38_TOT_IN_DISP] ,[CN38_GROSS_WEIGHT_LETTER_POST],[CN38_GROSS_WEIGHT_CP] 				FROM [dbo].[TR_BGS_CN38A_DETAIL] 				where TR_BGS_CN38A_DETAIL.CN38_RECP_SERIAL_NO = '0' and [DEL_FLAG] ='N') as CN38_DETAIL  ON CN38_DETAIL.CN38_SEQ = TR_BGS_CN38A_MAIN.CN38_SEQ  INNER JOIN  [dbo].[C_OFFICES] ON TR_BGS_CN38A_MAIN.CN38_OFFICE_ORIGIN = C_OFFICES.OFFICE_SEQ    INNER JOIN  [dbo].[C_COUNTRIES] ON C_OFFICES.COUNTRY_CD = C_COUNTRIES.COUNTRY_CD   INNER JOIN  [dbo].[C_OFFICES] as DEST_OFFICE ON DEST_OFFICE.OFFICE_SEQ = TR_BGS_CN38A_MAIN.CN38_OFFICE_DESTINATIONS  INNER JOIN  [dbo].[C_COUNTRIES] as DEST_COUNTRY ON DEST_OFFICE.COUNTRY_CD = DEST_COUNTRY.COUNTRY_CD   LEFT OUTER JOIN (SELECT   distinct  [R_DES_CODE] ,[R_DES_FLIGHT_NO],[R_CON_CODE],[R_CON_FLIGHT_NO], 							 [R_AGENT] ,R_CURRENCY ,[R_VALID_DATE], R_INVALID_DATE,R_DAY 							,R_EMS 							,[R_AIRMAIL]  							,case when [R_AIRMAIL] is null then 'E'  								  when R_EMS is null then 'U' 								  when R_EMS is not null and [R_AIRMAIL] is not null then 'EU' else null end R_TYPE 					  FROM [dbo].[TR_BGS_RATEA_MAIN] 					  where  DEL_FLAG='N' and [R_AGENT] is not null ) as RATE_AIR  	ON RATE_AIR.R_DES_CODE = (substring([CN38_DEST_LOCATION],1,2)+'-'+[CN38_AIRPORT_OF_OFFLOADING]) 	  and case when CHARINDEX('/',[CN38_FLIGHTNO])=0 then [CN38_FLIGHTNO] else substring([CN38_FLIGHTNO],1, CHARINDEX('/',[CN38_FLIGHTNO])-1) end = [R_DES_FLIGHT_NO]  	  and case when CHARINDEX('/',[CN38_FLIGHTNO])=0 then '-' else substring([CN38_FLIGHTNO],CHARINDEX('/',[CN38_FLIGHTNO])+1,6) end = ISNULL([R_CON_FLIGHT_NO],'-')  	  and convert(date,CN38_DATE_OF_DEPART) between convert(date,R_VALID_DATE) and convert(date,R_INVALID_DATE)  	  and (case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = R_TYPE  			  OR case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = substring(R_TYPE,1,1) 			  OR case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = substring(R_TYPE,2,1)) 	  and case when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Monday' then '1' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Tuesday' then '2' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Wednesday' then '3' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Thursday' then '4' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Friday' then '5' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Saturday' then '6' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Sunday' then '7' 					else '0' 					end = RATE_AIR.R_DAY      inner join TR_BGS_CN66_MAIN ON [CN38_FLIGHTNO] = [CN66_FLIGHT_NO]    and case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY = 'A' then 'U' else 'E' end = TR_BGS_CN66_MAIN.CN66_MAIL_CLASS    and TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS = TR_BGS_CN66_MAIN.CN66_SUB_CLASS    and [CN38_ROUTE] = [CN66_ROUTE]  and TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY = TR_BGS_CN66_MAIN.CN66_BY     and month([CN38_DATE_OF_DEPART]) = [CN66_MONTH] and year([CN38_DATE_OF_DEPART]) = [CN66_YEAR]  and TR_BGS_CN66_MAIN.[CN66_DEST_LOCATION] = [CN38_DEST_LOCATION]  and ISNULL(TR_BGS_CN66_MAIN.CN66_AGENT,'-') = ISNULL(RATE_AIR.R_AGENT,'-')     WHERE TR_BGS_CN38A_MAIN.DEL_FLAG='N' and TR_BGS_CN66_MAIN.CN66_SERVICE_TYPE ='AIR'     and  TR_BGS_CN38A_MAIN.[CN38_MAIL_CATEGORY] in('A','E')   and TR_BGS_CN66_MAIN.FLOW_STATUS ='DRAFT'    AND year(CN38_DATE_OF_DEPART) = '2024'  and month([CN38_DATE_OF_DEPART]) in('01','02','03','04')  and CONCAT(CN38_DESP_SERIAL_NO,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)   not in (select concat([CN66_MAIL_NO],[CN66_CONSIGNMENT_ID])  from TR_BGS_CN66_DETAIL)  -- and CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)='20772716195817UTHBKKC467881'    group by TR_BGS_CN66_MAIN.CN66_SEQ ,CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)  				, day([CN38_DATE_OF_DEPART])  ,CN38_DESP_SERIAL_NO 				,C_OFFICES.OFFICE_SEQ ,DEST_OFFICE.OFFICE_SEQ  				,TR_BGS_CN66_MAIN.CN66_FLIGHT_NO ,TR_BGS_CN66_MAIN.CN66_SUB_CLASS,TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS 				,[R_AIRMAIL],R_EMS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID   ORDER BY  day([CN38_DATE_OF_DEPART]),CN38_DESP_SERIAL_NO ",337423,337170,253,12268048,38,337423
" INSERT INTO [dbo].[TR_CPP_CP87_MAIN]            ([DISPATCHIN_ID], [DISPATCHING_OPERATOR]            ,[DESTINATION_OPERATOR] , [ORIGIN_OFFICE], [DESTINATION_OFFICE] 		   ,[MAIL_CATEGORY] , [MAIL_SUBCLASS], [CP87_YEAR] , [DISPATCH_NO] 		   ,[DESPTCH_DATE] ,[TRANSPORTATION] ,[SERVICE_TYPE]  		   ,[BULK_WEIGHT_PARCEL] ,[BULK_PARCEL] 			,[DISPATCH_GROSS_WEIGHT] ,[DISPATCH_PAECEL] ,[DISPATCH_PARCEL_OUT] 		   ,[TOTAL_DIST_WEIGHT] ,[BAG_WEIGHT] 		   ,TOTAL_LAND_SEA_RATE_RECEIVING,TOTAL_AIR_CONVEYANCE_DUES_RECEIVING            ,RECEPT_BAG_AMT,RECEPT_OTHER_AMT,[RECEPTACLE_TOTAL]            ,[DEL_FLAG],[RECORD_STATUS],[CREATE_DATE] , [CREATE_USER_ID] 		   ,[UPDATE_DATE] ,[UPDATE_USER_ID] ,[FORM_SUBMIT_ID] 		   ,[REQUEST_EDIT_STATUS])    SELECT				[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR 				  ,DISP_NO,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,case when sum(Not_MAIL_WEIGHT) =0  then dbo.RoundUp(sum(MAILITM_WEIGHT),1)  					 else dbo.RoundUp(TOTAL_WEIGHT_GROSS-sum(Not_MAIL_WEIGHT),1) end as  M_MAIL_WEIGHT 					,DISPATCH_NO_OF_ITEM-sum(Not_BULK_NO_OF_PARCEL) as BULK_NO_OF_PARCEL 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM 					  ,DISPATCH_PARCEL_OUT ,TOTAL_WEIGHT_GROSS ,[BAG_WEIGHT] 					   ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]   FROM ( 				SELECT				L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_PID, L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as [DESPTCH_FID] ,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD 									, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD , L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 									 , L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD,YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DIST_YEAR 								  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as DISP_NO 								  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 									,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as [FLIGHT_TRIP_NUMBERS] 									,'O' as SERVICE_TYPE 					 									/*,dbo.RoundUp(L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS-sum(case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <>'Normal' then L_MAILITMS.MAILITM_WEIGHT  									else 0 end),1) as M_MAIL_WEIGHT*/ 									,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <>'Normal' then L_MAILITMS.MAILITM_WEIGHT  									else 0 end  as Not_MAIL_WEIGHT ,L_MAILITMS.MAILITM_WEIGHT 									,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <> 'Normal' then 1  										  else 0 end as Not_BULK_NO_OF_PARCEL 									--,count(L_MAILITMS.MAILITM_FID) as BULK_NO_OF_PARCEL 									 , L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS 									  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS as DISPATCH_NO_OF_ITEM 									  ,0 as DISPATCH_PARCEL_OUT 									  , L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS as TOTAL_DIST_WEIGHT 									  ,0 as [BAG_WEIGHT] 									  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPT_BAG_AMT 									  ,0 as RECEPT_OTHER_AMT 									  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPTACLE_TOTAL			  									 		  				  FROM					[MonitasDB].[dbo].L_RECPTCLS R  				  INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = substring(R.RECPTCL_FID,1,6) collate THAI_CI_AS  				  INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = substring(R.RECPTCL_FID,7,6) collate THAI_CI_AS  				  INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 				  INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = CO_DEST.[COUNTRY_CD] and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  				 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 				  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 				  LEFT OUTER JOIN		[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 				  INNER JOIN			MonitasDB.[dbo].[L_MAILITMS] ON L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID 				  LEFT OUTER JOIN       C_POSTAL_STATUSES ON L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD   				  WHERE		convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-04-22' 				  -- convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 					AND			L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --AND L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD ='FRWSSB'   					--AND			month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)= '12' 					AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ='A' AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 					--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) in('0200')  			) AS CP87_MAIN LEFT OUTER JOIN     [MonitasDB].[dbo].L_ACC_DESPTCH_STREAMS ON L_ACC_DESPTCH_STREAMS.ACC_DESPTCH_PID = CP87_MAIN.ACC_DESPTCH_PID and					L_ACC_DESPTCH_STREAMS.ACC_STREAM_ID = 201  WHERE        concat(CP87_MAIN.[DESPTCH_FID], CP87_MAIN.DISP_NO) 	not in      (select concat(TR_CPP_CP87_MAIN.DISPATCHIN_ID,[DISPATCH_NO]) collate thai_ci_as from TR_CPP_CP87_MAIN where DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='A')  GROUP BY			[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR 					,DISP_NO,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM 					  ,DISPATCH_PARCEL_OUT  ,[BAG_WEIGHT] 					   ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL  ORDER BY DISP_NO ",278185,1487612,-1209427,18248729,47,278185
" SELECT				[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR 				  ,DISP_NO,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,case when sum(Not_MAIL_WEIGHT) =0  then dbo.RoundUp(sum(MAILITM_WEIGHT),1)  					 else dbo.RoundUp(TOTAL_WEIGHT_GROSS-sum(Not_MAIL_WEIGHT),1) end as  M_MAIL_WEIGHT 					,DISPATCH_NO_OF_ITEM-sum(Not_BULK_NO_OF_PARCEL) as BULK_NO_OF_PARCEL 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM 					  ,DISPATCH_PARCEL_OUT ,TOTAL_WEIGHT_GROSS ,[BAG_WEIGHT] 					   ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]   FROM ( 				SELECT				L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_PID, L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as [DESPTCH_FID] ,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD 									, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD , L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 									 , L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD,YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DIST_YEAR 								  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as DISP_NO 								  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 									,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as [FLIGHT_TRIP_NUMBERS] 									,'O' as SERVICE_TYPE 					 									/*,dbo.RoundUp(L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS-sum(case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <>'Normal' then L_MAILITMS.MAILITM_WEIGHT  									else 0 end),1) as M_MAIL_WEIGHT*/ 									,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <>'Normal' then L_MAILITMS.MAILITM_WEIGHT  									else 0 end  as Not_MAIL_WEIGHT ,L_MAILITMS.MAILITM_WEIGHT 									,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <> 'Normal' then 1  										  else 0 end as Not_BULK_NO_OF_PARCEL 									--,count(L_MAILITMS.MAILITM_FID) as BULK_NO_OF_PARCEL 									 , L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS 									  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS as DISPATCH_NO_OF_ITEM 									  ,0 as DISPATCH_PARCEL_OUT 									  , L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS as TOTAL_DIST_WEIGHT 									  ,0 as [BAG_WEIGHT] 									  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPT_BAG_AMT 									  ,0 as RECEPT_OTHER_AMT 									  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPTACLE_TOTAL			  									 		  				  FROM					[MonitasDB].[dbo].L_RECPTCLS R  				  INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = substring(R.RECPTCL_FID,1,6) collate THAI_CI_AS  				  INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = substring(R.RECPTCL_FID,7,6) collate THAI_CI_AS  				  INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 				  INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = CO_DEST.[COUNTRY_CD] and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  				 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 				  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 				  LEFT OUTER JOIN		[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 				  INNER JOIN			MonitasDB.[dbo].[L_MAILITMS] ON L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID 				  LEFT OUTER JOIN       C_POSTAL_STATUSES ON L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD   				  WHERE		convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-04-22' 				  -- convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 					AND			L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --AND L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD ='FRWSSB'   					--AND			month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)= '12' 					AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ='A' AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 					--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) in('0200')  			) AS CP87_MAIN LEFT OUTER JOIN     [MonitasDB].[dbo].L_ACC_DESPTCH_STREAMS ON L_ACC_DESPTCH_STREAMS.ACC_DESPTCH_PID = CP87_MAIN.ACC_DESPTCH_PID and					L_ACC_DESPTCH_STREAMS.ACC_STREAM_ID = 201  WHERE        concat(CP87_MAIN.[DESPTCH_FID], CP87_MAIN.DISP_NO) 	not in      (select concat(TR_CPP_CP87_MAIN.DISPATCHIN_ID,[DISPATCH_NO]) collate thai_ci_as from TR_CPP_CP87_MAIN where DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='A')  GROUP BY			[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR 					,DISP_NO,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM 					  ,DISPATCH_PARCEL_OUT  ,[BAG_WEIGHT] 					   ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL  ORDER BY DISP_NO ",246678,1282173,-1035495,18250538,57,246678
"SELECT			TR_BGS_CN66_MAIN.CN66_SEQ ,CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID) as CN66_PK 				, day([CN38_DATE_OF_DEPART]) as [CN66_DATE] ,CN38_DESP_SERIAL_NO 				,C_OFFICES.OFFICE_SEQ as CN66_DISP_OFFICE,DEST_OFFICE.OFFICE_SEQ as CN66_DESTINATION 				,TR_BGS_CN66_MAIN.CN66_FLIGHT_NO ,TR_BGS_CN66_MAIN.CN66_SUB_CLASS,  				sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) as  CN38_GROSS_WEIGHT_LETTER_POST 				,case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS 				else 0 end as [CN66_RATE_LCAO]    				,sum([CN38_GROSS_WEIGHT_CP]) as CN38_GROSS_WEIGHT_CP 				,case when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS  				else 0 end as [CN66_RATE_CP] 				,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID  				,(case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 then sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST)  				  * case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS 				else 0 end 						else sum([CN38_GROSS_WEIGHT_CP]) * case when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS  				else 0 end end) as OB 				,'N' as DEL_FLAG,'A' as RECORD_STATUS,1 as CREATE_USER_ID,getdate()  as CREATE_DATE  FROM [dbo].[TR_BGS_CN38A_MAIN]   INNER JOIN (SELECT distinct [CN38_SEQ] ,[CN38_OFFICE_ORIGIN] ,[CN38_OFFICE_DESTINATION],[CN38_MAIL_CATEGORY] 				,[CN38_YEAR],[CN38_DESP_SERIAL_NO],DEL_FLAG  ,[CN38_TOT_IN_DISP] ,[CN38_GROSS_WEIGHT_LETTER_POST],[CN38_GROSS_WEIGHT_CP] 				FROM [dbo].[TR_BGS_CN38A_DETAIL] 				where TR_BGS_CN38A_DETAIL.CN38_RECP_SERIAL_NO = '0' and [DEL_FLAG] ='N') as CN38_DETAIL  ON CN38_DETAIL.CN38_SEQ = TR_BGS_CN38A_MAIN.CN38_SEQ  INNER JOIN  [dbo].[C_OFFICES] ON TR_BGS_CN38A_MAIN.CN38_OFFICE_ORIGIN = C_OFFICES.OFFICE_SEQ    INNER JOIN  [dbo].[C_COUNTRIES] ON C_OFFICES.COUNTRY_CD = C_COUNTRIES.COUNTRY_CD   INNER JOIN  [dbo].[C_OFFICES] as DEST_OFFICE ON DEST_OFFICE.OFFICE_SEQ = TR_BGS_CN38A_MAIN.CN38_OFFICE_DESTINATIONS  INNER JOIN  [dbo].[C_COUNTRIES] as DEST_COUNTRY ON DEST_OFFICE.COUNTRY_CD = DEST_COUNTRY.COUNTRY_CD   LEFT OUTER JOIN (SELECT   distinct  [R_DES_CODE] ,[R_DES_FLIGHT_NO],[R_CON_CODE],[R_CON_FLIGHT_NO], 							 [R_AGENT] ,R_CURRENCY ,[R_VALID_DATE], R_INVALID_DATE,R_DAY 							,R_EMS 							,[R_AIRMAIL]  							,case when [R_AIRMAIL] is null then 'E'  								  when R_EMS is null then 'U' 								  when R_EMS is not null and [R_AIRMAIL] is not null then 'EU' else null end R_TYPE 					  FROM [dbo].[TR_BGS_RATEA_MAIN] 					  where  DEL_FLAG='N' and [R_AGENT] is not null ) as RATE_AIR  	ON RATE_AIR.R_DES_CODE = (substring([CN38_DEST_LOCATION],1,2)+'-'+[CN38_AIRPORT_OF_OFFLOADING]) 	  and case when CHARINDEX('/',[CN38_FLIGHTNO])=0 then [CN38_FLIGHTNO] else substring([CN38_FLIGHTNO],1, CHARINDEX('/',[CN38_FLIGHTNO])-1) end = [R_DES_FLIGHT_NO]  	  and case when CHARINDEX('/',[CN38_FLIGHTNO])=0 then '-' else substring([CN38_FLIGHTNO],CHARINDEX('/',[CN38_FLIGHTNO])+1,6) end = ISNULL([R_CON_FLIGHT_NO],'-')  	  and convert(date,CN38_DATE_OF_DEPART) between convert(date,R_VALID_DATE) and convert(date,R_INVALID_DATE)  	  and (case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = R_TYPE  			  OR case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = substring(R_TYPE,1,1) 			  OR case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = substring(R_TYPE,2,1)) 	  and case when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Monday' then '1' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Tuesday' then '2' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Wednesday' then '3' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Thursday' then '4' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Friday' then '5' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Saturday' then '6' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Sunday' then '7' 					else '0' 					end = RATE_AIR.R_DAY      inner join TR_BGS_CN66_MAIN ON [CN38_FLIGHTNO] = [CN66_FLIGHT_NO]    and case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY = 'A' then 'U' else 'E' end = TR_BGS_CN66_MAIN.CN66_MAIL_CLASS    and TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS = TR_BGS_CN66_MAIN.CN66_SUB_CLASS    and [CN38_ROUTE] = [CN66_ROUTE]  and TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY = TR_BGS_CN66_MAIN.CN66_BY     and month([CN38_DATE_OF_DEPART]) = [CN66_MONTH] and year([CN38_DATE_OF_DEPART]) = [CN66_YEAR]  and TR_BGS_CN66_MAIN.[CN66_DEST_LOCATION] = [CN38_DEST_LOCATION]  and ISNULL(TR_BGS_CN66_MAIN.CN66_AGENT,'-') = ISNULL(RATE_AIR.R_AGENT,'-')     WHERE TR_BGS_CN38A_MAIN.DEL_FLAG='N' and TR_BGS_CN66_MAIN.CN66_SERVICE_TYPE ='AIR'     and  TR_BGS_CN38A_MAIN.[CN38_MAIL_CATEGORY] in('A','E')   and TR_BGS_CN66_MAIN.FLOW_STATUS ='DRAFT'    AND year(CN38_DATE_OF_DEPART) = '2024'  and month([CN38_DATE_OF_DEPART]) in('01','02','03','04')  and CONCAT(CN38_DESP_SERIAL_NO,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)   not in (select concat([CN66_MAIL_NO],[CN66_CONSIGNMENT_ID])  from TR_BGS_CN66_DETAIL)  -- and CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)='20772716195817UTHBKKC467881'    group by TR_BGS_CN66_MAIN.CN66_SEQ ,CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)  				, day([CN38_DATE_OF_DEPART])  ,CN38_DESP_SERIAL_NO 				,C_OFFICES.OFFICE_SEQ ,DEST_OFFICE.OFFICE_SEQ  				,TR_BGS_CN66_MAIN.CN66_FLIGHT_NO ,TR_BGS_CN66_MAIN.CN66_SUB_CLASS,TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS 				,[R_AIRMAIL],R_EMS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID   ORDER BY  day([CN38_DATE_OF_DEPART]),CN38_DESP_SERIAL_NO ",193206,192701,505,12266182,1,193206
"   -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CN38_SUB_DETAIL_VIA] 	-- Add the parameters for the stored procedure here 	 AS BEGIN 	-- SET NOCOUNT ON added to prevent extra result sets from 	-- interfering with SELECT statements. 	--truncate table TR_CPP_CN38_SUB_DETAIL; 	 INSERT INTO		[dbo].[TR_CPP_CN38_SUB_DETAIL] 					(CLOSE_TRANS_ID,RECP_SERIAL_NO ,[CP_BAG_LOOSE_PARCEL_NO]  					  ,[GROSS_WEIGHT_CP] 					  ,[DEL_FLAG] 					  ,[RECORD_STATUS] 					  ,[CREATE_USER_ID] 					  ,[CREATE_DATE] 					  ,[UPDATE_USER_ID] 					 ,[UPDATE_DATE] 					  )  SELECT		CLOSE_TRANS_ID ,CN38_RECP_SERIAL_NO , CN38_DETAIL.CN38_NO_POST_BAG 			,CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST  			,'N' as  [DEL_FLAG] 		   ,'A' as [RECORD_STATUS] 		   ,99 as [CREATE_USER_ID] 		   ,getdate() as [CREATE_DATE] 		   ,99 as [UPDATE_USER_ID] 		   ,getdate() as [UPDATE_DATE]    FROM ( 		/*SELECT  TR_CPP_CN38_DETAIL.CLOSE_TRANS_ID, C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD as DEST_OFFICE 				,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD as CN38_MAIL_CATEGORY ,substring(R.RECPTCL_FID,14,2) as CN38_SUBCLASS 			  ,substring(convert(varchar(4),year(L_LEGS.DEPARTURE_DT)),4,1) as CN38_YEAR 			  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as CN38_DESP_SERIAL_NO 			  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as CN38_TOT_IN_DISP 			  ,0 as [CN38_RECP_SERIAL_NO] 			 , null as CN38_NO_POST_BAG  			 --,null as [CN38_NO_CP_BAG_LOOSE_PARCEL] 			 ,sum(case when substring(R.RECPTCL_FID,14,2) like 'C%' then R.RECPTCL_WEIGHT else 0 end) as CN38_GROSS_WEIGHT_LETTER_POST 			 --,case when STG_BGS_CN38_AIR2.MAIL_SUBCLASS_FCD='CN' then [DESPTCH_WEIGHT] else null end as [CN38_GROSS_WEIGHT_CP]  	   		from		[MonitasDB].[dbo].L_RECPTCLS R								 		inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 		INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  		INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS 					 		INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 		inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 		left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID  	   		INNER JOIN			[dbo].[TR_CPP_CN38_DETAIL] ON TR_CPP_CN38_DETAIL.CONSIGNMENT_ID = L_CONSGNTS.CONSGNT_FID  collate THAI_CI_AS  		AND					TR_CPP_CN38_DETAIL.OFFICE_ORIGIN = C_OFFICES.[OFFICE_FCD]  		and					TR_CPP_CN38_DETAIL.OFFICE_DESTINATION = DES_OFF.OFFICE_FCD   		AND					TR_CPP_CN38_DETAIL.DESP_SERIAL_NO = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4)    collate THAI_CI_AS 		 		AND					TR_CPP_CN38_DETAIL.DEL_FLAG ='N'   		WHERE				year(L_LEGS.DEPARTURE_DT)= '2023' --and			month(L_DESPTCHS.[DESPTCH_DEPARTURE_DT]) in('04') 		and				month(L_LEGS.DEPARTURE_DT) between '01' and '08' 		and					substring(R.RECPTCL_FID,14,2) like ('C%') and substring(R.RECPTCL_FID,13,1) in('A','B','C') 		and					substring(R.RECPTCL_FID,14,2) not like ('%T') and	substring(R.RECPTCL_FID,21,3) not like 'T%' 		and					L_ROUTES_LEGS.LEG_ORDER_NO = 0 		--and					L_CONSGNTS.CONSGNT_FID='THBKKC300151' 		--and			substring(R.RECPTCL_FID,14,2) not in('EV') 		and           L_CONSGNTS.CONSGNT_FID ='THBKKA111700' 		GROUP BY      TR_CPP_CN38_DETAIL.CLOSE_TRANS_ID,C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD  						,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,2) 					,substring(convert(varchar(4),year(L_LEGS.DEPARTURE_DT)),4,1)  					,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4)  					,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS   		UNION ALL*/ 		-------------- Detail ---------- 		SELECT	  TR_CPP_CN38_DETAIL.CLOSE_TRANS_ID, C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD as DEST_OFFICE 				,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD as CN38_MAIL_CATEGORY ,substring(R.RECPTCL_FID,14,2) as CN38_SUBCLASS 			  ,substring(convert(varchar(4),year(L_LEGS.DEPARTURE_DT)),4,1) as CN38_YEAR 			  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as CN38_DESP_SERIAL_NO 			  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as CN38_TOT_IN_DISP 			  ,convert(int,substring(R.RECPTCL_FID,21,3)) as [CN38_RECP_SERIAL_NO] 			 ,case when substring(R.RECPTCL_FID,14,2)like 'C%' then 1 else 0 end as CN38_NO_POST_BAG	  			  ,case when substring(R.RECPTCL_FID,14,2) like 'C%' then [RECPTCL_WEIGHT] else 0 end as CN38_GROSS_WEIGHT_LETTER_POST  	 			   	   		from		[MonitasDB].[dbo].L_RECPTCLS R								 		inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 		INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  		INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS 					 		INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 		inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 		left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID  	   		INNER JOIN			[dbo].[TR_CPP_CN38_DETAIL] ON TR_CPP_CN38_DETAIL.CONSIGNMENT_ID = L_CONSGNTS.CONSGNT_FID  collate THAI_CI_AS  		AND					TR_CPP_CN38_DETAIL.OFFICE_ORIGIN = C_OFFICES.[OFFICE_FCD]  		and					TR_CPP_CN38_DETAIL.OFFICE_DESTINATION = DES_OFF.OFFICE_FCD   		AND					TR_CPP_CN38_DETAIL.DESP_SERIAL_NO = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4)    collate THAI_CI_AS 		 		AND					TR_CPP_CN38_DETAIL.DEL_FLAG ='N'  		WHERE				year(L_LEGS.DEPARTURE_DT)= '2024'  		--and			     month(L_LEGS.DEPARTURE_DT) between '09' and '12' 		--and				month(L_LEGS.DEPARTURE_DT) between '11' and '11' 		and					substring(R.RECPTCL_FID,14,2) like ('C%') and substring(R.RECPTCL_FID,13,1) in('A','B','C') 		and					substring(R.RECPTCL_FID,14,2) not like ('%T') and	substring(R.RECPTCL_FID,21,3) not like 'T%' 		and					L_ROUTES_LEGS.LEG_ORDER_NO = 0 		and					L_CONSGNTS.ORIG_OFFICE_FCD like 'THBKK%'  		and					substring(RECPTCL_FID,1,6) like 'THBKK%'  		--and					substring(RECPTCL_FID,7,6) like 'SKBTS%' 		--and					L_CONSGNTS.CONSGNT_FID ='THBKKA111700' 		  		) as CN38_DETAIL  WHERE    concat(CN38_DETAIL.CLOSE_TRANS_ID,CN38_RECP_SERIAL_NO) collate thai_ci_as 		not in(select concat(TR_CPP_CN38_SUB_DETAIL.CLOSE_TRANS_ID,TR_CPP_CN38_SUB_DETAIL.RECP_SERIAL_NO)  				from TR_CPP_CN38_SUB_DETAIL inner join TR_CPP_CN38_DETAIL on TR_CPP_CN38_SUB_DETAIL.CLOSE_TRANS_ID = TR_CPP_CN38_DETAIL.CLOSE_TRANS_ID 				where TR_CPP_CN38_SUB_DETAIL.DEL_FLAG ='N')   ORDER BY    CN38_DETAIL.[OFFICE_FCD], CN38_DETAIL.DEST_OFFICE 				,CN38_DETAIL.CN38_MAIL_CATEGORY ,CN38_DETAIL.CN38_SUBCLASS 			  ,CN38_DETAIL.CN38_YEAR 			  ,CN38_DETAIL.CN38_DESP_SERIAL_NO 			  ,CN38_DETAIL.CN38_TOT_IN_DISP 			  ,CN38_DETAIL.[CN38_RECP_SERIAL_NO]  END ",172662,845135,-672473,12636592,33,172662
"   -- ============================================= -- Author:		Umarin -- Create date: 21-12-2022 -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CP87_MAIN_SAL]  AS BEGIN  -- +  +  +   +   + รายได้ +  +  +  +  +  +  + INSERT INTO [dbo].[TR_CPP_CP87_MAIN]            ([DISPATCHIN_ID], [DISPATCHING_OPERATOR]            ,[DESTINATION_OPERATOR] , [ORIGIN_OFFICE], [DESTINATION_OFFICE] 		   ,[MAIL_CATEGORY] , [MAIL_SUBCLASS], [CP87_YEAR] , [DISPATCH_NO] 		   ,[DESPTCH_DATE] ,[TRANSPORTATION] ,[SERVICE_TYPE]  		    ,[BULK_WEIGHT_PARCEL] ,[BULK_PARCEL] 			,[DISPATCH_GROSS_WEIGHT] ,[DISPATCH_PAECEL] ,[DISPATCH_PARCEL_OUT] 		   ,[TOTAL_DIST_WEIGHT] ,[BAG_WEIGHT] 		   ,TOTAL_LAND_SEA_RATE_RECEIVING,TOTAL_AIR_CONVEYANCE_DUES_RECEIVING            ,RECEPT_BAG_AMT,RECEPT_OTHER_AMT,[RECEPTACLE_TOTAL]            ,[DEL_FLAG]            ,[RECORD_STATUS],[CREATE_DATE] , [CREATE_USER_ID] 		   ,[UPDATE_DATE] ,[UPDATE_USER_ID] ,[FORM_SUBMIT_ID] 		   ,[REQUEST_EDIT_STATUS]) SELECT				[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR ,DISP_NO 					,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,L_ACC_DESPTCH_STREAMS.WEIGHT_GROSS as  M_MAIL_WEIGHT ,L_ACC_DESPTCH_STREAMS.NO_ITEMS as BULK_NO_OF_PARCEL					 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM ,DISPATCH_PARCEL_OUT 					 ,TOTAL_WEIGHT_GROSS ,[BAG_WEIGHT] 					  ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]  FROM ( 				SELECT		L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_PID, L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as [DESPTCH_FID] ,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD 					, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD , L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 				  , L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD,YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DIST_YEAR 				  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as DISP_NO 				  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 					,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as [FLIGHT_TRIP_NUMBERS] 					,'I' as SERVICE_TYPE 					,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <>'Normal' then N_EDI_MAILITMS.MAIL_WEIGHT  					   else 0 end as Not_MAIL_WEIGHT ,N_EDI_MAILITMS.MAIL_WEIGHT 					,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <> 'Normal' then 1  					      else 0 end as Not_BULK_NO_OF_PARCEL 					 , L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS 					  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS as DISPATCH_NO_OF_ITEM 					  ,0 as DISPATCH_PARCEL_OUT 					  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS as TOTAL_DIST_WEIGHT 					  ,0 as [BAG_WEIGHT] 					  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPT_BAG_AMT 					  ,0 as RECEPT_OTHER_AMT 					  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]   			 	     FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 		 INNER JOIN				[MonitasDB].[dbo].N_EDI_RECPTCLS as N_EDI_RECPTCLS on L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(N_EDI_RECPTCLS.RECPTCL_FID,1,20) 		 inner join				[MonitasDB].[dbo].N_EDI_MAILITMS on N_EDI_RECPTCLS.RECPTCL_PID = N_EDI_MAILITMS.RECPTCL_PID			 		inner JOIN				[MonitasDB].[dbo].L_MAILITMS on L_MAILITMS.MAILITM_FID = N_EDI_MAILITMS.MAILITM_FID 		 INNER JOIN				[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  		  INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  		  INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 		  INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = CO_DEST.[COUNTRY_CD] and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  		  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS		  		  LEFT OUTER JOIN		[MonitasDB].[dbo].C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 		  		  	WHERE		convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  	--convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 	AND			L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD LIKE 'THBKK%'  --AND L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD = 'MYKULA' 	--AND			month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = '12' 	AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD in('B') AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 	--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) = '0010' 				) AS CP87_MAIN LEFT OUTER JOIN     [MonitasDB].[dbo].L_ACC_DESPTCH_STREAMS ON L_ACC_DESPTCH_STREAMS.ACC_DESPTCH_PID = CP87_MAIN.ACC_DESPTCH_PID and					L_ACC_DESPTCH_STREAMS.ACC_STREAM_ID = 201 WHERE        concat(CP87_MAIN.[DESPTCH_FID], CP87_MAIN.DISP_NO) 	not in      (select concat(TR_CPP_CP87_MAIN.DISPATCHIN_ID,[DISPATCH_NO]) collate thai_ci_as from TR_CPP_CP87_MAIN where DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='B') GROUP BY	[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR 				  ,DISP_NO,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM 					,L_ACC_DESPTCH_STREAMS.WEIGHT_GROSS  					,L_ACC_DESPTCH_STREAMS.NO_ITEMS  					  ,DISPATCH_PARCEL_OUT  ,[BAG_WEIGHT] 					  ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL 	   	/*+   +    +    +   รายจ่าย +    +    +    +    +    +*/ INSERT INTO [dbo].[TR_CPP_CP87_MAIN]            ([DISPATCHIN_ID], [DISPATCHING_OPERATOR]            ,[DESTINATION_OPERATOR] , [ORIGIN_OFFICE], [DESTINATION_OFFICE] 		   ,[MAIL_CATEGORY] , [MAIL_SUBCLASS], [CP87_YEAR] , [DISPATCH_NO] 		   ,[DESPTCH_DATE] ,[TRANSPORTATION] ,[SERVICE_TYPE]  		   ,[BULK_WEIGHT_PARCEL] ,[BULK_PARCEL] 			,[DISPATCH_GROSS_WEIGHT] ,[DISPATCH_PAECEL] ,[DISPATCH_PARCEL_OUT] 		   ,[TOTAL_DIST_WEIGHT] ,[BAG_WEIGHT] 		   ,TOTAL_LAND_SEA_RATE_RECEIVING,TOTAL_AIR_CONVEYANCE_DUES_RECEIVING            ,RECEPT_BAG_AMT,RECEPT_OTHER_AMT,[RECEPTACLE_TOTAL]            ,[DEL_FLAG],[RECORD_STATUS],[CREATE_DATE] , [CREATE_USER_ID] 		   ,[UPDATE_DATE] ,[UPDATE_USER_ID] ,[FORM_SUBMIT_ID] 		   ,[REQUEST_EDIT_STATUS]) SELECT				[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR ,DISP_NO 				    ,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,case when sum(Not_MAIL_WEIGHT) =0  then dbo.RoundUp(sum(MAILITM_WEIGHT),1) else dbo.RoundUp(TOTAL_WEIGHT_GROSS-sum(Not_MAIL_WEIGHT),1) end as  M_MAIL_WEIGHT 					,DISPATCH_NO_OF_ITEM-sum(Not_BULK_NO_OF_PARCEL) as BULK_NO_OF_PARCEL 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM ,DISPATCH_PARCEL_OUT  					,TOTAL_WEIGHT_GROSS ,[BAG_WEIGHT] 					   ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]  FROM ( 				SELECT			L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_PID,	L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as [DESPTCH_FID] ,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD 					, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD , L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 					 , L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD,YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DIST_YEAR 				  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as DISP_NO 				  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 					,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as [FLIGHT_TRIP_NUMBERS] 					,'O' as SERVICE_TYPE 					,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <>'Normal' then L_MAILITMS.MAILITM_WEIGHT  									else 0 end  as Not_MAIL_WEIGHT ,L_MAILITMS.MAILITM_WEIGHT 									,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <> 'Normal' then 1  										  else 0 end as Not_BULK_NO_OF_PARCEL 					 , L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS 					  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS as DISPATCH_NO_OF_ITEM 					  ,0 as DISPATCH_PARCEL_OUT 					  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS as TOTAL_DIST_WEIGHT 					  ,0 as [BAG_WEIGHT] 					  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPT_BAG_AMT 					  ,0 as RECEPT_OTHER_AMT 					  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPTACLE_TOTAL			  						    FROM					[MonitasDB].[dbo].L_RECPTCLS R    INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = substring(R.RECPTCL_FID,1,6) collate THAI_CI_AS    INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = substring(R.RECPTCL_FID,7,6) collate THAI_CI_AS    INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD   INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = CO_DEST.[COUNTRY_CD] and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD   LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS   LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS   LEFT OUTER JOIN		[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20)   INNER JOIN			MonitasDB.[dbo].[L_MAILITMS] ON L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID   LEFT OUTER JOIN       C_POSTAL_STATUSES ON L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD     WHERE		convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 	--convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 	AND			L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --AND L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD LIKE 'MY%'   	--AND			month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = '12' 	AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD in('B') AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 	--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) = '0007' 	) AS CP87_MAIN LEFT OUTER JOIN     [MonitasDB].[dbo].L_ACC_DESPTCH_STREAMS ON L_ACC_DESPTCH_STREAMS.ACC_DESPTCH_PID = CP87_MAIN.ACC_DESPTCH_PID and					L_ACC_DESPTCH_STREAMS.ACC_STREAM_ID = 201 WHERE        concat(CP87_MAIN.[DESPTCH_FID], CP87_MAIN.DISP_NO) 	not in      (select concat(TR_CPP_CP87_MAIN.DISPATCHIN_ID,[DISPATCH_NO]) collate thai_ci_as from TR_CPP_CP87_MAIN where DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='B') GROUP BY	[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR 				  ,DISP_NO,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM 					  ,DISPATCH_PARCEL_OUT ,[BAG_WEIGHT] 					   ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL   END ",119580,77884,41696,295098,58,119580
"  -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CN38_SUB_DETAIL] 	-- Add the parameters for the stored procedure here 	  AS    BEGIN 	INSERT INTO [dbo].[TR_CPP_CN38_SUB_DETAIL]   ([CLOSE_TRANS_ID]       ,[CP_BAG_LOOSE_PARCEL_NO]       ,[GROSS_WEIGHT_CP] 	   ,[DEL_FLAG]       ,[RECORD_STATUS]       ,[CREATE_USER_ID]       ,[CREATE_DATE]) 		SELECT  TR_CPP_CN38_DETAIL.CLOSE_TRANS_ID 			  --,convert(varchar(2),ROW_NUMBER ( )   OVER ( PARTITION BY TR_CPP_CN38_DETAIL.[CONSIGNMENT_ID], STG_CPP_CN38_AIR.[ORIG_OFFICE_FCD]  ,STG_CPP_CN38_AIR.[DEST_OFFICE_FCD] ,([MAIL_CATEGORY_CD]+[MAIL_SUBCLASS_FCD])   ,right(TR_CPP_CN38_DETAIL.CONSIGNMENT_ID,4) order by TR_CPP_CN38_DETAIL.[CONSIGNMENT_ID] )) as [CN38_RECP_SERIAL_NO] 			 ,'1' as [CP_BAG_LOOSE_PARCEL_NO] 			 , [RECPTCL_WEIGHT] as [GROSS_WEIGHT_CP] 			   ,'N' as DEL_FLAG , 'A' as RECORD_STATUS , 1 as [CREATE_USER_ID]  			   ,getdate() as CREATE_DATE   	   		  FROM			[MonitasDB].[dbo].[L_RECPTCLS] R 		INNER JOIN		[MonitasDB].[dbo].[L_CONSGNTS]  ON R.EVT_CONSGNT_PID = L_CONSGNTS.CONSGNT_PID 		INNER JOIN		[MonitasDB].[dbo].[L_ROUTES]  ON L_ROUTES.ROUTE_PID = L_CONSGNTS.ROUTE_PID 		INNER JOIN		[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_ROUTES.ROUTE_PID 		INNER JOIN		[MonitasDB].[dbo].L_LEGS ON L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID 		INNER JOIN		[MonitasDB].[dbo].[C_LOCATIONS] LO_DEST ON LO_DEST.LOCATION_FCD = L_CONSGNTS.DEST_LOCATION_FCD 		INNER JOIN		[MonitasDB].[dbo].[C_LOCATIONS] LO_ORI ON LO_ORI.LOCATION_FCD = SUBSTRING(L_CONSGNTS.DEST_OFFICE_FCD, 1, 5) 		INNER JOIN		[MonitasDB].[dbo].[C_TRANSPORT_TYPES] ON C_TRANSPORT_TYPES.TRANSPORT_TYPE_CD = L_LEGS.[TRANSPORT_TYPE_CD]         		 INNER JOIN    [dbo].[TR_CPP_CN38_DETAIL]  ON [CONSIGNMENT_ID] = [CONSGNT_FID] collate thai_ci_as  		and TR_CPP_CN38_DETAIL.[DESP_SERIAL_NO] =  convert(varchar(4),convert(int,SUBSTRING(R.RECPTCL_FID, 17, 4))) collate thai_ci_as 		where year(R.EVT_GMT_DT)= '2024'  		and concat(TR_CPP_CN38_DETAIL.CLOSE_TRANS_ID,L_CONSGNTS.CONSGNT_FID) collate thai_ci_as 		not in(select concat(TR_CPP_CN38_SUB_DETAIL.[CLOSE_TRANS_ID],TR_CPP_CN38_DETAIL.CONSIGNMENT_ID)  				from TR_CPP_CN38_SUB_DETAIL inner join TR_CPP_CN38_DETAIL on TR_CPP_CN38_SUB_DETAIL.CLOSE_TRANS_ID = TR_CPP_CN38_DETAIL.CLOSE_TRANS_ID 				where TR_CPP_CN38_SUB_DETAIL.DEL_FLAG ='N') 		--and month(R.EVT_GMT_DT) in('09','10','11','12')  --ORDER BY [DESPATCH_SERIAL_NO]      -- ,[RECAPTACLE_SERIAL_NO] END ",105849,421864,-316015,4750284,1728,105849
"     -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- =============================================   CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CN38_MAIN_VIA] 	-- Add the parameters for the stored procedure here 	--@PYEAR varchar(4),  	--@PMONTH int   AS   BEGIN 	INSERT INTO [dbo].[TR_CPP_CN38_MAIN]     ([CONSIGNMENT_ID]       ,[POSTAL_DESIGNATED_OPER_ORIGIN]       ,[OFFICE_ORIGIN_BILL]       ,[OFFICE_DESTINATION_BILL]       ,[CN38_DATE]--,[SEAL_NO]       ,[FLIGHT_NO]       ,[DEPART_DATE_TIME]       ,[AIRPORT_OFFLOAD] ,INCOME_EXPENSE            ,[EDIT_STATUS],[DEL_FLAG]       ,[RECORD_STATUS]       ,[CREATE_USER_ID]       ,[CREATE_DATE]       ,[UPDATE_USER_ID] ,[UPDATE_DATE]       ) 	SELECT				A.CONSGNT_FID ,A.CN38_POSTAL_DESIGNATED_OPER_ORIGIN, A.CN38_OFFICE_ORIGIN ,A.CN38_OFFICE_DESTINATIONS 						,A.[DESPTCH_DEPARTURE_DT]					 						,A.FLIGHTS 						 ,A.CN38_DATE_OF_DEPART  						--,CASE WHEN B.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NULL THEN A.AIRPORT_OF_DIRECT_TRANSHIPMENT ELSE B.AIRPORT_OF_DIRECT_TRANSHIPMENT END AS AIRPORT_OF_DIRECT_TRANSHIPMENT 						,CASE WHEN B.AIRPORT_OF_OFFLOADING IS NULL THEN A.AIRPORT_OF_OFFLOADING ELSE B.AIRPORT_OF_OFFLOADING END AS AIRPORT_OF_OFFLOADING 						,'O' as INCOME_EXPENSE  						,'1' [EDIT_STATUS] 						,'N' as  [DEL_FLAG] 						,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] 						,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] 						,getdate() as [UPDATE_DATE] 					 					 	FROM 					(select				C_OFFICES.OPERATOR_CD as CN38_POSTAL_DESIGNATED_OPER_ORIGIN ,DES_OFF.OPERATOR_CD as OPERATOR_OF_DESTINATION 												,C_OFFICES.OFFICE_FCD as CN38_OFFICE_ORIGIN ,DES_OFF.OFFICE_FCD as CN38_OFFICE_DESTINATIONS 												,C_OFFICES.COUNTRY_CD ,DES_OFF.COUNTRY_CD as COUNTRY_DESTINATION 												,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as [DESPTCH_DEPARTURE_DT] --,substring(R.RECPTCL_FID,17,4) as DISP_NO 												---------L_CONSGNTS--- 												,L_CONSGNTS.CONSGNT_FID as CONSGNT_FID  												,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end as CN38_TYPEOFMAIL 												,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1) as CN38_MAIL_SUBCLASS   												,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS 												,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_DATE_OF_DEPART 												,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_TIME_OF_DEPART 												,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) as AIRPORT_OF_DIRECT_TRANSHIPMENT 												,substring(L_LEGS.DEST_LOCATION_FCD,3,3) as AIRPORT_OF_OFFLOADING 												,DEST_LOCATION.LOCATION_FCD 												,sum(R.RECPTCL_WEIGHT) as RECPTCL_WEIGHT  						from				[MonitasDB].[dbo].L_RECPTCLS R								 						inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 						LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 						LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 						INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  						INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  						INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 						INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  						INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 						inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 						left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID 		 					 						WHERE				L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%'  						and					L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ='A' 						and					substring(R.RECPTCL_FID,14,2) not like ('%T')  and substring(R.RECPTCL_FID,21,3) not like ('T%') 						and					L_ROUTES_LEGS.LEG_ORDER_NO = 0  						and					L_CONSGNTS.ORIG_OFFICE_FCD like 'THBKK%'  						and					substring(RECPTCL_FID,1,6) like 'THBKK%'  						--and					substring(RECPTCL_FID,7,6) like 'SKBTS%' 						--and CONSGNT_FID = 'THBKKA111700'  			GROUP BY		C_OFFICES.OPERATOR_CD  ,DES_OFF.OPERATOR_CD  							,C_OFFICES.OFFICE_FCD  ,DES_OFF.OFFICE_FCD  							,C_OFFICES.COUNTRY_CD ,DES_OFF.COUNTRY_CD  							,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT  --,substring(R.RECPTCL_FID,17,4) as DISP_NO 							---------L_CONSGNTS--- 							,L_CONSGNTS.CONSGNT_FID  							,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end  							,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1)  							,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','')  							,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 							,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) 							,substring(L_LEGS.DEST_LOCATION_FCD,3,3)  							,DEST_LOCATION.LOCATION_FCD 					  ) AS A  	LEFT OUTER JOIN 				( select				C_OFFICES.OPERATOR_CD as CN38_POSTAL_DESIGNATED_OPER_ORIGIN ,DES_OFF.OPERATOR_CD as OPERATOR_OF_DESTINATION 										,C_OFFICES.OFFICE_FCD as CN38_OFFICE_ORIGIN ,DES_OFF.OFFICE_FCD as CN38_OFFICE_DESTINATIONS 										,C_OFFICES.COUNTRY_CD ,DES_OFF.COUNTRY_CD as COUNTRY_DESTINATION 										,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as [DESPTCH_DEPARTURE_DT] --,substring(R.RECPTCL_FID,17,4) as DISP_NO 										---------L_CONSGNTS--- 										,L_CONSGNTS.CONSGNT_FID as CONSGNT_FID  										,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end as CN38_TYPEOFMAIL 										,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1) as CN38_MAIL_SUBCLASS   										,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS_DEST 										,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_DATE_OF_DEPART 										,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_TIME_OF_DEPART 										,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) as AIRPORT_OF_DIRECT_TRANSHIPMENT 										,substring(L_LEGS.DEST_LOCATION_FCD,3,3) as AIRPORT_OF_OFFLOADING 										,DEST_LOCATION.LOCATION_FCD 										,sum(R.RECPTCL_WEIGHT) as RECPTCL_WEIGHT  				from				[MonitasDB].[dbo].L_RECPTCLS R								 						inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 						LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 						LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 						INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  						INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  						INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 						INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  						INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 						inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 						left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID 						INNER JOIN          [MonitasDB].[dbo].L_MAILITMS ON L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID 					 						WHERE				L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%'  						and					L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ='A' 						and					substring(R.RECPTCL_FID,14,2) not like ('%T')  and substring(R.RECPTCL_FID,21,3) not like ('T%') 						and					L_ROUTES_LEGS.LEG_ORDER_NO = 1  						and					L_CONSGNTS.ORIG_OFFICE_FCD like 'THBKK%'  						and					substring(RECPTCL_FID,1,6) like 'THBKK%'  						--and					substring(RECPTCL_FID,7,6) like 'SKBTS%' 						--and					year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) ='2022' 						--and					month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '01' and '08' 						--and					day(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) ='26'				 						--and L_CONSGNTS.CONSGNT_FID ='THBKKC449096' 						--and					substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) in('2001') 			GROUP BY		C_OFFICES.OPERATOR_CD  ,DES_OFF.OPERATOR_CD  							,C_OFFICES.OFFICE_FCD  ,DES_OFF.OFFICE_FCD  							,C_OFFICES.COUNTRY_CD ,DES_OFF.COUNTRY_CD  							,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT  --,substring(R.RECPTCL_FID,17,4) as DISP_NO 							---------L_CONSGNTS--- 							,L_CONSGNTS.CONSGNT_FID  							,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end  							,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1)  							,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','')  							,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 							,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) 							,substring(L_LEGS.DEST_LOCATION_FCD,3,3)  							,DEST_LOCATION.LOCATION_FCD 			 				) AS B 	ON					A.DESPTCH_DEPARTURE_DT = B.DESPTCH_DEPARTURE_DT  AND A.CONSGNT_FID = B.CONSGNT_FID 	AND					A.MAIL_CATEGORY_CD = B.MAIL_CATEGORY_CD 	AND					A.LOCATION_FCD = B.LOCATION_FCD  	and					A.COUNTRY_CD = B.COUNTRY_CD AND A.COUNTRY_DESTINATION = B.COUNTRY_DESTINATION 	AND					A.CN38_OFFICE_DESTINATIONS = B.CN38_OFFICE_DESTINATIONS 	AND					A.CN38_OFFICE_ORIGIN = B.CN38_OFFICE_ORIGIN  	WHERE				year(A.[DESPTCH_DEPARTURE_DT]) = '2024' 	--and					month(A.[DESPTCH_DEPARTURE_DT]) = '12' 	--and A.CONSGNT_FID = 'THBKKA111700'  	and  concat(A.CONSGNT_FID, convert(date,A.DESPTCH_DEPARTURE_DT) ) collate thai_ci_as not in (select  concat(CONSIGNMENT_ID,[CN38_DATE])  from TR_CPP_CN38_MAIN where [CN38_DATE] = convert(date,A.DESPTCH_DEPARTURE_DT) ) 	and A.CONSGNT_FID collate thai_ci_as not in (select [CONSIGNMENT_ID] from TR_CPP_CN38_MAIN where DEL_FLAG ='N') 	 	 	ORDER BY  A.CN38_OFFICE_ORIGIN ,A.CN38_OFFICE_DESTINATIONS  						,A.[DESPTCH_DEPARTURE_DT] ,A.CONSGNT_FID  END ",81848,130904,-49056,2740562,245,81848
"    -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_T_EMS_CN31_CN33_DETAIL]  	 AS BEGIN 	--TRUNCATE TABLE T_EMS_CN31_CN33_DETAIL;  -- +  +  +   +   + รายจ่าย +  +  +  +  +  +  +  	INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 				([DISPATCHING_ID],[CN31EMS_SEQ], RKEY, 				[BAG_NO], [ITEMS_ID] ,[OFFICE_LODGING] ,[ITEM_WEIGHT] 				,RECPTCL_WEIGHT,RECPTCL_ITEMS ,RECPTCL_FID 				,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 				,[CREATE_USER_ID] ,[CREATE_DATE] ,[UPDATE_USER_ID],[UPDATE_DATE] 				) 	SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   --and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 	   and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID and L_MAILITMS.MAIL_CLASS_CD = 'E' 	 INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = L_MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	  where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 not in			(select RKEY   								from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 								and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 								--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between '2023-01-01' and '2023-12-31' 								where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  								) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3) 	     -- +  +  +   +   + รายได้ +  +  +  +  +  +  + 	 	 /*+    +    +    + TMP1    +     +     +*/  INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 					([DISPATCHING_ID],[CN31EMS_SEQ],RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]   					) SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID,T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ, T_EMS_CN31_CN33_DETAIL_TMP1.[RKEY] as RKEY , 				T_EMS_CN31_CN33_DETAIL_TMP1.[BAG_NO],T_EMS_CN31_CN33_DETAIL_TMP1.[RECPTCL_WEIGHT] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[RECPTCL_ITEMS],T_EMS_CN31_CN33_DETAIL_TMP1.[RECPTCL_FID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[ITEMS_ID]  ,T_EMS_CN31_CN33_DETAIL_TMP1.[ITEM_WEIGHT] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[OFFICE_LODGING]			 			   			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[OBSERVATION]  ,T_EMS_CN31_CN33_DETAIL_TMP1.[DEL_FLAG] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[RECORD_STATUS] 			,T_EMS_CN31_CN33_DETAIL_TMP1.[CREATE_USER_ID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[CREATE_DATE] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[UPDATE_USER_ID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[UPDATE_DATE] 			  			     FROM [dbo].[T_EMS_CN31_CN33_DETAIL_TMP1]   inner join [dbo].[T_EMS_CN31_CN33_MAIN] ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = T_EMS_CN31_CN33_DETAIL_TMP1.[DISPATCHING_ID]   WHERE  convert(date,T_EMS_CN31_CN33_DETAIL_TMP1.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month   and    T_EMS_CN31_CN33_DETAIL_TMP1.[RKEY]    not in  (select RKEY   			from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 			and T_EMS_CN31_CN33_MAIN.DEL_FLAG ='N' and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE='I' 			--where   convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between '2023-01-01' and '2023-12-31' 			where   convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			)      /*+    +    +    + TMP2    +     +     +*/  INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 					([DISPATCHING_ID],[CN31EMS_SEQ],RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]   					) SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID,T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ, T_EMS_CN31_CN33_DETAIL_TMP2.[RKEY] as RKEY , 				T_EMS_CN31_CN33_DETAIL_TMP2.[BAG_NO],T_EMS_CN31_CN33_DETAIL_TMP2.[RECPTCL_WEIGHT] 			  ,T_EMS_CN31_CN33_DETAIL_TMP2.[RECPTCL_ITEMS],T_EMS_CN31_CN33_DETAIL_TMP2.[RECPTCL_FID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP2.[ITEMS_ID]  ,T_EMS_CN31_CN33_DETAIL_TMP2.[ITEM_WEIGHT] 			  ,T_EMS_CN31_CN33_DETAIL_TMP2.[OFFICE_LODGING]			 			   			  ,T_EMS_CN31_CN33_DETAIL_TMP2.[OBSERVATION]  ,T_EMS_CN31_CN33_DETAIL_TMP2.[DEL_FLAG] 			  ,T_EMS_CN31_CN33_DETAIL_TMP2.[RECORD_STATUS] 			,T_EMS_CN31_CN33_DETAIL_TMP2.[CREATE_USER_ID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP2.[CREATE_DATE] 			  ,T_EMS_CN31_CN33_DETAIL_TMP2.[UPDATE_USER_ID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP2.[UPDATE_DATE] 			  			     FROM [dbo].[T_EMS_CN31_CN33_DETAIL_TMP2]   inner join [dbo].[T_EMS_CN31_CN33_MAIN] ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = T_EMS_CN31_CN33_DETAIL_TMP2.[DISPATCHING_ID]   WHERE  convert(date,T_EMS_CN31_CN33_DETAIL_TMP2.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month   and T_EMS_CN31_CN33_DETAIL_TMP2.[RKEY]    not in  (select RKEY   			from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 			and T_EMS_CN31_CN33_MAIN.DEL_FLAG ='N' and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE='I' 			--where   convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between '2024-01-01' and '2024-03-31' 			where   convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			) 	 	 	/*select		distinct T_EMS_CN31_CN33_MAIN.DISPATCHING_ID as DISPATCHING_ID ,T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ , 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,case when TRIM(EM.MAILITM_FID) is null then trim(M.MAILITM_FID) else TRIM(EM.MAILITM_FID) end)  collate thai_ci_as as RKEY 						,case when RE_EDI.RECPTCL_FID is null then substring(R.RECPTCL_FID,21,3) else  substring(RE_EDI.RECPTCL_FID,21,3) end  as [BAG_NO] 						,case when RE_EDI.RECPTCL_FID is null then R.RECPTCL_WEIGHT else  RE_EDI.RECPTCL_WEIGHT end  as RECPTCL_WEIGHT	 						,case when RE_EDI.RECPTCL_FID is null then R.RECPTCL_MAILITMS_NO else  RE_EDI.RECPTCL_MAILITMS_NO end  as RECPTCL_MAILITMS_NO	 						,case when RE_EDI.RECPTCL_FID is null then R.RECPTCL_FID else  RE_EDI.RECPTCL_FID end  as RECPTCL_FID 						,case when TRIM(EM.MAILITM_FID) is null then trim(M.MAILITM_FID) else TRIM(EM.MAILITM_FID) end as MAILITM_FID 						,case when TRIM(EM.MAILITM_FID) is null then M.MAILITM_WEIGHT else EM.MAIL_WEIGHT end as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA  	LEFT OUTER JOIN		[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 	and					RE_EDI.RECPTCL_MAILITMS_NO is not null and	substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 	LEFT OUTER JOIN		[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20)  	--and					SUBSTRING(RE_EDI.RECPTCL_FID,1,23) = SUBSTRING(R.RECPTCL_FID,1,23) 	 and				substring(R.RECPTCL_FID,21,3) not like 'T%'  	and					R.RECPTCL_MAILITMS_NO  is not null 	LEFT OUTER JOIN		[MonitasDB].[dbo].N_EDI_MAILITMS as EM ON RE_EDI.RECPTCL_PID = EM.RECPTCL_PID and EM.MAILITM_FID is not null 	LEFT OUTER JOIN		[MonitasDB].[dbo].L_MAILITMS as M ON M.EVT_RECPTCL_PID = R.RECPTCL_PID and M.MAILITM_FID is not null 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on M.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)    	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-01-31' 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 		 	and  concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,case when TRIM(EM.MAILITM_FID) is null then trim(M.MAILITM_FID) else TRIM(EM.MAILITM_FID) end)  collate thai_ci_as not in (select RKEY   								from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 								and T_EMS_CN31_CN33_MAIN.DEL_FLAG ='N' and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE='I' 								where year(T_EMS_CN31_CN33_MAIN.DESPTCH_DATE)= '2023' and month(T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) = '01') 	*/ 		 		 		 		 		 		/*	select		distinct T_EMS_CN31_CN33_MAIN.DISPATCHING_ID as DISPATCHING_ID ,T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ 						,case when RE_EDI.RECPTCL_FID is null then substring(R.RECPTCL_FID,21,3) else  substring(RE_EDI.RECPTCL_FID,21,3) end  as [BAG_NO] 						,case when RE_EDI.RECPTCL_FID is null then R.RECPTCL_WEIGHT else  RE_EDI.RECPTCL_WEIGHT end  as RECPTCL_WEIGHT	 						,case when RE_EDI.RECPTCL_FID is null then R.RECPTCL_MAILITMS_NO else  RE_EDI.RECPTCL_MAILITMS_NO end  as RECPTCL_MAILITMS_NO	 						,case when RE_EDI.RECPTCL_FID is null then R.RECPTCL_FID else  RE_EDI.RECPTCL_FID end  as RECPTCL_FID 						,case when TRIM(EM.MAILITM_FID) is null then trim(M.MAILITM_FID) else TRIM(EM.MAILITM_FID) end as MAILITM_FID 						,case when TRIM(EM.MAILITM_FID) is null then M.MAILITM_WEIGHT else EM.MAIL_WEIGHT end as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA  	LEFT OUTER JOIN		[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 	LEFT OUTER JOIN		[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	LEFT OUTER JOIN		[MonitasDB].[dbo].N_EDI_MAILITMS as EM ON RE_EDI.RECPTCL_PID = EM.RECPTCL_PID 	LEFT OUTER JOIN		[MonitasDB].[dbo].L_MAILITMS as M ON M.EVT_RECPTCL_PID = R.RECPTCL_PID 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on M.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'FIHE%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-01-31' 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 		 			--and				case when RE_EDI.RECPTCL_FID is null then R.RECPTCL_FID else  RE_EDI.RECPTCL_FID end  collate thai_ci_as 			--not in			(select T_EMS_CN31_CN33_DETAIL.RECPTCL_FID   			--					from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 							 			--					where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between  '2023-01-01' and '2023-01-31' 			--					--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 							 			--					) 		 			and					substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 			and case when RE_EDI.RECPTCL_FID is null then R.RECPTCL_MAILITMS_NO else  RE_EDI.RECPTCL_MAILITMS_NO end is not null 			--and                 L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID like '%40008' 		ORDER BY			T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,case when RE_EDI.RECPTCL_FID is null then substring(R.RECPTCL_FID,21,3) else  substring(RE_EDI.RECPTCL_FID,21,3) end*/  END ",56619,365722,-309103,3245914,1370,56619
"select		 * 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	--inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	--INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 	--									 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 	--									 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 	--									max(state_ind_cd) as state_ind_cd , 	--									max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 	--					from			[MonitasDB].[dbo].L_MAILITMS  	--					where			trim(MAILITM_FID) = 'EE194931558TH' 	--					GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 	--									 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 	--									 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	--ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	--INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	--INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	--LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	--INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	--AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 			--and			trim(L_MAILITMS.MAILITM_FID) = 'EE194931558TH'			 		--	order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)",45740,21878,23862,110985,0,45740
"SELECT			TR_BGS_CN66_MAIN.CN66_SEQ ,CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID) as CN66_PK 				, day([CN38_DATE_OF_DEPART]) as [CN66_DATE] ,CN38_DESP_SERIAL_NO 				,C_OFFICES.OFFICE_SEQ as CN66_DISP_OFFICE,DEST_OFFICE.OFFICE_SEQ as CN66_DESTINATION 				,TR_BGS_CN66_MAIN.CN66_FLIGHT_NO ,TR_BGS_CN66_MAIN.CN66_SUB_CLASS,  				sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) as  CN38_GROSS_WEIGHT_LETTER_POST 				,case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS 				else 0 end as [CN66_RATE_LCAO]    				,sum([CN38_GROSS_WEIGHT_CP]) as CN38_GROSS_WEIGHT_CP 				,case when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS  				else 0 end as [CN66_RATE_CP] 				,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID  				,(case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 then sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST)  				  * case when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum(CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS 				else 0 end 						else sum([CN38_GROSS_WEIGHT_CP]) * case when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C')  						then [R_AIRMAIL] 					  when sum([CN38_GROSS_WEIGHT_CP]) <> 0 and  substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) ='E'  						then R_EMS  				else 0 end end) as OB 				,'N' as DEL_FLAG,'A' as RECORD_STATUS,1 as CREATE_USER_ID,getdate()  as CREATE_DATE  FROM [dbo].[TR_BGS_CN38A_MAIN]   INNER JOIN (SELECT distinct [CN38_SEQ] ,[CN38_OFFICE_ORIGIN] ,[CN38_OFFICE_DESTINATION],[CN38_MAIL_CATEGORY] 				,[CN38_YEAR],[CN38_DESP_SERIAL_NO],DEL_FLAG  ,[CN38_TOT_IN_DISP] ,[CN38_GROSS_WEIGHT_LETTER_POST],[CN38_GROSS_WEIGHT_CP] 				FROM [dbo].[TR_BGS_CN38A_DETAIL] 				where TR_BGS_CN38A_DETAIL.CN38_RECP_SERIAL_NO = '0' and [DEL_FLAG] ='N') as CN38_DETAIL  ON CN38_DETAIL.CN38_SEQ = TR_BGS_CN38A_MAIN.CN38_SEQ  INNER JOIN  [dbo].[C_OFFICES] ON TR_BGS_CN38A_MAIN.CN38_OFFICE_ORIGIN = C_OFFICES.OFFICE_SEQ    INNER JOIN  [dbo].[C_COUNTRIES] ON C_OFFICES.COUNTRY_CD = C_COUNTRIES.COUNTRY_CD   INNER JOIN  [dbo].[C_OFFICES] as DEST_OFFICE ON DEST_OFFICE.OFFICE_SEQ = TR_BGS_CN38A_MAIN.CN38_OFFICE_DESTINATIONS  INNER JOIN  [dbo].[C_COUNTRIES] as DEST_COUNTRY ON DEST_OFFICE.COUNTRY_CD = DEST_COUNTRY.COUNTRY_CD   LEFT OUTER JOIN (SELECT   distinct  [R_DES_CODE] ,[R_DES_FLIGHT_NO],[R_CON_CODE],[R_CON_FLIGHT_NO], 							 [R_AGENT] ,R_CURRENCY ,[R_VALID_DATE], R_INVALID_DATE,R_DAY 							,R_EMS 							,[R_AIRMAIL]  							,case when [R_AIRMAIL] is null then 'E'  								  when R_EMS is null then 'U' 								  when R_EMS is not null and [R_AIRMAIL] is not null then 'EU' else null end R_TYPE 					  FROM [dbo].[TR_BGS_RATEA_MAIN] 					  where  DEL_FLAG='N' and [R_AGENT] is not null ) as RATE_AIR  	ON RATE_AIR.R_DES_CODE = (substring([CN38_DEST_LOCATION],1,2)+'-'+[CN38_AIRPORT_OF_OFFLOADING]) 	  and case when CHARINDEX('/',[CN38_FLIGHTNO])=0 then [CN38_FLIGHTNO] else substring([CN38_FLIGHTNO],1, CHARINDEX('/',[CN38_FLIGHTNO])-1) end = [R_DES_FLIGHT_NO]  	  and case when CHARINDEX('/',[CN38_FLIGHTNO])=0 then '-' else substring([CN38_FLIGHTNO],CHARINDEX('/',[CN38_FLIGHTNO])+1,6) end = ISNULL([R_CON_FLIGHT_NO],'-')  	  and convert(date,CN38_DATE_OF_DEPART) between convert(date,R_VALID_DATE) and convert(date,R_INVALID_DATE)  	  and (case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = R_TYPE  			  OR case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = substring(R_TYPE,1,1) 			  OR case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = substring(R_TYPE,2,1)) 	  and case when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Monday' then '1' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Tuesday' then '2' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Wednesday' then '3' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Thursday' then '4' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Friday' then '5' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Saturday' then '6' 					when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Sunday' then '7' 					else '0' 					end = RATE_AIR.R_DAY      inner join TR_BGS_CN66_MAIN ON [CN38_FLIGHTNO] = [CN66_FLIGHT_NO]    and case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY = 'A' then 'U' else 'E' end = TR_BGS_CN66_MAIN.CN66_MAIL_CLASS    and TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS = TR_BGS_CN66_MAIN.CN66_SUB_CLASS    and [CN38_ROUTE] = [CN66_ROUTE]  and TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY = TR_BGS_CN66_MAIN.CN66_BY     and month([CN38_DATE_OF_DEPART]) = [CN66_MONTH] and year([CN38_DATE_OF_DEPART]) = [CN66_YEAR]  and TR_BGS_CN66_MAIN.[CN66_DEST_LOCATION] = [CN38_DEST_LOCATION]  and ISNULL(TR_BGS_CN66_MAIN.CN66_AGENT,'-') = ISNULL(RATE_AIR.R_AGENT,'-')     WHERE TR_BGS_CN38A_MAIN.DEL_FLAG='N' and TR_BGS_CN66_MAIN.CN66_SERVICE_TYPE ='AIR'     and  TR_BGS_CN38A_MAIN.[CN38_MAIL_CATEGORY] in('A','E')   and TR_BGS_CN66_MAIN.FLOW_STATUS ='DRAFT'    AND year(CN38_DATE_OF_DEPART) = '2024'  and month([CN38_DATE_OF_DEPART]) in('02')  and CONCAT(CN38_DESP_SERIAL_NO,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)   not in (select concat([CN66_MAIL_NO],[CN66_CONSIGNMENT_ID])  from TR_BGS_CN66_DETAIL)  -- and CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)='20772716195817UTHBKKC467881'    group by TR_BGS_CN66_MAIN.CN66_SEQ ,CONCAT(CN38_DESP_SERIAL_NO,C_OFFICES.OFFICE_SEQ,DEST_OFFICE.OFFICE_SEQ,day([CN38_DATE_OF_DEPART]),TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID)  				, day([CN38_DATE_OF_DEPART])  ,CN38_DESP_SERIAL_NO 				,C_OFFICES.OFFICE_SEQ ,DEST_OFFICE.OFFICE_SEQ  				,TR_BGS_CN66_MAIN.CN66_FLIGHT_NO ,TR_BGS_CN66_MAIN.CN66_SUB_CLASS,TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS 				,[R_AIRMAIL],R_EMS,TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID   ORDER BY  day([CN38_DATE_OF_DEPART]),CN38_DESP_SERIAL_NO ",45018,44931,87,2951970,8,45018
"select		T_EMS_CN31_CN33_MAIN.DISPATCHING_ID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat( L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(EM.MAILITM_FID)) as RKEY 						, substring(RE_EDI.RECPTCL_FID,21,3)  as [BAG_NO] 						--,case when R.RECPTCL_WEIGHT is null then RE_EDI.RECPTCL_WEIGHT else R.RECPTCL_WEIGHT end   as RECPTCL_WEIGHT	 						,RE_EDI.RECPTCL_WEIGHT 						,RE_EDI.RECPTCL_MAILITMS_NO   as RECPTCL_MAILITMS_NO	 						,RE_EDI.RECPTCL_FID   as RECPTCL_FID 						,TRIM(EM.MAILITM_FID)  as MAILITM_FID 						,EM.MAIL_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						,case when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,2) then 'Normal'  						      when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,2) then 'Being returned' 						  else 'Transit' end as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA  	INNER JOIN		[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 	and					substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 	and  RE_EDI.RECPTCL_MAILITMS_NO  is not null  	INNER JOIN		[MonitasDB].[dbo].N_EDI_MAILITMS as EM ON RE_EDI.RECPTCL_PID = EM.RECPTCL_PID and trim(EM.MAILITM_FID) is not null 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2023' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 		 --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-04-01' and '2024-04-20' 		and     concat( L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(EM.MAILITM_FID))  collate THAI_CI_AS 			not in (select RKEY from T_EMS_CN31_CN33_DETAIL_TMP2  						where convert(date,DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 					)	 			--and   RE_EDI.RECPTCL_FID like '%40025%' 			order by RECPTCL_FID ,TRIM(EM.MAILITM_FID)",43240,171972,-128732,2099421,636,43240
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 				([DISPATCHING_ID],[CN31EMS_SEQ], RKEY, 				[BAG_NO], [ITEMS_ID] ,[OFFICE_LODGING] ,[ITEM_WEIGHT] 				,RECPTCL_WEIGHT,RECPTCL_ITEMS ,RECPTCL_FID 				,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 				,[CREATE_USER_ID] ,[CREATE_DATE] ,[UPDATE_USER_ID],[UPDATE_DATE] 				) SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   --and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 	   --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	  and  convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-01-31' 	LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID and L_MAILITMS.MAIL_CLASS_CD = 'E' 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	  where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 not in			(select RKEY   								from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 								and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 								where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between '2024-01-01' and '2024-01-31' 								--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  								) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE199530208TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",41299,296039,-254740,17388535,19,41299
"SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   --and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 	   --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	  and  convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-01-31' 	LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID and L_MAILITMS.MAIL_CLASS_CD = 'E' 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	  where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 not in			(select RKEY   								from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 								and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 								where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between '2024-01-01' and '2024-01-31' 								--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  								) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE199530208TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",31683,247454,-215771,17387784,0,31683
"select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 										case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID 							 from    MonitasDB.[dbo].[L_MAILITMS]  							 left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  												FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 												WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 												GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 											)  							 AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 							and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT 							 where year(CAPTURE_DT)='2023'",29784,60823,-31039,9597060,0,29784
"     CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CP87_DETAIL_SURFACE]  	 AS BEGIN 	  ----+  +   +  +   +   +   รายได้ +  +   +INSERT INTO [IASDB].[dbo].[TR_CPP_CP87_DETAIL] 		INSERT INTO [dbo].[TR_CPP_CP87_DETAIL] 			 ([CP87_SEQ],[DISPATCHIN_ID] 			  ,[PARCEL_ID] 			  ,[ORIGIN_COUNTRY] 			  ,[DESTINATION_COUNTRY] 			  ,[WEIGHT_KG]  			  ,LAND_SEA_RATE_DISP  			  ,LAND_SEA_RATE_RECEIVING ,AIR_CONVEYANCE_DUES_DISP ,AIR_CONVEYANCE_DUES_RECEIVING ,POSTAL_STATUS_NM 			  ,[OBSERVATIONS]  ,[SERVICE_TYPE] 			  ,[DEL_FLAG] 			  ,[RECORD_STATUS] 			  ,[CREATE_DATE] ,[CREATE_USER_ID] 			  ,[UPDATE_DATE] ,[UPDATE_USER_ID]       			  ,[FORM_SUBMIT_ID]       			  ,[REQUEST_EDIT_STATUS] 			   )  		SELECT				TR_CPP_CP87_MAIN.CP87_SEQ ,L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as [DISPATCHIN_ID]  							,TRIM(N_EDI_MAILITMS.MAILITM_FID) as MAILITM_FID 							,case when N_EDI_MAILITMS.ORIG_COUNTRY_CD is null then substring(N_EDI_MAILITMS.MAILITM_FID,12,2) else N_EDI_MAILITMS.ORIG_COUNTRY_CD end as ORIG_COUNTRY_CD  							, case when N_EDI_MAILITMS.DEST_COUNTRY_CD is null then 'TH' else N_EDI_MAILITMS.DEST_COUNTRY_CD end as M_DEST_COUNTRY 							/*,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Being returned' then DEST_OFFICE.COUNTRY_CD 									when C_POSTAL_STATUSES.POSTAL_STATUS_NM in('In transit here','Out of Course','Being returned/redirected in transit here') then N_EDI_MAILITMS.ORIG_COUNTRY_CD  collate Thai_CI_AS 							else C_OFFICES.COUNTRY_CD end as ORIGIN_COUNTRY										 							,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Being returned' then N_EDI_MAILITMS.DEST_COUNTRY_CD 									when C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Sent A decouvert' then N_EDI_MAILITMS.DEST_COUNTRY_CD collate Thai_CI_AS 									when C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Being returned/redirected in transit here' then N_EDI_MAILITMS.DEST_COUNTRY_CD collate Thai_CI_AS 							else DEST_OFFICE.COUNTRY_CD  end as  DEST_COUNTRY_CD*/  							,dbo.RoundUp(ISNULL(N_EDI_MAILITMS.MAIL_WEIGHT,0),1) as MAIL_WEIGHT 							,COL6 ,COL7 ,COL8 ,COL9 ,POSTAL_STATUS_NM 							,C_MONTH.MONTH_NAME_EN_ABR 							,TR_CPP_CP87_MAIN.SERVICE_TYPE	  							 ,'N' as [DEL_FLAG] 							 ,'A' as [RECORD_STATUS] 							 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 							 ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  							 ,1 as [FORM_SUBMIT_ID] 							 ,1 as [REQUEST_EDIT_STATUS]   			 		FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA		 		INNER JOIN				[MonitasDB].[dbo].N_EDI_RECPTCLS as N_EDI_RECPTCLS on L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(N_EDI_RECPTCLS.RECPTCL_FID,1,20) 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 		INNER JOIN				[MonitasDB].[dbo].N_EDI_MAILITMS on N_EDI_RECPTCLS.RECPTCL_PID = N_EDI_MAILITMS.RECPTCL_PID			 		LEFT OUTER JOIN			[MonitasDB].[dbo].L_MAILITMS on L_MAILITMS.MAILITM_FID = N_EDI_MAILITMS.MAILITM_FID	 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 		LEFT OUTER JOIN			[MonitasDB].[dbo].L_PARCELS ON L_PARCELS.MAILITM_PID = L_MAILITMS.MAILITM_PID 		INNER JOIN				C_MONTH ON C_MONTH.MONTH_SEQ = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 		INNER JOIN				C_OFFICES ON L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD = C_OFFICES.OFFICE_FCD  collate Thai_CI_AS 		INNER JOIN				C_OFFICES as DEST_OFFICE ON  L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD = DEST_OFFICE.OFFICE_FCD  collate Thai_CI_AS 		INNER JOIN				[dbo].[TR_CPP_CP87_MAIN] ON TR_CPP_CP87_MAIN.DISPATCHIN_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate Thai_CI_AS		 		  		WHERE			 --convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 		convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 		--and				convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2021-01-01' and '2024-01-31' 		AND			L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD LIKE 'THBKK%'  --AND L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'CNCA%' 		--AND			month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '11' and '12' 		AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD = 'C' AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 		--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) = '0279' 		--and			TRIM(N_EDI_MAILITMS.MAILITM_FID)='CP234677581KR' 		and                concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,N_EDI_MAILITMS.MAILITM_FID) collate thai_ci_as 		not in             (select		concat(TR_CPP_CP87_DETAIL.DISPATCHIN_ID,TR_CPP_CP87_DETAIL.PARCEL_ID)   								from TR_CPP_CP87_DETAIL  								inner join TR_CPP_CP87_MAIN on TR_CPP_CP87_MAIN.CP87_SEQ = TR_CPP_CP87_DETAIL.CP87_SEQ   									where TR_CPP_CP87_DETAIL.DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.DEL_FLAG ='N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='C') 	 		ORDER BY      N_EDI_RECPTCLS.RECPTCL_FID   /*+    +    +    + รายจ่าย   +    +    +    +*/ 	INSERT INTO [dbo].[TR_CPP_CP87_DETAIL] 		 ([CP87_SEQ] 		  ,[PARCEL_ID],[DISPATCHIN_ID] 		  ,[ORIGIN_COUNTRY] 		  ,[DESTINATION_COUNTRY] 		  ,[WEIGHT_KG]  		  ,LAND_SEA_RATE_DISP  		  ,LAND_SEA_RATE_RECEIVING ,AIR_CONVEYANCE_DUES_DISP ,AIR_CONVEYANCE_DUES_RECEIVING ,POSTAL_STATUS_NM 		  ,[OBSERVATIONS]  ,[SERVICE_TYPE] 		  ,[DEL_FLAG] 		  ,[RECORD_STATUS] 		  ,[CREATE_DATE] ,[CREATE_USER_ID] 		  ,[UPDATE_DATE] ,[UPDATE_USER_ID]       		  ,[FORM_SUBMIT_ID]       		  ,[REQUEST_EDIT_STATUS] 		   )  	SELECT  TR_CPP_CP87_MAIN.CP87_SEQ,  			ORIGIN.MAILITM_FID   ,ORIGIN.DESPTCH_FID 			,case when ORIGIN.POSTAL_STATUS_NM ='Being returned' then ORIGIN.DEST_COUNTRY 				  when ORIGIN.POSTAL_STATUS_NM in('In transit here','Out of Course','Being returned/redirected in transit here') then ORIGIN.M_ORIGIN_COUNTRY collate Thai_CI_AS 			else ORIGIN.ORIGIN_COUNTRY end as ORIGIN_COUNTRY  			,case when ORIGIN.POSTAL_STATUS_NM ='Being returned' then M_DEST_COUNTRY_CD 				  when ORIGIN.POSTAL_STATUS_NM ='Sent A decouvert' then M_DEST_COUNTRY_CD collate Thai_CI_AS 				  when ORIGIN.POSTAL_STATUS_NM ='Being returned/redirected in transit here' then M_DEST_COUNTRY_CD collate Thai_CI_AS 			else ORIGIN.DEST_COUNTRY  end as  DEST_COUNTRY_CD  			,[dbo].[RoundUp](ISNULL(ORIGIN.MAILITM_WEIGHT,0),1) as MAILITM_WEIGHT 			,COL6 ,COL7 ,COL8 ,COL9 ,POSTAL_STATUS_NM ,C_MONTH.MONTH_NAME_EN_ABR  ,TR_CPP_CP87_MAIN.SERVICE_TYPE 			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 		 ,getdate() as [UPDATE_DATE]  ,99 as [UPDATE_USER_ID]  		  ,0 as [FORM_SUBMIT_ID]  		  ,0 as [REQUEST_EDIT_STATUS]        	FROM (  	SELECT L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DESPTCH_FID 		  ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD ,L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD 		  ,L_ACC_DESPTCH_RAW_DATA.CONVEYANCE_TYPE_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD 		  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT , month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DT_MONTH	   		  ,L_ACC_DESPTCH_RAW_DATA.STATE_IND_CD --,L_CONSGNTS.CONSGNT_FID 		  ,C_OFFICES.OPERATOR_CD as ORIGIN_OPER, DES_OFF.OPERATOR_CD as DEST_OPER 		  ,C_OFFICES.COUNTRY_CD as ORIGIN_COUNTRY ,DES_OFF.COUNTRY_CD as DEST_COUNTRY 		---- Receptcls ------------------- 		   ,R.[RECPTCL_PID],R.[RECPTCL_OWNERSHIP_CD],R.[RECPTCL_FID],R.[RECPTCL_WEIGHT] 		  ,R.[RECPTCL_MAILITMS_NO],R.[RECPTCL_CONTENT_FORMAT_CD],R.[RECPTCL_SUB_TYPE_CD] 		   ,case when RECPTCL_SUB_TYPE_CD = 'BG' then 1 else 0 end as BAG_AMT 		  ,case when RECPTCL_SUB_TYPE_CD = 'PC' then 1 else 0 end as OTHER_AMT 		  ,R.[STATE_IND_CD] as RECEP_STATE_IND,R.[POSTAL_STATUS_CD],R.[EVT_TYPE_CD],R.[EVT_CONSGNT_PID]  		  ,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS 			 ,MAILITMS.MAILITM_WEIGHT , MAILITMS.MAILITM_FID ,MAILITMS.DEST_COUNTRY_CD as M_DEST_COUNTRY_CD ,MAILITMS.ORIG_COUNTRY_CD as M_ORIGIN_COUNTRY 			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL6 else 0 end as COL6 			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL7 else 0 end as COL7  			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL8 else 0 end as COL8  			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL9 else 0 end as COL9 			,C_POSTAL_STATUSES.POSTAL_STATUS_NM 	   	  FROM     (select			L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when L_MAILITMS.EVT_RECPTCL_PID  is null then L_MAILITM_EVENTS.[RECPTCL_PID] else L_MAILITMS.EVT_RECPTCL_PID end  as RECPTCL_PID, 											max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT 							from			MonitasDB.[dbo].[L_MAILITMS]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID] and (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							group by		L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT  , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD 											,case when L_MAILITMS.EVT_RECPTCL_PID  is null then L_MAILITM_EVENTS.[RECPTCL_PID] else L_MAILITMS.EVT_RECPTCL_PID end 				   ) as MAILITMS 		--INNER JOIN     [MonitasDB].[dbo].L_MAILITM_EVENTS ON MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 		--AND				MAILITMS.CAPTURE_DT = L_MAILITM_EVENTS.CAPTURE_GMT_DT  	 INNER JOIN    [MonitasDB].[dbo].L_RECPTCLS R ON R.RECPTCL_PID = MAILITMS.RECPTCL_PID 	  INNER JOIN [MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  INNER JOIN [dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  	  INNER JOIN [dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	 LEFT OUTER JOIN [MonitasDB].[dbo].L_PARCELS ON L_PARCELS.MAILITM_PID = MAILITMS.MAILITM_PID 	 LEFT OUTER JOIN C_POSTAL_STATUSES on MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD  	  where  	  L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD = 'USJECS'  	   and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD = 'C' and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 	   and convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 	   --and convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 	  --and L_MAILITMS.POSTAL_STATUS_CD='0' 	  -- and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '11' and '12' 	  --and substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) between '0023' and '0025'     	 --ORDER BY L_DESPTCHS.[DESPTCH_FID],L_MAILITMS.MAILITM_FID 	  ) as ORIGIN  	INNER JOIN [dbo].[TR_CPP_CP87_MAIN] ON TR_CPP_CP87_MAIN.DISPATCHIN_ID = ORIGIN.[DESPTCH_FID] collate Thai_CI_AS 	/*INNER JOIN [dbo].[C_CPP_RATE_AIR] ON TR_CPP_CP87_MAIN.CP87_YEAR = C_CPP_RATE_AIR.CPP_RATE_YEAR  	AND ORIGIN.ORIGIN_COUNTRY = C_CPP_RATE_AIR.COUNTRY_ORIGIN_CD AND ORIGIN.DEST_COUNTRY = C_CPP_RATE_AIR.COUNTRY_DEST_CD*/ 	INNER JOIN C_MONTH ON C_MONTH.MONTH_SEQ = origin.DT_MONTH 	 --WHERE ORIGIN.MAILITM_FID='CP070711838TH' 	 WHERE                 concat(ORIGIN.DESPTCH_FID,ORIGIN.MAILITM_FID) collate thai_ci_as 	not in             (select concat(TR_CPP_CP87_DETAIL.DISPATCHIN_ID,TR_CPP_CP87_DETAIL.PARCEL_ID)  from TR_CPP_CP87_DETAIL  	                       inner join TR_CPP_CP87_MAIN on TR_CPP_CP87_MAIN.CP87_SEQ = TR_CPP_CP87_DETAIL.CP87_SEQ   						    where TR_CPP_CP87_DETAIL.DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.DEL_FLAG ='N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='C' 							and TR_CPP_CP87_MAIN.DESPTCH_DATE between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 							--and TR_CPP_CP87_MAIN.DESPTCH_DATE between '2024-03-01' and '2024-03-31' 							)  	 ORDER BY   ORIGIN.[DESPTCH_FID], ORIGIN.MAILITM_FID   END ",27029,49449,-22420,1357157,198,27029
"     -- ============================================= -- Author:		Umarin -- Create date: 21-12-2022 -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CP87_MAIN_SURFACE]  AS BEGIN  -- +  +  +   +   + รายได้ +  +  +  +  +  +  + INSERT INTO [dbo].[TR_CPP_CP87_MAIN]             ([DISPATCHIN_ID], [DISPATCHING_OPERATOR]            ,[DESTINATION_OPERATOR] , [ORIGIN_OFFICE], [DESTINATION_OFFICE] 		   ,[MAIL_CATEGORY] , [MAIL_SUBCLASS], [CP87_YEAR] , [DISPATCH_NO] 		   ,[DESPTCH_DATE] ,[TRANSPORTATION] ,[SERVICE_TYPE]  		    ,[BULK_WEIGHT_PARCEL] ,[BULK_PARCEL] 			,[DISPATCH_GROSS_WEIGHT] ,[DISPATCH_PAECEL] ,[DISPATCH_PARCEL_OUT] 		   ,[TOTAL_DIST_WEIGHT] ,[BAG_WEIGHT] 		    ,TOTAL_LAND_SEA_RATE_RECEIVING,TOTAL_AIR_CONVEYANCE_DUES_RECEIVING            ,RECEPT_BAG_AMT,RECEPT_OTHER_AMT,[RECEPTACLE_TOTAL]            ,[DEL_FLAG]            ,[RECORD_STATUS],[CREATE_DATE] , [CREATE_USER_ID] 		   ,[UPDATE_DATE] ,[UPDATE_USER_ID] ,[FORM_SUBMIT_ID] 		   ,[REQUEST_EDIT_STATUS]) SELECT				[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR ,DISP_NO 				  ,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,L_ACC_DESPTCH_STREAMS.WEIGHT_GROSS as  M_MAIL_WEIGHT 					,L_ACC_DESPTCH_STREAMS.NO_ITEMS as BULK_NO_OF_PARCEL 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM  ,DISPATCH_PARCEL_OUT 					,TOTAL_WEIGHT_GROSS ,[BAG_WEIGHT] 					   ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]  FROM ( 				SELECT		L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_PID,	L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as [DESPTCH_FID] ,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD 					, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD , L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 				  , L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD,YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DIST_YEAR 				  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as DISP_NO 				  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 					,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as [FLIGHT_TRIP_NUMBERS] 					,'I' as SERVICE_TYPE 					,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <>'Normal' then N_EDI_MAILITMS.MAIL_WEIGHT  					   else 0 end as Not_MAIL_WEIGHT ,N_EDI_MAILITMS.MAIL_WEIGHT 					,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <> 'Normal' then 1  					      else 0 end as Not_BULK_NO_OF_PARCEL 					 , L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS 					  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS as DISPATCH_NO_OF_ITEM 					  ,0 as DISPATCH_PARCEL_OUT 					  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS as TOTAL_DIST_WEIGHT 					  ,0 as [BAG_WEIGHT] 					  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPT_BAG_AMT 					  ,0 as RECEPT_OTHER_AMT 					  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]   			 	     FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 		LEFT OUTER JOIN			[MonitasDB].[dbo].N_EDI_RECPTCLS as N_EDI_RECPTCLS on L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(N_EDI_RECPTCLS.RECPTCL_FID,1,20) 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 		LEFT OUTER JOIN		    [MonitasDB].[dbo].N_EDI_MAILITMS on N_EDI_RECPTCLS.RECPTCL_PID = N_EDI_MAILITMS.RECPTCL_PID			 		LEFT OUTER JOIN		    [MonitasDB].[dbo].L_MAILITMS on L_MAILITMS.MAILITM_FID = N_EDI_MAILITMS.MAILITM_FID	 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 		 INNER JOIN				[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  		  INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  		  INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 		  INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = CO_DEST.[COUNTRY_CD] and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  		 		   		  	WHERE		--convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 	convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 	AND			L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD LIKE 'THBKK%'  --AND L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD = 'KRBUSA' 	--AND			MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '11' and '12' 	AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD in('C') AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 	--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) = '0178' 			) AS CP87_MAIN LEFT OUTER JOIN     [MonitasDB].[dbo].L_ACC_DESPTCH_STREAMS ON L_ACC_DESPTCH_STREAMS.ACC_DESPTCH_PID = CP87_MAIN.ACC_DESPTCH_PID and					L_ACC_DESPTCH_STREAMS.ACC_STREAM_ID = 201  WHERE			concat(CP87_MAIN.[DESPTCH_FID], CP87_MAIN.DISP_NO) 	not in      (select concat(TR_CPP_CP87_MAIN.DISPATCHIN_ID,[DISPATCH_NO]) collate thai_ci_as from TR_CPP_CP87_MAIN where DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='C')  GROUP BY	[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR 				  ,DISP_NO,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE	 				  ,L_ACC_DESPTCH_STREAMS.WEIGHT_GROSS  					,L_ACC_DESPTCH_STREAMS.NO_ITEMS  					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM 					  ,DISPATCH_PARCEL_OUT  ,[BAG_WEIGHT] 					  ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL   /*+   +    +    +   รายจ่าย +    +    +    +    +    +*/   INSERT INTO [dbo].[TR_CPP_CP87_MAIN]             ([DISPATCHIN_ID], [DISPATCHING_OPERATOR]            ,[DESTINATION_OPERATOR] , [ORIGIN_OFFICE], [DESTINATION_OFFICE] 		   ,[MAIL_CATEGORY] , [MAIL_SUBCLASS], [CP87_YEAR] , [DISPATCH_NO] 		   ,[DESPTCH_DATE] ,[TRANSPORTATION] ,[SERVICE_TYPE]  		    ,[BULK_WEIGHT_PARCEL] ,[BULK_PARCEL] 			,[DISPATCH_GROSS_WEIGHT] ,[DISPATCH_PAECEL] ,[DISPATCH_PARCEL_OUT] 		   ,[TOTAL_DIST_WEIGHT] ,[BAG_WEIGHT] 		   ,TOTAL_LAND_SEA_RATE_RECEIVING,TOTAL_AIR_CONVEYANCE_DUES_RECEIVING            ,RECEPT_BAG_AMT,RECEPT_OTHER_AMT,[RECEPTACLE_TOTAL]            ,[DEL_FLAG]            ,[RECORD_STATUS],[CREATE_DATE] , [CREATE_USER_ID] 		   ,[UPDATE_DATE] ,[UPDATE_USER_ID] ,[FORM_SUBMIT_ID] 		   ,[REQUEST_EDIT_STATUS])   SELECT				[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR ,DISP_NO 				  ,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,case when sum(Not_MAIL_WEIGHT) =0  then dbo.RoundUp(sum(MAILITM_WEIGHT),1) else dbo.RoundUp(TOTAL_WEIGHT_GROSS-sum(Not_MAIL_WEIGHT),1) end as  M_MAIL_WEIGHT 					,DISPATCH_NO_OF_ITEM-sum(Not_BULK_NO_OF_PARCEL) as BULK_NO_OF_PARCEL 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM  ,DISPATCH_PARCEL_OUT  					,TOTAL_WEIGHT_GROSS ,[BAG_WEIGHT] 					  ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]   FROM ( 				SELECT			L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_PID,	L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as [DESPTCH_FID] ,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD 					, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD , L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 					 , L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD,YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DIST_YEAR 				  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as DISP_NO 				  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 					,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as [FLIGHT_TRIP_NUMBERS] 					,'O' as SERVICE_TYPE 					,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <>'Normal' then L_MAILITMS.MAILITM_WEIGHT  									else 0 end  as Not_MAIL_WEIGHT ,L_MAILITMS.MAILITM_WEIGHT 									,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM <> 'Normal' then 1  										  else 0 end as Not_BULK_NO_OF_PARCEL 					 , L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS 					  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS as DISPATCH_NO_OF_ITEM 					  ,0 as DISPATCH_PARCEL_OUT 					  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS as TOTAL_DIST_WEIGHT 					  ,0 as [BAG_WEIGHT] 					  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPT_BAG_AMT 					  ,0 as RECEPT_OTHER_AMT 					  , L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as RECEPTACLE_TOTAL			  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS] 		    FROM					[MonitasDB].[dbo].L_RECPTCLS R    INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = substring(R.RECPTCL_FID,1,6) collate THAI_CI_AS    INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = substring(R.RECPTCL_FID,7,6) collate THAI_CI_AS    INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD   INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = CO_DEST.[COUNTRY_CD] and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD   LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS   LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS   LEFT OUTER JOIN		[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20)   INNER JOIN			MonitasDB.[dbo].[L_MAILITMS] ON L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID   LEFT OUTER JOIN       C_POSTAL_STATUSES ON L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD     WHERE		--convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31'    convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  	AND			L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --AND L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD LIKE 'US%'   	--AND			month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '11' and '12' 	AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD in('C') AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 	--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) = '0007' ) AS CP87_MAIN LEFT OUTER JOIN     [MonitasDB].[dbo].L_ACC_DESPTCH_STREAMS ON L_ACC_DESPTCH_STREAMS.ACC_DESPTCH_PID = CP87_MAIN.ACC_DESPTCH_PID and					L_ACC_DESPTCH_STREAMS.ACC_STREAM_ID = 201 WHERE       concat(CP87_MAIN.[DESPTCH_FID], CP87_MAIN.DISP_NO) 	not in      (select concat(TR_CPP_CP87_MAIN.DISPATCHIN_ID,[DISPATCH_NO]) collate thai_ci_as from TR_CPP_CP87_MAIN where DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='C')  GROUP BY	[DESPTCH_FID] ,ORIG_OPERATOR_CD 					, DEST_OPERATOR_CD ,ORIG_OFFICE_FCD , DEST_OFFICE_FCD 					 , MAIL_CATEGORY_CD ,MAIL_SUBCLASS_FCD,DIST_YEAR 				  ,DISP_NO,DESPTCH_DT ,[FLIGHT_TRIP_NUMBERS] ,SERVICE_TYPE					 					,TOTAL_WEIGHT_GROSS ,DISPATCH_NO_OF_ITEM 					  ,DISPATCH_PARCEL_OUT  ,[BAG_WEIGHT] 					  ,L_ACC_DESPTCH_STREAMS.RATE2 , L_ACC_DESPTCH_STREAMS.DUE2 					  ,RECEPT_BAG_AMT ,RECEPT_OTHER_AMT ,RECEPTACLE_TOTAL    END ",18128,77192,-59064,927733,0,18128
/****** Script for SelectTopNRows command from SSMS  ******/ SELECT *   FROM [IASDB].[dbo].[T_EMS_CN31_CN33_DETAIL] D   inner join [dbo].[T_EMS_CN31_CN33_MAIN] M ON D.DISPATCHING_ID = M.DISPATCHING_ID   where M.CN31EMS_YEAR = '2023',16785,10006,6779,25313,0,16785
"SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 	   --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID  	 and year(L_MAILITMS.CAPTURE_GMT_DT) = year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 	 AND						 month(L_MAILITMS.CAPTURE_GMT_DT) = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	 -- where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 --not in			(select RKEY   		--						from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 		--						and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 		--						where convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 		--						--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  		--						) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",13663,13148,515,152430,0,13663
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 				([DISPATCHING_ID],[CN31EMS_SEQ], RKEY, 				[BAG_NO], [ITEMS_ID] ,[OFFICE_LODGING] ,[ITEM_WEIGHT] 				,RECPTCL_WEIGHT,RECPTCL_ITEMS ,RECPTCL_FID 				,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 				,[CREATE_USER_ID] ,[CREATE_DATE] ,[UPDATE_USER_ID],[UPDATE_DATE] 				) 	SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 	   --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID  	 and year(L_MAILITMS.CAPTURE_GMT_DT) = year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 	 AND						 month(L_MAILITMS.CAPTURE_GMT_DT) = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	 -- where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 --not in			(select RKEY   		--						from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 		--						and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 		--						where convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 		--						--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  		--						) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",13110,16586,-3476,939241,11337,13110
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 				([DISPATCHING_ID],[CN31EMS_SEQ], RKEY, 				[BAG_NO], [ITEMS_ID] ,[OFFICE_LODGING] ,[ITEM_WEIGHT] 				,RECPTCL_WEIGHT,RECPTCL_ITEMS ,RECPTCL_FID 				,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 				,[CREATE_USER_ID] ,[CREATE_DATE] ,[UPDATE_USER_ID],[UPDATE_DATE] 				) 	SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 	  -- and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID and L_MAILITMS.MAIL_CLASS_CD = 'E' 	 INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = L_MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	 -- where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 --not in			(select RKEY   		--						from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 		--						and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 		--						where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between '2023-01-01' and '2023-12-31' 		--						--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  		--						) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",12731,16956,-4225,833091,11831,12731
"()                 begin try                 if (select convert(int,value_in_use) from sys.configurations where name = 'default trace enabled' ) = 1                 begin                 declare @curr_tracefilename varchar(500) ;                 declare @base_tracefilename varchar(500) ;                 declare @indx int ;                  select @curr_tracefilename = path from sys.traces where is_default = 1 ;                 set @curr_tracefilename = reverse(@curr_tracefilename);                 select @indx  = patindex('%\%', @curr_tracefilename) ;                 set @curr_tracefilename = reverse(@curr_tracefilename) ;                 set @base_tracefilename = left( @curr_tracefilename,len(@curr_tracefilename) - @indx) + '\log.trc' ;                  select  (dense_rank() over (order by StartTime desc))%2 as l1                 ,       convert(int, EventClass) as EventClass                 ,       DatabaseName                 ,       Filename                 ,       (Duration/1000) as Duration                 ,       StartTime                 ,       EndTime                 ,       (IntegerData*8.0/1024) as ChangeInSize                 from ::fn_trace_gettable( @base_tracefilename, default )                 left outer join sys.databases as d on (d.name = DB_NAME())                 where EventClass >=  92      and EventClass <=  95        and ServerName = @@servername   and DatabaseName = db_name()  and (d.create_date < EndTime)                 order by StartTime desc ;                 end     else                 select -1 as l1, 0 as EventClass, 0 DatabaseName, 0 as Filename, 0 as Duration, 0 as StartTime, 0 as EndTime,0 as ChangeInSize                 end try                 begin catch                 select -100 as l1                 ,       ERROR_NUMBER() as EventClass                 ,       ERROR_SEVERITY() DatabaseName                 ,       ERROR_STATE() as Filename                 ,       ERROR_MESSAGE() as Duration                 ,       1 as StartTime, 1 as EndTime,1 as ChangeInSize                 end catch               ",12475,12367,108,350,0,12475
"     -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_TR_BGS_CN38A_MAIN_EMS] 	 AS BEGIN 	 INSERT INTO [dbo].[TR_BGS_CN38A_MAIN] ([CN38_POSTAL_DESIGNATED_OPER_ORIGIN]       ,[CN38_OFFICE_ORIGIN]       ,[CN38_OFFICE_DESTINATIONS]       ,[CN38_DATE]       ,[CN38_CONSIGNMENT_ID]       ,[CN38_TYPEOFMAIL] ,[CN38_MAIL_CATEGORY]  ,[CN38_MAIL_SUBCLASS]       ,[CN38_FLIGHTNO]       ,[CN38_DATE_OF_DEPART]       ,[CN38_TIME_OF_DEPART]       ,[CN38_AIRPORT_OF_DIRECT_TRANSHIPMENT]       ,[CN38_AIRPORT_OF_OFFLOADING]       ,[CN38_ROUTE]	  	  ,[CN38_DEST_LOCATION] 	   ,[CN38_BY]       ,[CN38_TYPEOFMAIL_SELECT]       ,[DEL_FLAG]       ,[RECORD_STATUS]       ,[CREATE_USER_ID]       ,[CREATE_DATE]  ,[UPDATE_USER_ID] ,[UPDATE_DATE]       	  ) SELECT		       A.CN38_POSTAL_DESIGNATED_OPER_ORIGIN , A.CN38_OFFICE_ORIGIN ,A.CN38_OFFICE_DESTINATIONS ,A.[DESPTCH_DEPARTURE_DT] 					, A.CONSGNT_FID, A.CN38_TYPEOFMAIL ,'E' as MAIL_CATEGORY_CD ,A.CN38_MAIL_SUBCLASS ,A.FLIGHTS 					,A.CN38_DATE_OF_DEPART ,A.CN38_TIME_OF_DEPART 					,CASE WHEN B.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NULL THEN A.AIRPORT_OF_DIRECT_TRANSHIPMENT ELSE B.AIRPORT_OF_DIRECT_TRANSHIPMENT END AS AIRPORT_OF_DIRECT_TRANSHIPMENT 					,CASE WHEN B.AIRPORT_OF_OFFLOADING IS NULL THEN A.AIRPORT_OF_OFFLOADING ELSE B.AIRPORT_OF_OFFLOADING END AS AIRPORT_OF_OFFLOADING 					,CASE WHEN B.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NULL AND A.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NOT NULL THEN CONCAT(A.AIRPORT_OF_DIRECT_TRANSHIPMENT,'/',A.AIRPORT_OF_OFFLOADING) 						WHEN B.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NOT NULL THEN CONCAT('BKK','/',B.AIRPORT_OF_DIRECT_TRANSHIPMENT,'/',B.AIRPORT_OF_OFFLOADING) 					  ELSE null END AS CN38_ROUND 					,CASE WHEN B.LOCATION_FCD IS NULL THEN A.LOCATION_FCD ELSE B.LOCATION_FCD END AS LOCATION_FCD 					,'1' as CN38_BY , '1' as CN38_TYPEOFMAIL_SELECT 					,'N' as  [DEL_FLAG] 					,'A' as [RECORD_STATUS] 					,99 as [CREATE_USER_ID] 					,getdate() as [CREATE_DATE] 					,99 as [UPDATE_USER_ID] 					,getdate() as [UPDATE_DATE] FROM 				(select				C_OFFICES.OFFICE_SEQ as CN38_POSTAL_DESIGNATED_OPER_ORIGIN 											,C_OFFICES.OFFICE_SEQ as CN38_OFFICE_ORIGIN ,DES_OFF.OFFICE_SEQ as CN38_OFFICE_DESTINATIONS 											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as [DESPTCH_DEPARTURE_DT] --,substring(R.RECPTCL_FID,17,4) as DISP_NO 											---------L_CONSGNTS--- 											,L_CONSGNTS.CONSGNT_FID as CONSGNT_FID  											,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end as CN38_TYPEOFMAIL 											,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1) as CN38_MAIL_SUBCLASS   											,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS 											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_DATE_OF_DEPART 											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_TIME_OF_DEPART 											,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) as AIRPORT_OF_DIRECT_TRANSHIPMENT 											,substring(L_LEGS.DEST_LOCATION_FCD,3,3) as AIRPORT_OF_OFFLOADING 											,DEST_LOCATION.LOCATION_FCD 											,sum(R.RECPTCL_WEIGHT) as RECPTCL_WEIGHT  					from				[MonitasDB].[dbo].L_RECPTCLS R								 					inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 					LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 					LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 					INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  					INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  					INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 					INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  					INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 					inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 					inner join			[MonitasDB].[dbo].L_LEGS   on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID 					WHERE				convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = convert(date,getdate()-1) 					--and					month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '08' and '12' 					and					C_OFFICES.OFFICE_FCD like 'THBKK%' 					--and					day(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) ='26' 					and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like ('E%') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ='A' 					and					substring(R.RECPTCL_FID,14,2) not like ('%T')  and substring(R.RECPTCL_FID,21,3) not like ('T%') 					and					L_ROUTES_LEGS.LEG_ORDER_NO = 0 					--and					R.EVT_TYPE_CD = '178' 					--and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD in('GRATHA')  					--and					L_CONSGNTS.CONSGNT_FID = 'THBKKC536974' 			--and					substring(R.RECPTCL_FID,17,4) in('2092' ,'2097','2068','2058')   			GROUP BY C_OFFICES.OFFICE_SEQ  											,C_OFFICES.OFFICE_SEQ  ,DES_OFF.OFFICE_SEQ  											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT  --,substring(R.RECPTCL_FID,17,4) as DISP_NO 											---------L_CONSGNTS--- 											,L_CONSGNTS.CONSGNT_FID  											,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end  											,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1)  											,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','')  											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 											,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) 											,substring(L_LEGS.DEST_LOCATION_FCD,3,3)  											,DEST_LOCATION.LOCATION_FCD                   ) AS A  LEFT OUTER JOIN 			( select				C_OFFICES.OFFICE_SEQ as CN38_POSTAL_DESIGNATED_OPER_ORIGIN 									,C_OFFICES.OFFICE_SEQ as CN38_OFFICE_ORIGIN ,DES_OFF.OFFICE_SEQ as CN38_OFFICE_DESTINATIONS 									,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as [DESPTCH_DEPARTURE_DT] --,substring(R.RECPTCL_FID,17,4) as DISP_NO 									---------L_CONSGNTS--- 									,L_CONSGNTS.CONSGNT_FID as CONSGNT_FID  									,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end as CN38_TYPEOFMAIL 									,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1) as CN38_MAIL_SUBCLASS   									,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS 									,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_DATE_OF_DEPART 									,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_TIME_OF_DEPART 									,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) as AIRPORT_OF_DIRECT_TRANSHIPMENT 									,substring(L_LEGS.DEST_LOCATION_FCD,3,3) as AIRPORT_OF_OFFLOADING 									,DEST_LOCATION.LOCATION_FCD 									,sum(R.RECPTCL_WEIGHT) as RECPTCL_WEIGHT  			from				[MonitasDB].[dbo].L_RECPTCLS R								 					inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 			LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 			LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 			INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  			INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  			INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 			INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  			INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 			inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 			inner join			[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID  			WHERE				convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = convert(date,getdate()-1) 			--and					month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '08' and '12' 			--and					day(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) ='26' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like ('E%') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ='A' 			and					substring(R.RECPTCL_FID,14,2) not like ('%T')  and substring(R.RECPTCL_FID,21,3) not like ('T%') 			and					C_OFFICES.OFFICE_FCD like 'THBKK%' 			and					L_ROUTES_LEGS.LEG_ORDER_NO = 1			 			--and					R.EVT_TYPE_CD = '178' 			--and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD in('GRATHA') 			--and					substring(R.RECPTCL_FID,17,4) in('2092' ,'2097','2068','2058') 		--	and					L_CONSGNTS.CONSGNT_FID = 'THBKKC536974' 			GROUP BY C_OFFICES.OFFICE_SEQ  											,C_OFFICES.OFFICE_SEQ  ,DES_OFF.OFFICE_SEQ  											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT  --,substring(R.RECPTCL_FID,17,4) as DISP_NO 											---------L_CONSGNTS--- 											,L_CONSGNTS.CONSGNT_FID  											,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end  											,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1)  											,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','')  											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 											,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) 											,substring(L_LEGS.DEST_LOCATION_FCD,3,3)  											,DEST_LOCATION.LOCATION_FCD 			 			) AS B ON	A.CN38_OFFICE_ORIGIN = B.CN38_OFFICE_ORIGIN  AND A.CN38_OFFICE_DESTINATIONS = B.CN38_OFFICE_DESTINATIONS AND A.DESPTCH_DEPARTURE_DT = B.DESPTCH_DEPARTURE_DT AND A.CONSGNT_FID = B.CONSGNT_FID AND A.FLIGHTS = B.FLIGHTS AND A.MAIL_CATEGORY_CD = B.MAIL_CATEGORY_CD and A.CN38_MAIL_SUBCLASS = B.CN38_MAIL_SUBCLASS  AND A.LOCATION_FCD = B.LOCATION_FCD ORDER BY             A.DESPTCH_DEPARTURE_DT   END ",12037,55707,-43670,30450586,3,12037
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2024-03-01' and '2024-03-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2024'  and month([CAPTURE_GMT_DT]) = '03' 	) 	 ",11202,69345,-58143,29268973,2674,11202
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2024-01-01' and '2024-01-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2024'  and month([CAPTURE_GMT_DT]) = '01' 	) 	 ",11073,66866,-55793,29151486,2509,11073
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2024-02-01' and '2024-02-29' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2024'  and month([CAPTURE_GMT_DT]) = '02' 	) 	 ",10712,60028,-49316,29126588,2463,10712
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-09-01' and '2023-09-30' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '09' 	) 	",10425,59540,-49115,29206256,2601,10425
"select		T_EMS_CN31_CN33_MAIN.DISPATCHING_ID as DISPATCHING_ID , 				concat( L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(EM.MAILITM_FID)) as RKEY 						, substring(RE_EDI.RECPTCL_FID,21,3)  as [BAG_NO] 						--,case when R.RECPTCL_WEIGHT is null then RE_EDI.RECPTCL_WEIGHT else R.RECPTCL_WEIGHT end   as RECPTCL_WEIGHT	 						,RE_EDI.RECPTCL_WEIGHT 						,RE_EDI.RECPTCL_MAILITMS_NO   as RECPTCL_MAILITMS_NO	 						,RE_EDI.RECPTCL_FID   as RECPTCL_FID 						,TRIM(EM.MAILITM_FID)  as MAILITM_FID 						,EM.MAIL_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						,case when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,2) then 'Normal'  						      when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,2) then 'Being returned' 						  else 'Transit' end as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA  	INNER JOIN		[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 	and					substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 	and  RE_EDI.RECPTCL_MAILITMS_NO  is not null  	INNER JOIN		[MonitasDB].[dbo].N_EDI_MAILITMS as EM ON RE_EDI.RECPTCL_PID = EM.RECPTCL_PID and trim(EM.MAILITM_FID) is not null 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2023' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 		 --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 			and TRIM(EM.MAILITM_FID)= 'EE194931558TH' 			--and   RE_EDI.RECPTCL_FID like '%40025%' 			order by RECPTCL_FID ,TRIM(EM.MAILITM_FID)",10022,24752,-14730,10401887,49,10022
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT])     select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT  	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2024-01-01' and '2024-03-31'",9831,52569,-42738,8758106,7156,9831
"  delete T_EMS_CN31_CN33_DETAIL      FROM [IASDB].[dbo].[T_EMS_CN31_CN33_DETAIL] D   inner join T_EMS_CN31_CN33_MAIN M on D.DISPATCHING_ID = M.DISPATCHING_ID   where  M.SERVICE_TYPE = 'I'   and convert(date,D.create_date )='2024-04-15'",9549,19947,-10398,8780155,64821,9549
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2024-04-01' and '2024-04-20' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2024'  and month([CAPTURE_GMT_DT]) = '04' 	) 	 ",9343,57746,-48403,28604865,1655,9343
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-01-01' and '2023-01-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '01' 	) 	",9173,38705,-29532,4679519,4797,9173
"select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 										case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 										LME.CAPTURE_GMT_DT 							 from    MonitasDB.[dbo].[L_MAILITMS]  							 left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  												FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 												WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 												GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 											)  							 AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 							and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT 							 where year(CAPTURE_DT)='2023' --and  month(CAPTURE_DT)='1'  							 and L_MAILITMS.MAIL_CLASS_CD = 'E'",8629,20588,-11959,2613380,0,8629
"select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT  	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-01-01' and '2023-01-31'",7901,31373,-23472,3912907,43,7901
"     CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CN38_DETAIL_VIA]  	-- Add the parameters for the stored procedure here 	 AS BEGIN 	INSERT INTO [dbo].[TR_CPP_CN38_DETAIL] ([CONSIGNMENT_ID] ,[CN38_MAIN_SEQ]       ,[OFFICE_ORIGIN]       ,[OFFICE_DESTINATION]       ,[MAIL_CATEGORY]       ,[MAIL_SUBCLASS]       ,[DESP_SERIAL_NO]       ,[DEL_FLAG]       ,[RECORD_STATUS] 	  ,[CREATE_USER_ID]       ,[CREATE_DATE] ,UPDATE_USER_ID, UPDATE_DATE 	  ) SELECT        distinct L_CONSGNTS.CONSGNT_FID ,TR_CPP_CN38_MAIN.CN38_SEQ,C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD as DEST_OFFICE 				,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD as CN38_MAIL_CATEGORY ,substring(R.RECPTCL_FID,14,2) as CN38_SUBCLASS 				,convert(varchar(4),convert(int,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4))) as CN38_DESP_SERIAL_NO  				,'N' as DEL_FLAG , 'A' as RECORD_STATUS  				,99 as [CREATE_USER_ID] 				,getdate() as [CREATE_DATE] 				,99 as [UPDATE_USER_ID] 				,getdate() as [UPDATE_DATE] 	   		from		[MonitasDB].[dbo].L_RECPTCLS R								 		inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 		INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  		INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS 					 		INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 		inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 		left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID  	   		INNER JOIN			[dbo].[TR_CPP_CN38_MAIN] ON TR_CPP_CN38_MAIN.CONSIGNMENT_ID = L_CONSGNTS.CONSGNT_FID  collate THAI_CI_AS  		AND					TR_CPP_CN38_MAIN.DEPART_DATE_TIME = convert(date,L_LEGS.DEPARTURE_DT)   		and					TR_CPP_CN38_MAIN.POSTAL_DESIGNATED_OPER_ORIGIN = C_OFFICES.OPERATOR_CD   		AND					substring(TR_CPP_CN38_MAIN.OFFICE_ORIGIN_BILL,1,5) = substring(C_OFFICES.OFFICE_FCD,1,5)  		and					TR_CPP_CN38_MAIN.OFFICE_DESTINATION_BILL = DES_OFF.OFFICE_FCD 		AND					TR_CPP_CN38_MAIN.DEL_FLAG ='N'   		WHERE				year(L_LEGS.DEPARTURE_DT)= '2024' --and			month(L_LEGS.DEPARTURE_DT) between '9' and '12' 		--and				month(L_LEGS.DEPARTURE_DT) between '11' and '11' 		and					substring(R.RECPTCL_FID,14,2) like ('C%') and substring(R.RECPTCL_FID,13,1) in('A','B','C') 		and					substring(R.RECPTCL_FID,14,2) not like ('%T') and	substring(R.RECPTCL_FID,21,3) not like 'T%' 		and					L_ROUTES_LEGS.LEG_ORDER_NO = 0 		and					L_CONSGNTS.ORIG_OFFICE_FCD like 'THBKK%'  		and					substring(RECPTCL_FID,1,6) like 'THBKK%'  		--and					substring(RECPTCL_FID,7,6) like 'SKBTS%' 		--and					L_CONSGNTS.CONSGNT_FID='THBKKA111700' 		--and			substring(R.RECPTCL_FID,14,2) not in('EV') 		--and			L_DESPTCHS.DESPTCH_FID ='THBKKANOOSLBACN30103' 		and L_CONSGNTS.CONSGNT_FID collate thai_ci_as not in (select [CONSIGNMENT_ID] from TR_CPP_CN38_DETAIL) 		 order by		C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,2) 				,convert(varchar(4),convert(int,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4))) END ",7632,26540,-18908,19204079,77,7632
"select		 L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID , 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY 						,substring(R.RECPTCL_FID,21,3)   as [BAG_NO] 						, R.RECPTCL_WEIGHT  as RECPTCL_WEIGHT	 						, R.RECPTCL_MAILITMS_NO  as RECPTCL_MAILITMS_NO	 						, R.RECPTCL_FID  as RECPTCL_FID 						,trim(L_MAILITMS.MAILITM_FID) as MAILITM_FID 						,L_MAILITMS.MAILITM_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 										max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 						from			[MonitasDB].[dbo].L_MAILITMS  						--where			trim(MAILITM_FID) = 'EN314572505JP' 						GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 			and			trim(L_MAILITMS.MAILITM_FID) = 'EE194931558TH'			 			order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)",7568,15351,-7783,3874821,2,7568
"     CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CP87_DETAIL_SURFACE]  	 AS BEGIN 	  ----+  +   +  +   +   +   รายได้ +  +   +INSERT INTO [IASDB].[dbo].[TR_CPP_CP87_DETAIL] 		INSERT INTO [dbo].[TR_CPP_CP87_DETAIL] 			 ([CP87_SEQ],[DISPATCHIN_ID] 			  ,[PARCEL_ID] 			  ,[ORIGIN_COUNTRY] 			  ,[DESTINATION_COUNTRY] 			  ,[WEIGHT_KG]  			  ,LAND_SEA_RATE_DISP  			  ,LAND_SEA_RATE_RECEIVING ,AIR_CONVEYANCE_DUES_DISP ,AIR_CONVEYANCE_DUES_RECEIVING ,POSTAL_STATUS_NM 			  ,[OBSERVATIONS]  ,[SERVICE_TYPE] 			  ,[DEL_FLAG] 			  ,[RECORD_STATUS] 			  ,[CREATE_DATE] ,[CREATE_USER_ID] 			  ,[UPDATE_DATE] ,[UPDATE_USER_ID]       			  ,[FORM_SUBMIT_ID]       			  ,[REQUEST_EDIT_STATUS] 			   )  		SELECT				TR_CPP_CP87_MAIN.CP87_SEQ ,L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as [DISPATCHIN_ID]  							,TRIM(N_EDI_MAILITMS.MAILITM_FID) as MAILITM_FID 							,case when N_EDI_MAILITMS.ORIG_COUNTRY_CD is null then substring(N_EDI_MAILITMS.MAILITM_FID,12,2) else N_EDI_MAILITMS.ORIG_COUNTRY_CD end as ORIG_COUNTRY_CD  							, case when N_EDI_MAILITMS.DEST_COUNTRY_CD is null then 'TH' else N_EDI_MAILITMS.DEST_COUNTRY_CD end as M_DEST_COUNTRY 							/*,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Being returned' then DEST_OFFICE.COUNTRY_CD 									when C_POSTAL_STATUSES.POSTAL_STATUS_NM in('In transit here','Out of Course','Being returned/redirected in transit here') then N_EDI_MAILITMS.ORIG_COUNTRY_CD  collate Thai_CI_AS 							else C_OFFICES.COUNTRY_CD end as ORIGIN_COUNTRY										 							,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Being returned' then N_EDI_MAILITMS.DEST_COUNTRY_CD 									when C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Sent A decouvert' then N_EDI_MAILITMS.DEST_COUNTRY_CD collate Thai_CI_AS 									when C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Being returned/redirected in transit here' then N_EDI_MAILITMS.DEST_COUNTRY_CD collate Thai_CI_AS 							else DEST_OFFICE.COUNTRY_CD  end as  DEST_COUNTRY_CD*/  							,dbo.RoundUp(ISNULL(N_EDI_MAILITMS.MAIL_WEIGHT,0),1) as MAIL_WEIGHT 							,COL6 ,COL7 ,COL8 ,COL9 ,POSTAL_STATUS_NM 							,C_MONTH.MONTH_NAME_EN_ABR 							,TR_CPP_CP87_MAIN.SERVICE_TYPE	  							 ,'N' as [DEL_FLAG] 							 ,'A' as [RECORD_STATUS] 							 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 							 ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  							 ,1 as [FORM_SUBMIT_ID] 							 ,1 as [REQUEST_EDIT_STATUS]   			 		FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA		 		INNER JOIN				[MonitasDB].[dbo].N_EDI_RECPTCLS as N_EDI_RECPTCLS on L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(N_EDI_RECPTCLS.RECPTCL_FID,1,20) 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 		INNER JOIN				[MonitasDB].[dbo].N_EDI_MAILITMS on N_EDI_RECPTCLS.RECPTCL_PID = N_EDI_MAILITMS.RECPTCL_PID			 		LEFT OUTER JOIN			[MonitasDB].[dbo].L_MAILITMS on L_MAILITMS.MAILITM_FID = N_EDI_MAILITMS.MAILITM_FID	 		LEFT OUTER JOIN			[MonitasDB].[dbo].C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 		LEFT OUTER JOIN			[MonitasDB].[dbo].L_PARCELS ON L_PARCELS.MAILITM_PID = L_MAILITMS.MAILITM_PID 		INNER JOIN				C_MONTH ON C_MONTH.MONTH_SEQ = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 		INNER JOIN				C_OFFICES ON L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD = C_OFFICES.OFFICE_FCD  collate Thai_CI_AS 		INNER JOIN				C_OFFICES as DEST_OFFICE ON  L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD = DEST_OFFICE.OFFICE_FCD  collate Thai_CI_AS 		INNER JOIN				[dbo].[TR_CPP_CP87_MAIN] ON TR_CPP_CP87_MAIN.DISPATCHIN_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate Thai_CI_AS		 		  		WHERE			 --convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 		convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 		--and				convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2021-01-01' and '2024-01-31' 		AND			L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD LIKE 'THBKK%'  --AND L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'CNCA%' 		--AND			month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '11' and '12' 		AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD = 'C' AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 		--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) = '0279' 		--and			TRIM(N_EDI_MAILITMS.MAILITM_FID)='CP234677581KR' 		and                concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,N_EDI_MAILITMS.MAILITM_FID) collate thai_ci_as 		not in             (select		concat(TR_CPP_CP87_DETAIL.DISPATCHIN_ID,TR_CPP_CP87_DETAIL.PARCEL_ID)   								from TR_CPP_CP87_DETAIL  								inner join TR_CPP_CP87_MAIN on TR_CPP_CP87_MAIN.CP87_SEQ = TR_CPP_CP87_DETAIL.CP87_SEQ   									where TR_CPP_CP87_DETAIL.DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.DEL_FLAG ='N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='C') 	 		ORDER BY      N_EDI_RECPTCLS.RECPTCL_FID   /*+    +    +    + รายจ่าย   +    +    +    +*/ 	INSERT INTO [dbo].[TR_CPP_CP87_DETAIL] 		 ([CP87_SEQ] 		  ,[PARCEL_ID],[DISPATCHIN_ID] 		  ,[ORIGIN_COUNTRY] 		  ,[DESTINATION_COUNTRY] 		  ,[WEIGHT_KG]  		  ,LAND_SEA_RATE_DISP  		  ,LAND_SEA_RATE_RECEIVING ,AIR_CONVEYANCE_DUES_DISP ,AIR_CONVEYANCE_DUES_RECEIVING ,POSTAL_STATUS_NM 		  ,[OBSERVATIONS]  ,[SERVICE_TYPE] 		  ,[DEL_FLAG] 		  ,[RECORD_STATUS] 		  ,[CREATE_DATE] ,[CREATE_USER_ID] 		  ,[UPDATE_DATE] ,[UPDATE_USER_ID]       		  ,[FORM_SUBMIT_ID]       		  ,[REQUEST_EDIT_STATUS] 		   )  	SELECT  TR_CPP_CP87_MAIN.CP87_SEQ,  			ORIGIN.MAILITM_FID   ,ORIGIN.DESPTCH_FID 			,case when ORIGIN.POSTAL_STATUS_NM ='Being returned' then ORIGIN.DEST_COUNTRY 				  when ORIGIN.POSTAL_STATUS_NM in('In transit here','Out of Course','Being returned/redirected in transit here') then ORIGIN.M_ORIGIN_COUNTRY collate Thai_CI_AS 			else ORIGIN.ORIGIN_COUNTRY end as ORIGIN_COUNTRY  			,case when ORIGIN.POSTAL_STATUS_NM ='Being returned' then M_DEST_COUNTRY_CD 				  when ORIGIN.POSTAL_STATUS_NM ='Sent A decouvert' then M_DEST_COUNTRY_CD collate Thai_CI_AS 				  when ORIGIN.POSTAL_STATUS_NM ='Being returned/redirected in transit here' then M_DEST_COUNTRY_CD collate Thai_CI_AS 			else ORIGIN.DEST_COUNTRY  end as  DEST_COUNTRY_CD  			,[dbo].[RoundUp](ISNULL(ORIGIN.MAILITM_WEIGHT,0),1) as MAILITM_WEIGHT 			,COL6 ,COL7 ,COL8 ,COL9 ,POSTAL_STATUS_NM ,C_MONTH.MONTH_NAME_EN_ABR  ,TR_CPP_CP87_MAIN.SERVICE_TYPE 			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 		 ,getdate() as [UPDATE_DATE]  ,99 as [UPDATE_USER_ID]  		  ,0 as [FORM_SUBMIT_ID]  		  ,0 as [REQUEST_EDIT_STATUS]        	FROM (  	SELECT L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DESPTCH_FID 		  ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD ,L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD 		  ,L_ACC_DESPTCH_RAW_DATA.CONVEYANCE_TYPE_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD 		  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT , month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DT_MONTH	   		  ,L_ACC_DESPTCH_RAW_DATA.STATE_IND_CD --,L_CONSGNTS.CONSGNT_FID 		  ,C_OFFICES.OPERATOR_CD as ORIGIN_OPER, DES_OFF.OPERATOR_CD as DEST_OPER 		  ,C_OFFICES.COUNTRY_CD as ORIGIN_COUNTRY ,DES_OFF.COUNTRY_CD as DEST_COUNTRY 		---- Receptcls ------------------- 		   ,R.[RECPTCL_PID],R.[RECPTCL_OWNERSHIP_CD],R.[RECPTCL_FID],R.[RECPTCL_WEIGHT] 		  ,R.[RECPTCL_MAILITMS_NO],R.[RECPTCL_CONTENT_FORMAT_CD],R.[RECPTCL_SUB_TYPE_CD] 		   ,case when RECPTCL_SUB_TYPE_CD = 'BG' then 1 else 0 end as BAG_AMT 		  ,case when RECPTCL_SUB_TYPE_CD = 'PC' then 1 else 0 end as OTHER_AMT 		  ,R.[STATE_IND_CD] as RECEP_STATE_IND,R.[POSTAL_STATUS_CD],R.[EVT_TYPE_CD],R.[EVT_CONSGNT_PID]  		  ,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS 			 ,MAILITMS.MAILITM_WEIGHT , MAILITMS.MAILITM_FID ,MAILITMS.DEST_COUNTRY_CD as M_DEST_COUNTRY_CD ,MAILITMS.ORIG_COUNTRY_CD as M_ORIGIN_COUNTRY 			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL6 else 0 end as COL6 			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL7 else 0 end as COL7  			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL8 else 0 end as COL8  			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL9 else 0 end as COL9 			,C_POSTAL_STATUSES.POSTAL_STATUS_NM 	   	  FROM     (select			L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when L_MAILITMS.EVT_RECPTCL_PID  is null then L_MAILITM_EVENTS.[RECPTCL_PID] else L_MAILITMS.EVT_RECPTCL_PID end  as RECPTCL_PID, 											max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT 							from			MonitasDB.[dbo].[L_MAILITMS]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID] and (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							group by		L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT  , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD 											,case when L_MAILITMS.EVT_RECPTCL_PID  is null then L_MAILITM_EVENTS.[RECPTCL_PID] else L_MAILITMS.EVT_RECPTCL_PID end 				   ) as MAILITMS 		--INNER JOIN     [MonitasDB].[dbo].L_MAILITM_EVENTS ON MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 		--AND				MAILITMS.CAPTURE_DT = L_MAILITM_EVENTS.CAPTURE_GMT_DT  	 INNER JOIN    [MonitasDB].[dbo].L_RECPTCLS R ON R.RECPTCL_PID = MAILITMS.RECPTCL_PID 	  INNER JOIN [MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  INNER JOIN [dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  	  INNER JOIN [dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	 LEFT OUTER JOIN [MonitasDB].[dbo].L_PARCELS ON L_PARCELS.MAILITM_PID = MAILITMS.MAILITM_PID 	 LEFT OUTER JOIN C_POSTAL_STATUSES on MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD  	  where  	  L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD = 'USJECS'  	   and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD = 'C' and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 	   and convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 	   --and convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 	  --and L_MAILITMS.POSTAL_STATUS_CD='0' 	  -- and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '11' and '12' 	  --and substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) between '0023' and '0025'     	 --ORDER BY L_DESPTCHS.[DESPTCH_FID],L_MAILITMS.MAILITM_FID 	  ) as ORIGIN  	INNER JOIN [dbo].[TR_CPP_CP87_MAIN] ON TR_CPP_CP87_MAIN.DISPATCHIN_ID = ORIGIN.[DESPTCH_FID] collate Thai_CI_AS 	/*INNER JOIN [dbo].[C_CPP_RATE_AIR] ON TR_CPP_CP87_MAIN.CP87_YEAR = C_CPP_RATE_AIR.CPP_RATE_YEAR  	AND ORIGIN.ORIGIN_COUNTRY = C_CPP_RATE_AIR.COUNTRY_ORIGIN_CD AND ORIGIN.DEST_COUNTRY = C_CPP_RATE_AIR.COUNTRY_DEST_CD*/ 	INNER JOIN C_MONTH ON C_MONTH.MONTH_SEQ = origin.DT_MONTH 	 --WHERE ORIGIN.MAILITM_FID='CP070711838TH' 	 WHERE                 concat(ORIGIN.DESPTCH_FID,ORIGIN.MAILITM_FID) collate thai_ci_as 	not in             (select concat(TR_CPP_CP87_DETAIL.DISPATCHIN_ID,TR_CPP_CP87_DETAIL.PARCEL_ID)  from TR_CPP_CP87_DETAIL  	                       inner join TR_CPP_CP87_MAIN on TR_CPP_CP87_MAIN.CP87_SEQ = TR_CPP_CP87_DETAIL.CP87_SEQ   						    where TR_CPP_CP87_DETAIL.DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.DEL_FLAG ='N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='C' 							and TR_CPP_CP87_MAIN.DESPTCH_DATE between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 							--and TR_CPP_CP87_MAIN.DESPTCH_DATE between '2024-03-01' and '2024-03-31' 							)  	 ORDER BY   ORIGIN.[DESPTCH_FID], ORIGIN.MAILITM_FID   END ",7147,33261,-26114,944234,8,7147
"select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 										case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 										LME.CAPTURE_GMT_DT 							INTO L_MAILITMS_TMP 							 from    MonitasDB.[dbo].[L_MAILITMS]  							 left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  												FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 												WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 												GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 											)  							 AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 							and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 							 --where L_MAILITMS.MAILITM_FID = 'EE187476734TH'  							 where year(LME.CAPTURE_GMT_DT) = '2023' --and month(LME.CAPTURE_GMT_DT) = '1'  							 and L_MAILITMS.MAIL_CLASS_CD = 'E'",7130,43211,-36081,13394212,6589,7130
"select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 										case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 										LME.CAPTURE_GMT_DT 							 from    MonitasDB.[dbo].[L_MAILITMS]  							 left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  												FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 												WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 												GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 											)  							 AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 							and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT 							 where year(CAPTURE_DT)='2023' and  month(CAPTURE_DT)='1'",7027,39092,-32065,1375467,0,7027
"  -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_T_EMS_CN33_DETAIL_TMP_IN]  	-- Add the parameters for the stored procedure here 	 AS BEGIN 	-- SET NOCOUNT ON added to prevent extra result sets from 	-- interfering with SELECT statements. 	 -- TRUNCATE TABLE T_EMS_CN31_CN33_DETAIL_TMP1;   INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL_TMP1] 					([DISPATCHING_ID],DESPTCH_DT,RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]  	)				  	select		 distinct L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY 						,substring(R.RECPTCL_FID,21,3)   as [BAG_NO] 						, R.RECPTCL_WEIGHT  as RECPTCL_WEIGHT	 						, R.RECPTCL_MAILITMS_NO  as RECPTCL_MAILITMS_NO	 						, R.RECPTCL_FID  as RECPTCL_FID 						,trim(L_MAILITMS.MAILITM_FID) as MAILITM_FID 						,L_MAILITMS.MAILITM_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 										max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 						from			[MonitasDB].[dbo].L_MAILITMS  						--where			trim(MAILITM_FID) = 'EN314572505JP' 						GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-04-01' and '2024-04-20' 			--and			trim(L_MAILITMS.MAILITM_FID) = 'EN314572505JP'	 			and     concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID))  collate THAI_CI_AS 			not in (select RKEY from T_EMS_CN31_CN33_DETAIL_TMP1  						where convert(date,DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 					) 			order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)  	/*+   +    +    +    +    +   +  */ 	--TRUNCATE TABLE T_EMS_CN31_CN33_DETAIL_TMP2; 	INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL_TMP2] 					([DISPATCHING_ID],DESPTCH_DT,RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]) 	select		T_EMS_CN31_CN33_MAIN.DISPATCHING_ID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat( L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(EM.MAILITM_FID)) as RKEY 						, substring(RE_EDI.RECPTCL_FID,21,3)  as [BAG_NO] 						--,case when R.RECPTCL_WEIGHT is null then RE_EDI.RECPTCL_WEIGHT else R.RECPTCL_WEIGHT end   as RECPTCL_WEIGHT	 						,RE_EDI.RECPTCL_WEIGHT 						,RE_EDI.RECPTCL_MAILITMS_NO   as RECPTCL_MAILITMS_NO	 						,RE_EDI.RECPTCL_FID   as RECPTCL_FID 						,TRIM(EM.MAILITM_FID)  as MAILITM_FID 						,EM.MAIL_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						,case when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,2) then 'Normal'  						      when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,2) then 'Being returned' 						  else 'Transit' end as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA  	INNER JOIN		[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 	and					substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 	and  RE_EDI.RECPTCL_MAILITMS_NO  is not null  	INNER JOIN		[MonitasDB].[dbo].N_EDI_MAILITMS as EM ON RE_EDI.RECPTCL_PID = EM.RECPTCL_PID and trim(EM.MAILITM_FID) is not null 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2023' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 		 --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-04-01' and '2024-04-20' 		and     concat( L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(EM.MAILITM_FID))  collate THAI_CI_AS 			not in (select RKEY from T_EMS_CN31_CN33_DETAIL_TMP2  						where convert(date,DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 					)	 			--and   RE_EDI.RECPTCL_FID like '%40025%' 			order by RECPTCL_FID ,TRIM(EM.MAILITM_FID)  END ",6694,26048,-19354,1131177,683,6694
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-03-01' and '2023-03-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '03' 	) 	 ",6549,32962,-26413,4619539,6172,6549
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-02-01' and '2023-02-28' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '02' 	) 	",6522,31978,-25456,4243790,5008,6522
"select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 										case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 										LME.CAPTURE_GMT_DT 							 from    MonitasDB.[dbo].[L_MAILITMS]  							 left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  												FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 												WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 												GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 											)  							 AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 							and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT 							 where year(CAPTURE_DT)='2023' and  year(CAPTURE_DT)='1'",6324,37873,-31549,608200,0,6324
"     CREATE PROCEDURE [dbo].[PROC_INSERT_TR_CPP_CP87_DETAIL_SAL]  	 AS BEGIN 	  ----+  +   +  +   +   +   รายได้ +  +   +INSERT INTO [IASDB].[dbo].[TR_CPP_CP87_DETAIL] INSERT INTO [dbo].[TR_CPP_CP87_DETAIL] ([CP87_SEQ]       ,[PARCEL_ID]       ,[ORIGIN_COUNTRY]       ,[DESTINATION_COUNTRY]       ,[WEIGHT_KG]  	  ,LAND_SEA_RATE_DISP  	  ,LAND_SEA_RATE_RECEIVING ,AIR_CONVEYANCE_DUES_DISP ,AIR_CONVEYANCE_DUES_RECEIVING ,POSTAL_STATUS_NM       ,[OBSERVATIONS] ,[DISPATCHIN_ID] ,[SERVICE_TYPE]       ,[DEL_FLAG]       ,[RECORD_STATUS]       ,[CREATE_DATE] ,[CREATE_USER_ID]       ,[UPDATE_DATE] ,[UPDATE_USER_ID]             ,[FORM_SUBMIT_ID]             ,[REQUEST_EDIT_STATUS]        )  SELECT				TR_CPP_CP87_MAIN.CP87_SEQ,TRIM(N_EDI_MAILITMS.MAILITM_FID) as MAILITM_FID 					,case when N_EDI_MAILITMS.ORIG_COUNTRY_CD is null then substring(N_EDI_MAILITMS.MAILITM_FID,12,2) else N_EDI_MAILITMS.ORIG_COUNTRY_CD end as ORIG_COUNTRY_CD   						, case when N_EDI_MAILITMS.DEST_COUNTRY_CD is null then 'TH' else N_EDI_MAILITMS.DEST_COUNTRY_CD end as M_DEST_COUNTRY 					--,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as DISP_NO 					,ROUND(N_EDI_MAILITMS.MAIL_WEIGHT,2) as MAILITM_WEIGHT  					,COL6 ,COL7 ,COL8 ,COL9 ,POSTAL_STATUS_NM 					,C_MONTH.MONTH_NAME_EN_ABR 					,TR_CPP_CP87_MAIN.DISPATCHIN_ID as [DISPATCHIN_ID]	,TR_CPP_CP87_MAIN.SERVICE_TYPE	  					 ,'N' as [DEL_FLAG] 				     ,'A' as [RECORD_STATUS] 					 ,getdate() as [CREATE_DATE] ,99 as [CREATE_USER_ID] 				     ,getdate() as [UPDATE_DATE] ,99 as [UPDATE_USER_ID]  					 ,1 as [FORM_SUBMIT_ID] 				     ,1 as [REQUEST_EDIT_STATUS]   			 	      FROM					( 							select					N_EDI_RECPTCLS.RECPTCL_FID as RECPTCL_FID,L_MAILITMS.MAILITM_FID, L_MAILITMS.MAILITM_WEIGHT ,N_EDI_MAILITMS.MAIL_WEIGHT 													,N_EDI_MAILITMS.ORIG_COUNTRY_CD ,N_EDI_MAILITMS.DEST_COUNTRY_CD 							from					[MonitasDB].[dbo].N_EDI_MAILITMS  							inner join				[MonitasDB].[dbo].N_EDI_RECPTCLS ON N_EDI_MAILITMS.RECPTCL_PID = N_EDI_RECPTCLS.RECPTCL_PID 							inner join				MonitasDB.[dbo].[L_MAILITMS] ON [L_MAILITMS].MAILITM_FID = N_EDI_MAILITMS.MAILITM_FID 							INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD  							inner join				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(N_EDI_RECPTCLS.RECPTCL_FID,1,20) 							--where					C_POSTAL_STATUSES.POSTAL_STATUS_NM ='Being returned' 							--and						N_EDI_MAILITMS.MAILITM_FID in('CP068345282TH' ,'CP320383695MY')    							) as N_EDI_MAILITMS 		LEFT OUTER JOIN			[MonitasDB].[dbo].L_RECPTCLS R ON N_EDI_MAILITMS.RECPTCL_FID  = R.RECPTCL_FID 		 INNER JOIN				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA	ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(N_EDI_MAILITMS.RECPTCL_FID,1,20) 		INNER JOIN				[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  		INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  		INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 		INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = CO_DEST.[COUNTRY_CD] and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 		LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 		INNER JOIN			[dbo].[TR_CPP_CP87_MAIN] ON TR_CPP_CP87_MAIN.DISPATCHIN_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate Thai_CI_AS 		INNER JOIN			C_MONTH ON C_MONTH.MONTH_SEQ = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)									 		LEFT OUTER JOIN			MonitasDB.[dbo].[L_MAILITMS] ON  L_MAILITMS.MAILITM_FID= N_EDI_MAILITMS.MAILITM_FID 		LEFT OUTER JOIN		[MonitasDB].[dbo].L_PARCELS ON L_PARCELS.MAILITM_PID = L_MAILITMS.MAILITM_PID 		LEFT OUTER JOIN			C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 		  	WHERE		--convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  	convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 	AND			L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD LIKE 'THBKK%'  --AND L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD = 'MYKULA' 	--AND			month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '11' and '12' 	AND			L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD = 'B' AND L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 	--AND			substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) = '0012' 	and                concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,N_EDI_MAILITMS.MAILITM_FID) collate thai_ci_as 	not in             (select concat(TR_CPP_CP87_DETAIL.DISPATCHIN_ID,TR_CPP_CP87_DETAIL.PARCEL_ID)  from TR_CPP_CP87_DETAIL  	                       inner join TR_CPP_CP87_MAIN on TR_CPP_CP87_MAIN.CP87_SEQ = TR_CPP_CP87_DETAIL.CP87_SEQ   						    where TR_CPP_CP87_DETAIL.DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.DEL_FLAG ='N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='B') ORDER BY       N_EDI_MAILITMS.RECPTCL_FID   /*+    +    +    + รายจ่าย   +    +    +    +*/ 	INSERT INTO [dbo].[TR_CPP_CP87_DETAIL] 	([CP87_SEQ] 		  ,[PARCEL_ID] 		  ,[ORIGIN_COUNTRY] 		  ,[DESTINATION_COUNTRY] 		  ,[WEIGHT_KG]  		  ,LAND_SEA_RATE_DISP  		  ,LAND_SEA_RATE_RECEIVING ,AIR_CONVEYANCE_DUES_DISP ,AIR_CONVEYANCE_DUES_RECEIVING ,POSTAL_STATUS_NM 		  ,[OBSERVATIONS] ,[DISPATCHIN_ID] ,[SERVICE_TYPE] 		  ,[DEL_FLAG] 		  ,[RECORD_STATUS] 		  ,[CREATE_DATE] ,[CREATE_USER_ID] 		  ,[UPDATE_DATE] ,[UPDATE_USER_ID]       		  ,[FORM_SUBMIT_ID]       		  ,[REQUEST_EDIT_STATUS] 		   )  	SELECT  TR_CPP_CP87_MAIN.CP87_SEQ,  			ORIGIN.MAILITM_FID   ,ORIGIN.DESPTCH_FID 			,case when ORIGIN.POSTAL_STATUS_NM ='Being returned' then ORIGIN.DEST_COUNTRY 				  when ORIGIN.POSTAL_STATUS_NM in('In transit here','Out of Course','Being returned/redirected in transit here') then ORIGIN.M_ORIGIN_COUNTRY collate Thai_CI_AS 			else ORIGIN.ORIGIN_COUNTRY end as ORIGIN_COUNTRY  			,case when ORIGIN.POSTAL_STATUS_NM ='Being returned' then M_DEST_COUNTRY_CD 				  when ORIGIN.POSTAL_STATUS_NM ='Sent A decouvert' then M_DEST_COUNTRY_CD collate Thai_CI_AS 				  when ORIGIN.POSTAL_STATUS_NM ='Being returned/redirected in transit here' then M_DEST_COUNTRY_CD collate Thai_CI_AS 			else ORIGIN.DEST_COUNTRY  end as  DEST_COUNTRY_CD  			,[dbo].[RoundUp](ISNULL(ORIGIN.MAILITM_WEIGHT,0),1) as MAILITM_WEIGHT 			,COL6 ,COL7 ,COL8 ,COL9 ,POSTAL_STATUS_NM ,C_MONTH.MONTH_NAME_EN_ABR 			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 		  ,0 as [FORM_SUBMIT_ID]  		  ,0 as [REQUEST_EDIT_STATUS] ,TR_CPP_CP87_MAIN.SERVICE_TYPE        	FROM (  	SELECT L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DESPTCH_FID 		  ,L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD ,L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD 		  ,L_ACC_DESPTCH_RAW_DATA.CONVEYANCE_TYPE_CD ,L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD 		  ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT , month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as DT_MONTH	   		  ,L_ACC_DESPTCH_RAW_DATA.STATE_IND_CD --,L_CONSGNTS.CONSGNT_FID 		  ,C_OFFICES.OPERATOR_CD as ORIGIN_OPER, DES_OFF.OPERATOR_CD as DEST_OPER 		  ,C_OFFICES.COUNTRY_CD as ORIGIN_COUNTRY ,DES_OFF.COUNTRY_CD as DEST_COUNTRY 		---- Receptcls ------------------- 		   ,R.[RECPTCL_PID],R.[RECPTCL_OWNERSHIP_CD],R.[RECPTCL_FID],R.[RECPTCL_WEIGHT] 		  ,R.[RECPTCL_MAILITMS_NO],R.[RECPTCL_CONTENT_FORMAT_CD],R.[RECPTCL_SUB_TYPE_CD] 		   ,case when RECPTCL_SUB_TYPE_CD = 'BG' then 1 else 0 end as BAG_AMT 		  ,case when RECPTCL_SUB_TYPE_CD = 'PC' then 1 else 0 end as OTHER_AMT 		  ,R.[STATE_IND_CD] as RECEP_STATE_IND,R.[POSTAL_STATUS_CD],R.[EVT_TYPE_CD],R.[EVT_CONSGNT_PID]  		  ,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS 			 ,MAILITMS.MAILITM_WEIGHT , MAILITMS.MAILITM_FID ,MAILITMS.DEST_COUNTRY_CD as M_DEST_COUNTRY_CD ,MAILITMS.ORIG_COUNTRY_CD as M_ORIGIN_COUNTRY 			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL6 else 0 end as COL6 			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL7 else 0 end as COL7  			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL8 else 0 end as COL8  			,case when C_POSTAL_STATUSES.POSTAL_STATUS_NM like '%returned' then L_PARCELS.COL9 else 0 end as COL9 			,C_POSTAL_STATUSES.POSTAL_STATUS_NM 	   	  FROM     (select			L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when L_MAILITMS.EVT_RECPTCL_PID  is null then L_MAILITM_EVENTS.[RECPTCL_PID] else L_MAILITMS.EVT_RECPTCL_PID end  as RECPTCL_PID, 											max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT 							from			MonitasDB.[dbo].[L_MAILITMS]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID] and (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							group by		L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT  , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD 											,case when L_MAILITMS.EVT_RECPTCL_PID  is null then L_MAILITM_EVENTS.[RECPTCL_PID] else L_MAILITMS.EVT_RECPTCL_PID end 				   ) as MAILITMS 		--INNER JOIN     [MonitasDB].[dbo].L_MAILITM_EVENTS ON MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 		--AND				MAILITMS.CAPTURE_DT = L_MAILITM_EVENTS.CAPTURE_GMT_DT  	 INNER JOIN    [MonitasDB].[dbo].L_RECPTCLS R ON R.RECPTCL_PID = MAILITMS.RECPTCL_PID 	  INNER JOIN [MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  INNER JOIN [dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  	  INNER JOIN [dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	 LEFT OUTER JOIN [MonitasDB].[dbo].L_PARCELS ON L_PARCELS.MAILITM_PID = MAILITMS.MAILITM_PID 	 LEFT OUTER JOIN C_POSTAL_STATUSES on MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD  	  where  	  L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD = 'USJECS'  	   and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD = 'B' and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like 'C%' 	   --and convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 	   and convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-31' 	   --and L_MAILITMS.POSTAL_STATUS_CD='0' 	   --and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '11' and '12' 	  --and substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) between '0023' and '0025'     	 --ORDER BY L_DESPTCHS.[DESPTCH_FID],L_MAILITMS.MAILITM_FID 	  ) as ORIGIN  	INNER JOIN [dbo].[TR_CPP_CP87_MAIN] ON TR_CPP_CP87_MAIN.DISPATCHIN_ID = ORIGIN.[DESPTCH_FID] collate Thai_CI_AS 	/*INNER JOIN [dbo].[C_CPP_RATE_AIR] ON TR_CPP_CP87_MAIN.CP87_YEAR = C_CPP_RATE_AIR.CPP_RATE_YEAR  	AND ORIGIN.ORIGIN_COUNTRY = C_CPP_RATE_AIR.COUNTRY_ORIGIN_CD AND ORIGIN.DEST_COUNTRY = C_CPP_RATE_AIR.COUNTRY_DEST_CD*/ 	INNER JOIN C_MONTH ON C_MONTH.MONTH_SEQ = origin.DT_MONTH 	 --WHERE ORIGIN.MAILITM_FID='CP070711838TH' 	 WHERE                 concat(ORIGIN.DESPTCH_FID,ORIGIN.MAILITM_FID) collate thai_ci_as 	not in             (select concat(TR_CPP_CP87_DETAIL.DISPATCHIN_ID,TR_CPP_CP87_DETAIL.PARCEL_ID)  from TR_CPP_CP87_DETAIL  	                       inner join TR_CPP_CP87_MAIN on TR_CPP_CP87_MAIN.CP87_SEQ = TR_CPP_CP87_DETAIL.CP87_SEQ   						    where TR_CPP_CP87_DETAIL.DEL_FLAG = 'N' and TR_CPP_CP87_MAIN.DEL_FLAG ='N' and TR_CPP_CP87_MAIN.MAIL_CATEGORY ='B' 							--and TR_CPP_CP87_MAIN.DESPTCH_DATE between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 							and TR_CPP_CP87_MAIN.DESPTCH_DATE between '2024-03-01' and '2024-03-31' 							) 	 ORDER BY   ORIGIN.[DESPTCH_FID], ORIGIN.MAILITM_FID   END ",6149,33043,-26894,1246423,211,6149
"    -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_L_MAILITMS_TMP] 	-- Add the parameters for the stored procedure here AS BEGIN	    -- TRUNCATE TABLE L_MAILITMS_TMP; 	INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	--INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS  	 	--INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	--INNER JOIN			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	--and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	--where convert(date,LME.CAPTURE_GMT_DT) between '2024-04-01' and '2024-04-20' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	--where year([CAPTURE_GMT_DT]) = '2024'  and month([CAPTURE_GMT_DT]) = '04' 	) 	     END ",5991,28449,-22458,2667069,308,5991
"       CREATE PROCEDURE [dbo].[PROC_INSERT_TR_BGS_CN38A_DETAIL_EMS]  	 AS BEGIN 	INSERT INTO [dbo].[TR_BGS_CN38A_DETAIL]  ([CN38_SEQ]       ,[CN38_OFFICE_ORIGIN]       ,[CN38_OFFICE_DESTINATION],[DESPTCH_PID],[RECPTCL_PID]       ,[CN38_MAIL_CATEGORY]       ,[CN38_YEAR]       ,[CN38_DESP_SERIAL_NO]       ,[CN38_TOT_IN_DISP]       ,[CN38_RECP_SERIAL_NO]       ,[CN38_NO_POST_BAG] 	  --,[CN38_NO_CP_BAG_LOOSE_PARCEL]       ,[CN38_GROSS_WEIGHT_LETTER_POST]--,[CN38_GROSS_WEIGHT_CP] 	  ,CN38_EVENT_TYPE       ,[DEL_FLAG]       ,[RECORD_STATUS]       ,[CREATE_USER_ID]       ,[CREATE_DATE] ,[UPDATE_USER_ID] ,[UPDATE_DATE]    )  SELECT		CN38_DETAIL.CN38_SEQ, CN38_DETAIL.OFFICE_FCD, CN38_DETAIL.DEST_OFFICE, CN38_DETAIL.ACC_DESPTCH_FID, CN38_DETAIL.RECPTCL_FID 			,CN38_DETAIL.CN38_MAIL_CATEGORY, CN38_DETAIL.CN38_YEAR ,CN38_DETAIL.CN38_DESP_SERIAL_NO ,CN38_DETAIL.CN38_TOT_IN_DISP 			,CN38_DETAIL.CN38_RECP_SERIAL_NO, CN38_DETAIL.CN38_NO_POST_BAG 			,CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST ,CN38_DETAIL.EVT_TYPE_CD 			,'N' as  [DEL_FLAG] 		   ,'A' as [RECORD_STATUS] 		   ,99 as [CREATE_USER_ID] 		   ,getdate() as [CREATE_DATE] 		   ,99 as [UPDATE_USER_ID] 		   ,getdate() as [UPDATE_DATE]  FROM ( 		SELECT  TR_BGS_CN38A_MAIN.CN38_SEQ,C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD as DEST_OFFICE,L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,substring(R.RECPTCL_FID,1,20) as RECPTCL_FID 			  ,concat(L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,2)) as CN38_MAIL_CATEGORY 			  ,substring(convert(varchar(4),year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)),4,1) as CN38_YEAR 			  ,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as CN38_DESP_SERIAL_NO 			  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as CN38_TOT_IN_DISP 			  ,0 as [CN38_RECP_SERIAL_NO] 			 , null as CN38_NO_POST_BAG  			 --,null as [CN38_NO_CP_BAG_LOOSE_PARCEL] 			 ,sum(case when substring(R.RECPTCL_FID,14,2) like 'E%' then R.RECPTCL_WEIGHT else 0 end) as CN38_GROSS_WEIGHT_LETTER_POST 			 ,0 as EVT_TYPE_CD 			 --,case when STG_BGS_CN38_AIR2.MAIL_SUBCLASS_FCD='CN' then [DESPTCH_WEIGHT] else null end as [CN38_GROSS_WEIGHT_CP] 			   	   		FROM				[MonitasDB].[dbo].L_RECPTCLS R 		  INNER JOIN		[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 		  INNER JOIN		[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  		  INNER JOIN		[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  		  INNER JOIN		[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 		  INNER JOIN		[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  		 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 		  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 		  INNER JOIN		[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID  		INNER JOIN			[dbo].[TR_BGS_CN38A_MAIN] ON TR_BGS_CN38A_MAIN.CN38_OFFICE_ORIGIN = C_OFFICES.OFFICE_SEQ 		and					TR_BGS_CN38A_MAIN.CN38_OFFICE_DESTINATIONS = DES_OFF.OFFICE_SEQ 		and					TR_BGS_CN38A_MAIN.[CN38_MAIL_CATEGORY] =  'E' 		and					substring(R.RECPTCL_FID,14,1) collate THAI_CI_AS = TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS 		and				REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') collate THAI_CI_AS = TR_BGS_CN38A_MAIN.CN38_FLIGHTNO 		and					TR_BGS_CN38A_MAIN.CN38_DATE_OF_DEPART = L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 		and					TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID = L_CONSGNTS.CONSGNT_FID collate THAI_CI_AS 		and					TR_BGS_CN38A_MAIN.DEL_FLAG ='N'  		WHERE			convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = convert(date,getdate()-1) --and			month(L_DESPTCHS.[DESPTCH_DEPARTURE_DT]) in('04') 		--and				month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '08' and '12' 		and			substring(R.RECPTCL_FID,14,2) like ('E%')  		and			substring(R.RECPTCL_FID,14,2) not like ('%T') and	substring(R.RECPTCL_FID,21,3) not like 'T%' 		--and L_CONSGNTS.CONSGNT_FID='THBKKC443851' 		--and			substring(R.RECPTCL_FID,14,2) not in('EV') 		--and			L_DESPTCHS.DESPTCH_FID ='THBKKANOOSLBACN30103' 		GROUP BY      TR_BGS_CN38A_MAIN.CN38_SEQ ,C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD ,L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,substring(R.RECPTCL_FID,1,20)  						,concat(L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,2))  					,substring(convert(varchar(4),year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)),4,1)  					,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4)  					,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS   		UNION ALL 		-------------- Detail ---------- 		SELECT  TR_BGS_CN38A_MAIN.CN38_SEQ as CN38_SEQ, ''  as OFFICE_FCD 			  ,'' as DEST_OFFICE ,L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,R.RECPTCL_FID 			  ,'' as CN38_MAIL_CATEGORY 			  ,'' as CN38_YEAR 			  ,'' as CN38_DESP_SERIAL_NO 			   ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as CN38_TOT_IN_DISP 			  ,convert(int,substring(R.RECPTCL_FID,21,3)) as [CN38_RECP_SERIAL_NO] 			 ,case when substring(R.RECPTCL_FID,14,2)like 'E%' then 1 else 0 end as CN38_NO_POST_BAG	  			  ,case when substring(R.RECPTCL_FID,14,2) like 'E%' then [RECPTCL_WEIGHT] else 0 end as CN38_GROSS_WEIGHT_LETTER_POST 			  ,R.EVT_TYPE_CD 	 			   	   		FROM  [MonitasDB].[dbo].L_RECPTCLS R 		  INNER JOIN [MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 		  INNER JOIN [dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  		  INNER JOIN [dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  		  INNER JOIN  [dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 		  INNER JOIN  [dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  		 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 		  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 		  INNER JOIN [MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID  		INNER JOIN		[dbo].[TR_BGS_CN38A_MAIN] ON TR_BGS_CN38A_MAIN.CN38_OFFICE_ORIGIN = C_OFFICES.OFFICE_SEQ 		and				TR_BGS_CN38A_MAIN.CN38_OFFICE_DESTINATIONS = DES_OFF.OFFICE_SEQ 		and				TR_BGS_CN38A_MAIN.[CN38_MAIL_CATEGORY] = 'E' 		and				substring(R.RECPTCL_FID,14,1) collate THAI_CI_AS = TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS 		and				REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') collate THAI_CI_AS = TR_BGS_CN38A_MAIN.CN38_FLIGHTNO 		and				TR_BGS_CN38A_MAIN.CN38_DATE_OF_DEPART = L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 		and				TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID = L_CONSGNTS.CONSGNT_FID collate THAI_CI_AS 		and				TR_BGS_CN38A_MAIN.DEL_FLAG ='N'  		WHERE			convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = convert(date,getdate()-1) --and			month(L_DESPTCHS.[DESPTCH_DEPARTURE_DT]) in('04') 		--and     month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '08' and '12' 		and			substring(R.RECPTCL_FID,14,2) like ('E%') 		and			substring(R.RECPTCL_FID,14,2) not like ('%T') and	substring(R.RECPTCL_FID,21,3) not like 'T%' 		--and L_CONSGNTS.CONSGNT_FID='THBKKC443851' 		--and			substring(R.RECPTCL_FID,14,2) not in('EV')  		) as CN38_DETAIL  ORDER BY CN38_SEQ, CN38_DETAIL.RECPTCL_FID END ",5878,30591,-24713,411279,12,5878
"    -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_UPDATE_T_EMS_CN31_CN33_DETAIL]  	 AS BEGIN 	--TRUNCATE TABLE T_EMS_CN31_CN33_DETAIL;  -- +  +  +   +   + รายจ่าย +  +  +  +  +  +  +  	UPDATE		[dbo].[T_EMS_CN31_CN33_DETAIL] 	SET			[ITEM_WEIGHT] = UP.MAILITM_WEIGHT 				,RECPTCL_WEIGHT = UP.RECPTCL_WEIGHT 				,RECPTCL_ITEMS = UP.RECPTCL_MAILITMS_NO 				,[OBSERVATION] = UP.Observation 				,[UPDATE_DATE] = getdate() 				 	FROM    (SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,substring(R.RECPTCL_FID,21,3) as [BAG_NO] 						 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 					  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 					  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 				FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 				INNER JOIN				[MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 				LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 				LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 				INNER JOIN				(select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 													L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 													L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 													case when L_MAILITM_EVENTS.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else L_MAILITM_EVENTS.[RECPTCL_PID] end  as RECPTCL_PID 													,max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT 											from    MonitasDB.[dbo].[L_MAILITMS]  											left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID] and (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 											group by L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 													L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 													L_MAILITMS.MAILITM_WEIGHT  , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 													case when L_MAILITM_EVENTS.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else L_MAILITM_EVENTS.[RECPTCL_PID] end  										   ) as L_MAILITMS 				 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID 				 INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 				  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 				 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  				  where					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --and L_DESPTCHS.[DEST_OFFICE_FCD] like('CNSH%') 				  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 				  --and	convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = convert(date,getdate()-1) 				 and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 				 --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 				-- and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-02-05' 				 				 and   substring(R.RECPTCL_FID,21,3) not like 'T%' 				  --and month(L_DESPTCHS.DESPTCH_DEPARTURE_DT) ='10' 				  --and right(L_DESPTCHS.DESPTCH_FID,4)='2535' 			 ) as UP 			 INNER JOIN		T_EMS_CN31_CN33_DETAIL ON T_EMS_CN31_CN33_DETAIL.[RECPTCL_FID] = UP.RECPTCL_FID collate thai_ci_as and T_EMS_CN31_CN33_DETAIL.ITEMS_ID = UP.MAILITM_FID collate thai_ci_as     -- +  +  +   +   + รายได้ +  +  +  +  +  +  + 	UPDATE		[dbo].[T_EMS_CN31_CN33_DETAIL] 	SET			[ITEM_WEIGHT] = UP.MAIL_WEIGHT 				,RECPTCL_WEIGHT = UP.RECPTCL_WEIGHT 				,RECPTCL_ITEMS = UP.RECPTCL_MAILITMS_NO 				,[OBSERVATION] = UP.Observation 				,[UPDATE_DATE] = getdate()  	FROM	(SELECT			substring(R.RECPTCL_FID,1,20) as DISPATCHING_ID ,T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ, substring(R.RECPTCL_FID,21,3) as [BAG_NO] 							,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 							,N_EDI_MAILITMS.MAIL_WEIGHT ,RE_EDI.RECPTCL_WEIGHT	,RE_EDI.RECPTCL_MAILITMS_NO	,RE_EDI.RECPTCL_FID 							, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  							,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 							,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 							,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 			FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA	 			INNER JOIN			[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 			INNER JOIN          [MonitasDB].[dbo].N_EDI_MAILITMS ON RE_EDI.RECPTCL_PID = N_EDI_MAILITMS.RECPTCL_PID 			INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON RE_EDI.RECPTCL_FID = R.RECPTCL_FID 			INNER JOIN			[MonitasDB].[dbo].L_MAILITMS ON L_MAILITMS.MAILITM_FID = N_EDI_MAILITMS.MAILITM_FID 			INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(RE_EDI.RECPTCL_FID,1,5) collate THAI_CI_AS 			INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(RE_EDI.RECPTCL_FID,7,5) collate THAI_CI_AS 			INNER JOIN			C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 			INNER JOIN				T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= substring(RE_EDI.RECPTCL_FID,1,20) collate THAI_CI_AS 			AND					   T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)    			where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and substring(R.RECPTCL_FID,1,6) like 'IDJKT%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month		 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-02-05' 			 		 			and					substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 		--and                 substring(RE_EDI.RECPTCL_FID,1,20) = 'AUSYDBTHBKKBAED40008' 	  ) as UP 	INNER JOIN		T_EMS_CN31_CN33_DETAIL ON T_EMS_CN31_CN33_DETAIL.[RECPTCL_FID] = UP.RECPTCL_FID collate thai_ci_as  and T_EMS_CN31_CN33_DETAIL.ITEMS_ID = UP.MAILITM_FID collate thai_ci_as   END ",5720,31627,-25907,1038613,758,5720
"	select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT  	from    MonitasDB.[dbo].[L_MAILITMS]  	left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  					FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 					WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 					GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 				)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EE187476734TH'  	where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	and L_MAILITMS.MAIL_CLASS_CD = 'E'",5362,32036,-26674,18944800,0,5362
" /*Update By Umarin 11092023*/    CREATE PROCEDURE [dbo].[PROC_INSERT_TR_BGS_CN38A_MAIN_AIR]  	 AS BEGIN  INSERT INTO [dbo].[TR_BGS_CN38A_MAIN] ([CN38_POSTAL_DESIGNATED_OPER_ORIGIN]       ,[CN38_OFFICE_ORIGIN]       ,[CN38_OFFICE_DESTINATIONS]       ,[CN38_DATE]       ,[CN38_CONSIGNMENT_ID]       ,[CN38_TYPEOFMAIL] ,[CN38_MAIL_CATEGORY]  ,[CN38_MAIL_SUBCLASS]       ,[CN38_FLIGHTNO]       ,[CN38_DATE_OF_DEPART]       ,[CN38_TIME_OF_DEPART]       ,[CN38_AIRPORT_OF_DIRECT_TRANSHIPMENT]       ,[CN38_AIRPORT_OF_OFFLOADING]       ,[CN38_ROUTE]	  	  ,[CN38_DEST_LOCATION] 	   ,[CN38_BY]       ,[CN38_TYPEOFMAIL_SELECT]       ,[DEL_FLAG]       ,[RECORD_STATUS]       ,[CREATE_USER_ID]       ,[CREATE_DATE]  ,[UPDATE_USER_ID] ,[UPDATE_DATE]       	  ) SELECT				A.CN38_POSTAL_DESIGNATED_OPER_ORIGIN , A.CN38_OFFICE_ORIGIN ,A.CN38_OFFICE_DESTINATIONS ,A.[DESPTCH_DEPARTURE_DT]--,A.DISP_NO 					, A.CONSGNT_FID, A.CN38_TYPEOFMAIL ,A.MAIL_CATEGORY_CD ,A.CN38_MAIL_SUBCLASS ,A.FLIGHTS 					,A.CN38_DATE_OF_DEPART ,A.CN38_TIME_OF_DEPART 					,CASE WHEN B.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NULL THEN A.AIRPORT_OF_DIRECT_TRANSHIPMENT ELSE B.AIRPORT_OF_DIRECT_TRANSHIPMENT END AS AIRPORT_OF_DIRECT_TRANSHIPMENT 					,CASE WHEN B.AIRPORT_OF_OFFLOADING IS NULL THEN A.AIRPORT_OF_OFFLOADING ELSE B.AIRPORT_OF_OFFLOADING END AS AIRPORT_OF_OFFLOADING 					,CASE WHEN B.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NULL AND A.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NOT NULL THEN CONCAT(A.AIRPORT_OF_DIRECT_TRANSHIPMENT,'/',A.AIRPORT_OF_OFFLOADING) 						WHEN B.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NOT NULL THEN CONCAT('BKK','/',B.AIRPORT_OF_DIRECT_TRANSHIPMENT,'/',B.AIRPORT_OF_OFFLOADING) 					  ELSE null END AS CN38_ROUND 					,CASE WHEN B.LOCATION_FCD IS NULL THEN A.LOCATION_FCD ELSE B.LOCATION_FCD END AS LOCATION_FCD 					,'1' as CN38_BY , '1' as CN38_TYPEOFMAIL_SELECT 					,'N' as  [DEL_FLAG] 					,'A' as [RECORD_STATUS] 					,99 as [CREATE_USER_ID] 					,getdate() as [CREATE_DATE] 					,99 as [UPDATE_USER_ID] 					,getdate() as [UPDATE_DATE] FROM 				(select				C_OFFICES.OFFICE_SEQ as CN38_POSTAL_DESIGNATED_OPER_ORIGIN 											,C_OFFICES.OFFICE_SEQ as CN38_OFFICE_ORIGIN ,DES_OFF.OFFICE_SEQ as CN38_OFFICE_DESTINATIONS 											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as [DESPTCH_DEPARTURE_DT] --,substring(R.RECPTCL_FID,17,4) as DISP_NO 											---------L_CONSGNTS--- 											,L_CONSGNTS.CONSGNT_FID as CONSGNT_FID  											,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end as CN38_TYPEOFMAIL 											,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1) as CN38_MAIL_SUBCLASS   											,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS 											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_DATE_OF_DEPART 											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_TIME_OF_DEPART 											,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) as AIRPORT_OF_DIRECT_TRANSHIPMENT 											,substring(L_LEGS.DEST_LOCATION_FCD,3,3) as AIRPORT_OF_OFFLOADING 											,DEST_LOCATION.LOCATION_FCD 											,sum(R.RECPTCL_WEIGHT) as RECPTCL_WEIGHT  					from				[MonitasDB].[dbo].L_RECPTCLS R								 					inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 					LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 					LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 					INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  					INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  					INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 					INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  					INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 					inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 					left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID 					WHERE				year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) ='2024' 					--and					month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '08' and '12' 					--and					day(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) ='26' 					and					(L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like ('U%') or L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like ('C%'))  					and					substring(R.RECPTCL_FID,14,2) not like ('%T')  and substring(R.RECPTCL_FID,21,3) not like ('T%') 					and					L_ROUTES_LEGS.LEG_ORDER_NO = 0  					and					C_OFFICES.OFFICE_FCD like 'THBKK%' 					--and					R.EVT_TYPE_CD = '178' 					--and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD in('GRATHA')  					--and L_CONSGNTS.CONSGNT_FID ='THBKKC449096' 					--and					substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) in('2114' ,'2116') 		GROUP BY C_OFFICES.OFFICE_SEQ  											,C_OFFICES.OFFICE_SEQ  ,DES_OFF.OFFICE_SEQ  											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT  --,substring(R.RECPTCL_FID,17,4) as DISP_NO 											---------L_CONSGNTS--- 											,L_CONSGNTS.CONSGNT_FID  											,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end  											,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1)  											,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','')  											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 											,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) 											,substring(L_LEGS.DEST_LOCATION_FCD,3,3)  											,DEST_LOCATION.LOCATION_FCD                   ) AS A  LEFT OUTER JOIN 			( select				C_OFFICES.OFFICE_SEQ as CN38_POSTAL_DESIGNATED_OPER_ORIGIN 									,C_OFFICES.OFFICE_SEQ as CN38_OFFICE_ORIGIN ,DES_OFF.OFFICE_SEQ as CN38_OFFICE_DESTINATIONS 									,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as [DESPTCH_DEPARTURE_DT] --,substring(R.RECPTCL_FID,17,4) as DISP_NO 									---------L_CONSGNTS--- 									,L_CONSGNTS.CONSGNT_FID as CONSGNT_FID  									,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end as CN38_TYPEOFMAIL 									,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1) as CN38_MAIL_SUBCLASS   									,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as  FLIGHTS 									,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_DATE_OF_DEPART 									,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as CN38_TIME_OF_DEPART 									,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) as AIRPORT_OF_DIRECT_TRANSHIPMENT 									,substring(L_LEGS.DEST_LOCATION_FCD,3,3) as AIRPORT_OF_OFFLOADING 									,DEST_LOCATION.LOCATION_FCD 									,sum(R.RECPTCL_WEIGHT) as RECPTCL_WEIGHT  			from				[MonitasDB].[dbo].L_RECPTCLS R								 					inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 					LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 					LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 					INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  					INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  					INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD 					INNER JOIN			[dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD  					INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 					inner join			[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 					left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID 					WHERE				year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) ='2024' 					--and					month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '08' and '12' 					--and					day(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) ='26' 					and					(L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like ('U%') or L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD like ('C%'))  					and					substring(R.RECPTCL_FID,14,2) not like ('%T')  and substring(R.RECPTCL_FID,21,3) not like ('T%') 					and					L_ROUTES_LEGS.LEG_ORDER_NO = 1  					and					C_OFFICES.OFFICE_FCD like 'THBKK%' 					--and					R.EVT_TYPE_CD = '178' 					--and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD in('GRATHA')  					--and L_CONSGNTS.CONSGNT_FID ='THBKKC449096' 					--and					substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) in('2114' ,'2116') 		GROUP BY C_OFFICES.OFFICE_SEQ  											,C_OFFICES.OFFICE_SEQ  ,DES_OFF.OFFICE_SEQ  											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT  --,substring(R.RECPTCL_FID,17,4) as DISP_NO 											---------L_CONSGNTS--- 											,L_CONSGNTS.CONSGNT_FID  											,CASE WHEN L_ACC_DESPTCH_RAW_DATA.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end  											,L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,1)  											,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','')  											,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT 											,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) 											,substring(L_LEGS.DEST_LOCATION_FCD,3,3)  											,DEST_LOCATION.LOCATION_FCD 			 			) AS B ON	A.CN38_OFFICE_ORIGIN = B.CN38_OFFICE_ORIGIN  AND A.CN38_OFFICE_DESTINATIONS = B.CN38_OFFICE_DESTINATIONS AND A.DESPTCH_DEPARTURE_DT = B.DESPTCH_DEPARTURE_DT  AND A.CONSGNT_FID = B.CONSGNT_FID AND A.FLIGHTS = B.FLIGHTS AND A.MAIL_CATEGORY_CD = B.MAIL_CATEGORY_CD and A.CN38_MAIL_SUBCLASS = B.CN38_MAIL_SUBCLASS AND A.LOCATION_FCD = B.LOCATION_FCD  WHERE CONVERT(date,A.CN38_DATE_OF_DEPART) = convert(date,getdate()-1) ORDER BY  A.DESPTCH_DEPARTURE_DT   END ",5249,31758,-26509,11165026,36,5249
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-04-01' and '2023-04-30' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '04' 	) 	 ",5134,26652,-21518,4331092,5650,5134
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-06-01' and '2023-06-30' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '06' 	) 	",4962,28477,-23515,3647731,5550,4962
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-08-01' and '2023-08-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '08' 	) 	 ",4957,28985,-24028,3639542,5531,4957
"select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 										case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 										LME.CAPTURE_GMT_DT 							 from    MonitasDB.[dbo].[L_MAILITMS]  							 left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  												FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 												WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 												GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 											)  							 AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  							left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 							and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT 							 where year(CAPTURE_DT)='2023' and  month(CAPTURE_DT)='1' and L_MAILITMS.MAIL_CLASS_CD = 'E'",4950,16307,-11357,769746,0,4950
"      CREATE PROCEDURE [dbo].[PROC_INSERT_TR_BGS_CN38A_DETAIL_AIR]  AS BEGIN 	--truncate table TR_BGS_CN38A_DETAIL  INSERT INTO [dbo].[TR_BGS_CN38A_DETAIL]  ([CN38_SEQ]       ,[CN38_OFFICE_ORIGIN]       ,[CN38_OFFICE_DESTINATION],[DESPTCH_PID],[RECPTCL_PID]       ,[CN38_MAIL_CATEGORY]       ,[CN38_YEAR]       ,[CN38_DESP_SERIAL_NO]       ,[CN38_TOT_IN_DISP]       ,[CN38_RECP_SERIAL_NO]       ,[CN38_NO_POST_BAG] 	  ,[CN38_NO_CP_BAG_LOOSE_PARCEL]       ,[CN38_GROSS_WEIGHT_LETTER_POST],[CN38_GROSS_WEIGHT_CP] 	  ,CN38_EVENT_TYPE       ,[DEL_FLAG]       ,[RECORD_STATUS]       ,[CREATE_USER_ID]       ,[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]   )  SELECT		CN38_DETAIL.CN38_SEQ, CN38_DETAIL.OFFICE_FCD, CN38_DETAIL.DEST_OFFICE, CN38_DETAIL.ACC_DESPTCH_FID, CN38_DETAIL.RECPTCL_FID 			,CN38_DETAIL.CN38_MAIL_CATEGORY, CN38_DETAIL.CN38_YEAR ,CN38_DETAIL.CN38_DESP_SERIAL_NO ,CN38_DETAIL.CN38_TOT_IN_DISP 			,CN38_DETAIL.CN38_RECP_SERIAL_NO, CN38_DETAIL.CN38_NO_POST_BAG, CN38_DETAIL.CN38_NO_CP_BAG_LOOSE_PARCEL 			,CN38_DETAIL.CN38_GROSS_WEIGHT_LETTER_POST, CN38_DETAIL.CN38_GROSS_WEIGHT_CP ,CN38_DETAIL.EVT_TYPE_CD 			,'N' as  [DEL_FLAG] 		   ,'A' as [RECORD_STATUS] 		   ,99 as [CREATE_USER_ID] 		   ,getdate() as [CREATE_DATE] 		   ,99 as [UPDATE_USER_ID] 		   ,getdate() as [UPDATE_DATE]  FROM ( SELECT		TR_BGS_CN38A_MAIN.CN38_SEQ as CN38_SEQ,C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD as DEST_OFFICE,L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,substring(R.RECPTCL_FID,1,20) as RECPTCL_FID 			,concat(L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,2)) as CN38_MAIL_CATEGORY 			,substring(convert(varchar(4),year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)),4,1) as CN38_YEAR 			,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as CN38_DESP_SERIAL_NO 			,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as CN38_TOT_IN_DISP 			,0 as [CN38_RECP_SERIAL_NO] 			 , null as CN38_NO_POST_BAG ,null as [CN38_NO_CP_BAG_LOOSE_PARCEL] 			,sum(case when substring(R.RECPTCL_FID,14,2) like'U%' then R.RECPTCL_WEIGHT else 0 end) as CN38_GROSS_WEIGHT_LETTER_POST 			,sum(case when substring(R.RECPTCL_FID,14,2) like 'C%' then R.RECPTCL_WEIGHT else 0 end) as [CN38_GROSS_WEIGHT_CP] 			,0 as EVT_TYPE_CD 			     FROM  [MonitasDB].[dbo].L_RECPTCLS R   INNER JOIN [MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20)   INNER JOIN [dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS    INNER JOIN [dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS    INNER JOIN  [dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD   INNER JOIN  [dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD   LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS   LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS   INNER JOIN [MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID  INNER JOIN		[dbo].[TR_BGS_CN38A_MAIN] ON TR_BGS_CN38A_MAIN.CN38_OFFICE_ORIGIN = C_OFFICES.OFFICE_SEQ and				TR_BGS_CN38A_MAIN.CN38_OFFICE_DESTINATIONS = DES_OFF.OFFICE_SEQ and				TR_BGS_CN38A_MAIN.[CN38_MAIL_CATEGORY] = L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD collate THAI_CI_AS and				substring(R.RECPTCL_FID,14,1) collate THAI_CI_AS = TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS --and				REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') collate THAI_CI_AS = TR_BGS_CN38A_MAIN.CN38_FLIGHTNO and				TR_BGS_CN38A_MAIN.CN38_DATE_OF_DEPART = L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT and				TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID = L_CONSGNTS.CONSGNT_FID collate THAI_CI_AS and				TR_BGS_CN38A_MAIN.DEL_FLAG ='N'  WHERE			convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = convert(date,getdate()-1) --and			month(L_DESPTCHS.[DESPTCH_DEPARTURE_DT]) in('04') --and     month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '08' and '12' and			(substring(R.RECPTCL_FID,14,2) like ('U%') or substring(R.RECPTCL_FID,14,2) like ('C%'))  and			substring(R.RECPTCL_FID,14,2) not like ('%T') and	substring(R.RECPTCL_FID,21,3) not like 'T%' --and       DES_OFF.OFFICE_FCD ='GRATHA' --and			substring(R.RECPTCL_FID,17,4) ='2016' --and L_CONSGNTS.CONSGNT_FID='THBKKC449104' --and			substring(R.RECPTCL_FID,14,2) not in('UV','CV') --and			L_DESPTCHS.DESPTCH_FID ='THBKKANOOSLBACN30103' GROUP BY      TR_BGS_CN38A_MAIN.CN38_SEQ ,C_OFFICES.[OFFICE_FCD], DES_OFF.OFFICE_FCD ,L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,substring(R.RECPTCL_FID,1,20)  			,concat(L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD ,substring(R.RECPTCL_FID,14,2))  			,substring(convert(varchar(4),year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)),4,1)  			,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4)  			,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS   UNION ALL -------------- Detail ---------- SELECT  TR_BGS_CN38A_MAIN.CN38_SEQ as CN38_SEQ, '' as [OFFICE_FCD], '' as DEST_OFFICED ,L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,R.RECPTCL_FID 			,'' as CN38_MAIL_CATEGORY 			,''  as CN38_YEAR 			,substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,17,4) as CN38_DESP_SERIAL_NO 			,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS as CN38_TOT_IN_DISP 			,convert(int,substring(R.RECPTCL_FID,21,3)) as [CN38_RECP_SERIAL_NO] 			 ,case when substring(R.RECPTCL_FID,14,2) like 'U%' then 1 else 0 end as CN38_NO_POST_BAG  			 ,case when substring(R.RECPTCL_FID,14,2) like'C%' then 1 else 0 end as [CN38_NO_CP_BAG_LOOSE_PARCEL] 			,case when substring(R.RECPTCL_FID,14,2) like'U%' then R.RECPTCL_WEIGHT else 0 end as CN38_GROSS_WEIGHT_LETTER_POST 			,case when substring(R.RECPTCL_FID,14,2) like 'C%' then R.RECPTCL_WEIGHT else 0 end as [CN38_GROSS_WEIGHT_CP] 			,R.EVT_TYPE_CD 			     FROM  [MonitasDB].[dbo].L_RECPTCLS R   INNER JOIN [MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20)   INNER JOIN [dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS    INNER JOIN [dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS    INNER JOIN  [dbo].[C_OPERATORS_COUNTRIES] CO_ORI on C_OFFICES.COUNTRY_CD = CO_ORI.[COUNTRY_CD] and CO_ORI.OPERATOR_CD = C_OFFICES.OPERATOR_CD   INNER JOIN  [dbo].[C_OPERATORS_COUNTRIES] CO_DEST on CO_DEST.COUNTRY_CD = DES_OFF.COUNTRY_CD and CO_DEST.OPERATOR_CD = DES_OFF.OPERATOR_CD   LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS   LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS   INNER JOIN [MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID  INNER JOIN		[dbo].[TR_BGS_CN38A_MAIN] ON TR_BGS_CN38A_MAIN.CN38_OFFICE_ORIGIN = C_OFFICES.OFFICE_SEQ and				TR_BGS_CN38A_MAIN.CN38_OFFICE_DESTINATIONS = DES_OFF.OFFICE_SEQ and				TR_BGS_CN38A_MAIN.[CN38_MAIL_CATEGORY] = L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD collate THAI_CI_AS and				substring(R.RECPTCL_FID,14,1) collate THAI_CI_AS = TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS --and				REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') collate THAI_CI_AS = TR_BGS_CN38A_MAIN.CN38_FLIGHTNO and				TR_BGS_CN38A_MAIN.CN38_DATE_OF_DEPART = L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT and				TR_BGS_CN38A_MAIN.CN38_CONSIGNMENT_ID = L_CONSGNTS.CONSGNT_FID collate THAI_CI_AS and				TR_BGS_CN38A_MAIN.DEL_FLAG ='N'  WHERE			convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = convert(date,getdate()-1) --and			month(L_DESPTCHS.[DESPTCH_DEPARTURE_DT]) in('04') --and     month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '08' and '12' and			(substring(R.RECPTCL_FID,14,2) like ('U%') or substring(R.RECPTCL_FID,14,2) like ('C%'))  and			substring(R.RECPTCL_FID,14,2) not like ('%T') --and L_CONSGNTS.CONSGNT_FID='THBKKC449104' and			substring(R.RECPTCL_FID,21,3) not like 'T%'  ) as CN38_DETAIL   ORDER BY CN38_SEQ, CN38_DETAIL.RECPTCL_FID     END ",4839,32689,-27850,1374267,560,4839
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 				([DISPATCHING_ID],[CN31EMS_SEQ], RKEY, 				[BAG_NO], [ITEMS_ID] ,[OFFICE_LODGING] ,[ITEM_WEIGHT] 				,RECPTCL_WEIGHT,RECPTCL_ITEMS ,RECPTCL_FID 				,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 				,[CREATE_USER_ID] ,[CREATE_DATE] ,[UPDATE_USER_ID],[UPDATE_DATE] 				) 	SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 	   --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID and L_MAILITMS.MAIL_CLASS_CD = 'E' 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	 -- where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 --not in			(select RKEY   		--						from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 		--						and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 		--						where convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-12-31' 		--						--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  		--						) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",4829,12774,-7945,868436,11973,4829
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-11-01' and '2023-11-30' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '11' 	) 	 ",4755,28280,-23525,3465593,5233,4755
delete [IASDB].[dbo].[L_MAILITMS_TMP]  --where trim(MAILITM_FID) = 'LP053215958TH'  where year([CAPTURE_GMT_DT]) = '2023',4664,6070,-1406,2490390,29636,4664
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-07-01' and '2023-07-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '07' 	) 	",4622,25523,-20901,3706246,5481,4622
"	select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT  	from    MonitasDB.[dbo].[L_MAILITMS]  	left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  					FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 					WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 					GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 				)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EE187476734TH'  	where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	and L_MAILITMS.MAIL_CLASS_CD = 'E' 	order by L_MAILITMS.MAILITM_PID",4574,26601,-22027,18793010,0,4574
" select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT  	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	",4574,23286,-18712,2140876,66,4574
SELECT COUNT(*) FROM VIEW_LIST_EMS_CN31 WHERE (CN31EMS_YEAR like '202%') ;,4497,14572,-10075,56696,47,4497
"  INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT])     	select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT  	from    MonitasDB.[dbo].[L_MAILITMS]  	left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  					FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 					WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 					GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 				)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EE187476734TH'  	where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	and L_MAILITMS.MAIL_CLASS_CD = 'E' 	and L_MAILITMS.MAILITM_FID not in(select MAILITM_FID from L_MAILITMS_TMP) ",4405,25001,-20596,16165118,524,4405
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-05-01' and '2023-05-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '05' 	) 	 ",4375,25422,-21047,3864780,5691,4375
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-12-01' and '2023-12-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '12' 	) 	 ",4328,24859,-20531,3636747,5483,4328
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-10-01' and '2023-10-31' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '10' 	) 	 ",4298,24520,-20222,3444044,5130,4298
"TRUNCATE TABLE L_MAILITMS_TMP; 	INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT])     	select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT  	from    MonitasDB.[dbo].[L_MAILITMS]  	left outer join (SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  					FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 					WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 					GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 				)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EE187476734TH'  	where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	",4006,20355,-16349,1201498,1383,4006
"  -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_T_EMS_CN33_DETAIL_TMP_IN]  	-- Add the parameters for the stored procedure here 	 AS BEGIN 	-- SET NOCOUNT ON added to prevent extra result sets from 	-- interfering with SELECT statements. 	 -- TRUNCATE TABLE T_EMS_CN31_CN33_DETAIL_TMP1;   INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL_TMP1] 					([DISPATCHING_ID],DESPTCH_DT,RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]  	)				  	select		 distinct L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY 						,substring(R.RECPTCL_FID,21,3)   as [BAG_NO] 						, R.RECPTCL_WEIGHT  as RECPTCL_WEIGHT	 						, R.RECPTCL_MAILITMS_NO  as RECPTCL_MAILITMS_NO	 						, R.RECPTCL_FID  as RECPTCL_FID 						,trim(L_MAILITMS.MAILITM_FID) as MAILITM_FID 						,L_MAILITMS.MAILITM_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 										max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 						from			[MonitasDB].[dbo].L_MAILITMS  						--where			trim(MAILITM_FID) = 'EN314572505JP' 						GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-04-01' and '2024-04-20' 			--and			trim(L_MAILITMS.MAILITM_FID) = 'EN314572505JP'	 			and     concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID))  collate THAI_CI_AS 			not in (select RKEY from T_EMS_CN31_CN33_DETAIL_TMP1  						where convert(date,DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 					) 			order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)  	/*+   +    +    +    +    +   +  */ 	--TRUNCATE TABLE T_EMS_CN31_CN33_DETAIL_TMP2; 	INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL_TMP2] 					([DISPATCHING_ID],DESPTCH_DT,RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]) 	select		T_EMS_CN31_CN33_MAIN.DISPATCHING_ID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat( L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(EM.MAILITM_FID)) as RKEY 						, substring(RE_EDI.RECPTCL_FID,21,3)  as [BAG_NO] 						--,case when R.RECPTCL_WEIGHT is null then RE_EDI.RECPTCL_WEIGHT else R.RECPTCL_WEIGHT end   as RECPTCL_WEIGHT	 						,RE_EDI.RECPTCL_WEIGHT 						,RE_EDI.RECPTCL_MAILITMS_NO   as RECPTCL_MAILITMS_NO	 						,RE_EDI.RECPTCL_FID   as RECPTCL_FID 						,TRIM(EM.MAILITM_FID)  as MAILITM_FID 						,EM.MAIL_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						,case when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,2) then 'Normal'  						      when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,2) then 'Being returned' 						  else 'Transit' end as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA  	INNER JOIN		[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 	and					substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 	and  RE_EDI.RECPTCL_MAILITMS_NO  is not null  	INNER JOIN		[MonitasDB].[dbo].N_EDI_MAILITMS as EM ON RE_EDI.RECPTCL_PID = EM.RECPTCL_PID and trim(EM.MAILITM_FID) is not null 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2023' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 		 --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-04-01' and '2024-04-20' 		and     concat( L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(EM.MAILITM_FID))  collate THAI_CI_AS 			not in (select RKEY from T_EMS_CN31_CN33_DETAIL_TMP2  						where convert(date,DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 					)	 			--and   RE_EDI.RECPTCL_FID like '%40025%' 			order by RECPTCL_FID ,TRIM(EM.MAILITM_FID)  END ",3680,14436,-10756,967091,25,3680
SELECT COUNT(*) FROM VIEW_LIST_EMS_CN31 WHERE (CN31EMS_YEAR like '2%') ;,3447,14444,-10997,56252,9,3447
SELECT COUNT(*) FROM VIEW_LIST_EMS_CN31 WHERE (CN31EMS_YEAR like '2023%') ;,3443,9343,-5900,53830,13,3443
"SELECT * FROM (SELECT CN31EMS_SEQ,DISPATCHING_OPERATOR_SEQ,DIPS_OPER_NAME,DESTINATION_OPERATOR_SEQ,DEST_OPER_NAME,ORIGIN_OFFICE_SEQ,DESTINATION_OFFICE_SEQ,MAIL_CATEGORY_SEQ,MAIL_CATEGORY_CD,MAIL_SUBCLASS_SEQ,MAIL_SUBCLASS_FCD,DISPATCH_NO,DESPTCH_DATE,DESPTCH_DATE_NAME,TRANSIT_OPERATOR,FLIGHT_TRIP_NUMBERS,CN31EMS_YEAR,CN31EMS_QUARTER,CN31EMS_MONTH,MAIL_NO,SERVICE_TYPE,SERVICE_TYPE_NAME,ZONE,ZONE_NAME_EN,COUNTRY_SEQ,COUNTRY_NM,OBSERVATION,DEL_FLAG,RECORD_STATUS,CREATE_USER_ID,CREATE_DATE,UPDATE_DATE,UPDATE_USER_ID,CREATE_DATE_NAME,UPDATE_DATE_NAME FROM VIEW_LIST_EMS_CN33) AS s WHERE DEL_FLAG = 'N' AND (CN31EMS_YEAR like '2023%' AND SERVICE_TYPE_NAME like 'รายจ่าย%')  ORDER BY CREATE_DATE DESC OFFSET 0 ROWS FETCH FIRST 10 ROWS ONLY; ",3440,3350,90,19668,23,41281
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 				([DISPATCHING_ID],[CN31EMS_SEQ], RKEY, 				[BAG_NO], [ITEMS_ID] ,[OFFICE_LODGING] ,[ITEM_WEIGHT] 				,RECPTCL_WEIGHT,RECPTCL_ITEMS ,RECPTCL_FID 				,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 				,[CREATE_USER_ID] ,[CREATE_DATE] ,[UPDATE_USER_ID],[UPDATE_DATE] 				) 	SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 	  -- and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID and L_MAILITMS.MAIL_CLASS_CD = 'E' 	 INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = L_MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	 -- where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 --not in			(select RKEY   		--						from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 		--						and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 		--						where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between '2023-01-01' and '2023-12-31' 		--						--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  		--						) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3) 	 ",3311,9439,-6128,673556,2833,3311
"INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT],CREATE_DATE )      select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-04-01' and '2023-04-30' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '04' 	) 	",3305,23220,-19915,1272578,4,3305
"  select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-04-01' and '2023-04-30' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '04' 	)",3234,22755,-19521,1272568,2,3234
"select		 distinct L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY 						,substring(R.RECPTCL_FID,21,3)   as [BAG_NO] 						, R.RECPTCL_WEIGHT  as RECPTCL_WEIGHT	 						, R.RECPTCL_MAILITMS_NO  as RECPTCL_MAILITMS_NO	 						, R.RECPTCL_FID  as RECPTCL_FID 						,trim(L_MAILITMS.MAILITM_FID) as MAILITM_FID 						,L_MAILITMS.MAILITM_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 										max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 						from			[MonitasDB].[dbo].L_MAILITMS  						--where			trim(MAILITM_FID) = 'EN314572505JP' 						GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-04-01' and '2024-04-22' 			--and			trim(L_MAILITMS.MAILITM_FID) = 'EN314572505JP'	 			and     concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID))  collate THAI_CI_AS 			not in (select RKEY from T_EMS_CN31_CN33_DETAIL_TMP1  						--where convert(date,DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 						where convert(date,DESPTCH_DT) between '2024-04-01' and '2024-04-22' 					) 			order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)",3218,12659,-9441,811445,0,3218
"SELECT * FROM (SELECT CN31EMS_SEQ,DISPATCHING_OPERATOR_SEQ,DIPS_OPER_NAME,DESTINATION_OPERATOR_SEQ,DEST_OPER_NAME,ORIGIN_OFFICE_SEQ,DESTINATION_OFFICE_SEQ,MAIL_CATEGORY_SEQ,MAIL_CATEGORY_CD,MAIL_SUBCLASS_SEQ,MAIL_SUBCLASS_FCD,DISPATCH_NO,DESPTCH_DATE,DESPTCH_DATE_NAME,TRANSIT_OPERATOR,FLIGHT_TRIP_NUMBERS,CN31EMS_YEAR,CN31EMS_QUARTER,CN31EMS_MONTH,MAIL_NO,SERVICE_TYPE,SERVICE_TYPE_NAME,ZONE,ZONE_NAME_EN,COUNTRY_SEQ,COUNTRY_NM,OBSERVATION,DEL_FLAG,RECORD_STATUS,CREATE_USER_ID,CREATE_DATE,UPDATE_DATE,UPDATE_USER_ID,CREATE_DATE_NAME,UPDATE_DATE_NAME FROM VIEW_LIST_EMS_CN33) AS s WHERE DEL_FLAG = 'N' AND (CN31EMS_YEAR like '2024%' AND SERVICE_TYPE_NAME like 'ราย%')  ORDER BY CREATE_DATE DESC OFFSET 0 ROWS FETCH FIRST 10 ROWS ONLY; ",3193,1621,1572,19653,9,3193
SELECT COUNT(DISTINCT MAILITM_PID) AS ct FROM [MonitasDB].[dbo].L_MAILITMS,3178,17388,-14210,123975,0,3178
"select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			where			trim(MAILITM_FID) = 'CS003211600TH' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD",3052,6530,-3478,552007,0,3052
"TRUNCATE TABLE L_MAILITMS_TMP; 	INSERT INTO [dbo].[L_MAILITMS_TMP]            ([MAILITM_PID]            ,[MAILITM_FID]            ,[MAIL_CLASS_CD]            ,[CURRENCY_CD]            ,[DEST_COUNTRY_CD]            ,[DUTIABLE_IND]            ,[DUTIES_AMOUNT]            ,[MAILITM_WEIGHT]            ,[ORIG_COUNTRY_CD]            ,[OPERATOR_CD]            ,[POSTAL_STATUS_CD]            ,[RECPTCL_PID]            ,[CAPTURE_GMT_DT])     select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT  	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	 	",2997,19125,-16128,1897314,1415,2997
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL] 					([DISPATCHING_ID],[CN31EMS_SEQ],RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]   					) SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID,T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ, T_EMS_CN31_CN33_DETAIL_TMP1.[RKEY] as RKEY , 				T_EMS_CN31_CN33_DETAIL_TMP1.[BAG_NO],T_EMS_CN31_CN33_DETAIL_TMP1.[RECPTCL_WEIGHT] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[RECPTCL_ITEMS],T_EMS_CN31_CN33_DETAIL_TMP1.[RECPTCL_FID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[ITEMS_ID]  ,T_EMS_CN31_CN33_DETAIL_TMP1.[ITEM_WEIGHT] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[OFFICE_LODGING]			 			   			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[OBSERVATION]  ,T_EMS_CN31_CN33_DETAIL_TMP1.[DEL_FLAG] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[RECORD_STATUS] 			,T_EMS_CN31_CN33_DETAIL_TMP1.[CREATE_USER_ID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[CREATE_DATE] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[UPDATE_USER_ID] 			  ,T_EMS_CN31_CN33_DETAIL_TMP1.[UPDATE_DATE] 			  			     FROM [dbo].[T_EMS_CN31_CN33_DETAIL_TMP1]   inner join [dbo].[T_EMS_CN31_CN33_MAIN] ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = T_EMS_CN31_CN33_DETAIL_TMP1.[DISPATCHING_ID]   WHERE  convert(date,T_EMS_CN31_CN33_DETAIL_TMP1.DESPTCH_DT) between '2023-01-01' and '2023-12-31'",2993,5670,-2677,673088,12131,2993
"  delete T_EMS_CN31_CN33_DETAIL      FROM [IASDB].[dbo].[T_EMS_CN31_CN33_DETAIL] D   inner join T_EMS_CN31_CN33_MAIN M on D.DISPATCHING_ID = M.DISPATCHING_ID   where  M.SERVICE_TYPE = 'O'   and convert(date,D.create_date ) >='2024-04-16'",2836,6478,-3642,3164260,28216,2836
" select  L_MAILITMS.MAILITM_PID , L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 											L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 											L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD, 											case when LME.[RECPTCL_PID]  is null then L_MAILITMS.EVT_RECPTCL_PID else LME.[RECPTCL_PID] end  as RECPTCL_PID, 											LME.CAPTURE_GMT_DT ,getdate() as CREATE_DATE   	from     (select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							 L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 							max(state_ind_cd) as state_ind_cd , 							max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 			from			[MonitasDB].[dbo].L_MAILITMS  			--where			trim(MAILITM_FID) = 'EN314572505JP' 			GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 							  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 							 L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	inner join			 [MonitasDB].[dbo].L_MAILITMS ON MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	left outer join		(	SELECT L_MAILITM_EVENTS.[MAILITM_PID],max(L_MAILITM_EVENTS.CAPTURE_GMT_DT) as CAPTURE_DT  							FROM MonitasDB.[dbo].[L_MAILITM_EVENTS] 							WHERE (L_MAILITM_EVENTS.[EVENT_TYPE_CD] ='8' or L_MAILITM_EVENTS.[EVENT_TYPE_CD] is null) 							GROUP BY L_MAILITM_EVENTS.[MAILITM_PID] 						)  	AS L_MAILITM_EVENTS on L_MAILITMS.MAILITM_PID = L_MAILITM_EVENTS.[MAILITM_PID]  	left outer join MonitasDB.[dbo].[L_MAILITM_EVENTS] as LME ON LME.MAILITM_PID = L_MAILITM_EVENTS.MAILITM_PID 	and LME.CAPTURE_GMT_DT = L_MAILITM_EVENTS.CAPTURE_DT							 	--where L_MAILITMS.MAILITM_FID = 'EN314572505JP'  	--where convert(date,LME.CAPTURE_GMT_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	where convert(date,LME.CAPTURE_GMT_DT) between '2023-04-01' and '2023-04-30' 	and L_MAILITMS.MAILITM_PID not in (select [MAILITM_PID] from L_MAILITMS_TMP  	--where year([CAPTURE_GMT_DT]) = year(LME.CAPTURE_GMT_DT) and month([CAPTURE_GMT_DT]) = month(LME.CAPTURE_GMT_DT) 	where year([CAPTURE_GMT_DT]) = '2023'  and month([CAPTURE_GMT_DT]) = '04' 	) 	",2825,19583,-16758,1272568,5,2825
select * 			from [MonitasDB].[dbo].L_MAILITMS  			where trim(MAILITM_FID) = 'EN314572505JP',2788,6584,-3796,551924,0,2788
"select			* 						from			[MonitasDB].[dbo].L_MAILITMS  					--	inner join      C_OFFICES ON  						where			trim(MAILITM_FID) = 'EE011552305GB' 						",2666,6372,-3706,554057,0,2666
"-- ============================================= -- Author:		Umarin -- Create date: 22 Jan 2024 -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE PROC_INSERT_TR_TDD_CN38  	-- Add the parameters for the stored procedure here 	 AS BEGIN 	  		INSERT INTO [dbo].TR_TDD_CN38( 			  [CONSIGNMENT_NO] 			  ,[IS_PRIORITY] 			  ,[IS_BY_AIRMAIL] 			  ,[IS_BY_TRAIN] 			  ,[IS_BY_SHIP] 			  ,[IS_BY_TRUCK] 			  ,[DATETIME_DEPARTURE]        			  ,[DEL_FLAG] 			  ,[RECORD_STATUS] 			  ,[CREATE_USER_ID] 			  ,[CREATE_DATE] 		) 		SELECT  			MIN(D1.CONSGNT_FID) AS CONSIGNMENT_ID, 			CASE MIN(D1.CONVEYANCE_TYPE_CD) WHEN 'P' THEN 1 ELSE 0 END AS IS_PRIORITY, 			CASE MIN(D1.MAIL_CATEGORY_CD) WHEN 'A' THEN 1 ELSE 0 END AS IS_BY_AIRMAIL, 			CASE MIN(D1.MAIL_CATEGORY_CD) WHEN 'B' THEN 1 ELSE 0 END AS IS_BY_TRAIN, 			CASE MIN(D1.MAIL_CATEGORY_CD) WHEN 'D' THEN 1 ELSE 0 END AS IS_BY_SHIP, 			CASE MIN(D1.MAIL_CATEGORY_CD) WHEN 'C' THEN 1 ELSE 0 END AS IS_BY_TRUCK,  			MIN(D1.EVT_GMT_DT) AS DATETIME_OF_DEPARTURE, 			'N' as DEL_FLAG, 			'A' as RECORD_STATUS, 			1 as CREATE_USER_ID, 		   getdate() as CREATE_DATE      		FROM (SELECT 			C.CONSGNT_FID,C.EVT_GMT_DT, 			C.CONSGNT_PID, 			C.CONVEYANCE_TYPE_CD, 			C.MAIL_CATEGORY_CD, 			RL.LEG_ORDER_NO, 			L.CARRIER_CD,  			L.CARRIER_NO, 			C.CONSGNT_DEPARTURE_DT, 			LO.LOCATION_CD, 			LO.LOCATION_NM, 			LO.COUNTRY_CD,  			ROW_NUMBER() OVER (PARTITION BY C.CONSGNT_FID ORDER BY RL.LEG_ORDER_NO ASC) AS SEQUENCE_ID 			FROM [MonitasDB].[dbo].[L_CONSGNTS] C  			INNER JOIN [MonitasDB].[dbo].[L_ROUTES] RO ON RO.ROUTE_PID = C.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_ROUTES_LEGS] RL ON RL.ROUTE_PID = RO.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_LEGS] L ON L.LEG_PID = RL.LEG_PID 			INNER JOIN [MonitasDB].[dbo].[C_LOCATIONS] LO ON LO.LOCATION_FCD = L.DEST_LOCATION_FCD 			INNER JOIN (select DISTINCT EVT_CONSGNT_PID,SUBSTRING(RECPTCL_FID,7,6) as DEST_OFFICE 					,SUBSTRING(RECPTCL_FID,16,1) as R_YEAR ,SUBSTRING(RECPTCL_FID,14,2) as SUB_CLASS 			from [MonitasDB].[dbo].L_RECPTCLS ) as R ON R.EVT_CONSGNT_PID = C.CONSGNT_PID 			and R.SUB_CLASS like 'U%') AS D1  		WHERE  			YEAR(D1.EVT_GMT_DT) = 2024 			AND D1.CONSGNT_FID collate thai_ci_as not in (select [CONSIGNMENT_NO] from TR_TDD_CN38) 		GROUP BY  			D1.CONSGNT_PID     		UPDATE [dbo].TR_TDD_CN38 		SET  			OFFICE_DESTINATION_OF_THE_BILL = D.LOCATION_NM,  			FLIGHT_NO = CONCAT(D.CARRIER_CD, D.CARRIER_NO), 			AIRPORT_OF_DIRECT_TRANSHIPMENT = D.LOCATION_CD, 			TRANSIT_COUNTRY_CODE = NULL  		FROM [dbo].TR_TDD_CN38 M 		INNER JOIN ( 		  SELECT 			C.CONSGNT_FID, 			L.CARRIER_CD,  			L.CARRIER_NO, 			LO.LOCATION_CD, 			LO.LOCATION_NM, 			LO.COUNTRY_CD,  			ROW_NUMBER() OVER (PARTITION BY C.CONSGNT_FID ORDER BY RL.LEG_ORDER_NO ASC) AS SEQUENCE_ID 			FROM [MonitasDB].[dbo].[L_CONSGNTS] C  			INNER JOIN [MonitasDB].[dbo].[L_ROUTES] RO ON RO.ROUTE_PID = C.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_ROUTES_LEGS] RL ON RL.ROUTE_PID = RO.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_LEGS] L ON L.LEG_PID = RL.LEG_PID 			INNER JOIN [MonitasDB].[dbo].[C_LOCATIONS] LO ON LO.LOCATION_FCD = L.DEST_LOCATION_FCD 			INNER JOIN (select DISTINCT EVT_CONSGNT_PID,SUBSTRING(RECPTCL_FID,7,6) as DEST_OFFICE 					,SUBSTRING(RECPTCL_FID,16,1) as R_YEAR ,SUBSTRING(RECPTCL_FID,14,2) as SUB_CLASS 			from [MonitasDB].[dbo].L_RECPTCLS ) as R ON R.EVT_CONSGNT_PID = C.CONSGNT_PID 			and R.SUB_CLASS like 'U%' 		) AS D ON D.CONSGNT_FID collate thai_ci_as = M.CONSIGNMENT_NO AND SEQUENCE_ID = 1    		UPDATE [dbo].TR_TDD_CN38 		SET  			FLIGHT_NO = CONCAT(D1.CARRIER_CD, D1.CARRIER_NO) + ' / ' + CONCAT(D2.CARRIER_CD, D2.CARRIER_NO), 			OFFICE_DESTINATION_OF_THE_BILL = D2.LOCATION_NM,  			AIRPORT_OFFLOADING = D2.LOCATION_CD, 			TRANSIT_COUNTRY_CODE = D1.COUNTRY_CD 		FROM [dbo].TR_TDD_CN38 M 		INNER JOIN ( 		  SELECT 			C.CONSGNT_FID, 			L.CARRIER_CD,  			L.CARRIER_NO, 			LO.LOCATION_CD, 			LO.LOCATION_NM, 			LO.COUNTRY_CD,  			ROW_NUMBER() OVER (PARTITION BY C.CONSGNT_FID ORDER BY RL.LEG_ORDER_NO ASC) AS SEQUENCE_ID 			FROM [MonitasDB].[dbo].[L_CONSGNTS] C  			INNER JOIN [MonitasDB].[dbo].[L_ROUTES] RO ON RO.ROUTE_PID = C.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_ROUTES_LEGS] RL ON RL.ROUTE_PID = RO.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_LEGS] L ON L.LEG_PID = RL.LEG_PID 			INNER JOIN [MonitasDB].[dbo].[C_LOCATIONS] LO ON LO.LOCATION_FCD = L.DEST_LOCATION_FCD 			INNER JOIN (select DISTINCT EVT_CONSGNT_PID,SUBSTRING(RECPTCL_FID,7,6) as DEST_OFFICE 					,SUBSTRING(RECPTCL_FID,16,1) as R_YEAR ,SUBSTRING(RECPTCL_FID,14,2) as SUB_CLASS 			from [MonitasDB].[dbo].L_RECPTCLS ) as R ON R.EVT_CONSGNT_PID = C.CONSGNT_PID 			and R.SUB_CLASS like 'U%' 		) AS D1 ON D1.CONSGNT_FID collate thai_ci_as = M.CONSIGNMENT_NO AND D1.SEQUENCE_ID = 1 		INNER JOIN ( 		  SELECT 			C.CONSGNT_FID, 			L.CARRIER_CD,  			L.CARRIER_NO, 			LO.LOCATION_CD, 			LO.LOCATION_NM, 			LO.COUNTRY_CD,  			ROW_NUMBER() OVER (PARTITION BY C.CONSGNT_FID ORDER BY RL.LEG_ORDER_NO ASC) AS SEQUENCE_ID 			FROM [MonitasDB].[dbo].[L_CONSGNTS] C  			INNER JOIN [MonitasDB].[dbo].[L_ROUTES] RO ON RO.ROUTE_PID = C.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_ROUTES_LEGS] RL ON RL.ROUTE_PID = RO.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_LEGS] L ON L.LEG_PID = RL.LEG_PID 			INNER JOIN [MonitasDB].[dbo].[C_LOCATIONS] LO ON LO.LOCATION_FCD = L.DEST_LOCATION_FCD 			INNER JOIN (select DISTINCT EVT_CONSGNT_PID,SUBSTRING(RECPTCL_FID,7,6) as DEST_OFFICE 					,SUBSTRING(RECPTCL_FID,16,1) as R_YEAR ,SUBSTRING(RECPTCL_FID,14,2) as SUB_CLASS 			from [MonitasDB].[dbo].L_RECPTCLS ) as R ON R.EVT_CONSGNT_PID = C.CONSGNT_PID 			and R.SUB_CLASS like 'U%' 		) AS  D2 ON D2.CONSGNT_FID collate thai_ci_as = M.CONSIGNMENT_NO AND D2.SEQUENCE_ID = 2   END ",2524,11039,-8515,303122,6259,2524
"SELECT  T_EMS_CN31_CN33_MAIN.DISPATCHING_ID, T_EMS_CN31_CN33_MAIN.CN31EMS_SEQ ,concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY, 				substring(R.RECPTCL_FID,21,3) as [BAG_NO] 			 ,TRIM(L_MAILITMS.MAILITM_FID) as MAILITM_FID, C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 			 ,L_MAILITMS.MAILITM_WEIGHT ,R.RECPTCL_WEIGHT , R.RECPTCL_MAILITMS_NO	,R.RECPTCL_FID	 			, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  			,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 		  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 		  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	  FROM					[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	  INNER JOIN            [MonitasDB].[dbo].L_RECPTCLS R  ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	  and					RECPTCL_MAILITMS_NO <> 0  and substring(R.MAIL_SUBCLASS_FCD,1,1) = 'E' 	  and				L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	   and   substring(R.RECPTCL_FID,21,3) not like 'T%' 	  and  substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) = 'THBKK'  --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FRCD%') 	  --and					convert(date,R.EVT_GMT_DT) between '2024-01-01' and '2024-02-05' 	   --and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 	   --and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  -- first day to last day for month 	  and  convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-01-01' and '2023-01-31' 	LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 	  LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 	  --INNER JOIN 	MonitasDB.[dbo].[L_MAILITMS]  ON EVT_RECPTCL_PID = R.RECPTCL_PID  	 INNER JOIN				L_MAILITMS_TMP as L_MAILITMS 	 ON						L_MAILITMS.RECPTCL_PID = R.RECPTCL_PID and L_MAILITMS.MAIL_CLASS_CD = 'E' 	  INNER JOIN				C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD  = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	  INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID = L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	 and				T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	  where				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) collate thai_ci_as 	 not in			(select RKEY   								from T_EMS_CN31_CN33_DETAIL inner join  T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_DETAIL.DISPATCHING_ID = T_EMS_CN31_CN33_MAIN.DISPATCHING_ID 								and T_EMS_CN31_CN33_MAIN.SERVICE_TYPE = 'O' 								where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between '2023-01-01' and '2023-12-31' 								--where convert(date,T_EMS_CN31_CN33_MAIN.DESPTCH_DATE) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)  								) 	 	--and T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ='THBKKCFRCDGHAEN42228' 	--and TRIM(L_MAILITMS.MAILITM_FID) = 'EE187476734TH'    	 ORDER BY T_EMS_CN31_CN33_MAIN.DISPATCHING_ID ,substring(R.RECPTCL_FID,21,3)",2477,14707,-12230,838986,0,2477
" UPDATE			TR_BGS_CN66_MAIN 	 SET			[CN66_AGENT] = DE.CN66_AGENT 	 FROM			TR_BGS_CN66_MAIN AS M  	 INNER JOIN		(SELECT				distinct C_COUNTRIES.COUNTRY_SEQ as [CN66_DISPATCHING_ADMIN] 											,format([CN38_DATE_OF_DEPART],'yyyy')+format([CN38_DATE_OF_DEPART],'MM')+REPLACE(TR_BGS_CN38A_MAIN.CN38_FLIGHTNO,'/','')+[CN38_MAIL_SUBCLASS] +[CN38_DEST_LOCATION]   AS CN66_DETAIL_PK 											,substring(TR_BGS_CN38A_MAIN.CN38_FLIGHTNO,1,2) as CN66_CREDIT_ADMIN 										   , dest_coun.COUNTRY_SEQ as [CN66_ADMIN_DESTINATION]--,day([CN38_DATE]) 											,[CN38_MAIL_SUBCLASS] 										   ,CN38_BY  as [CN66_TYPE] 										   ,[CN38_ROUTE] ,[CN38_DEST_LOCATION] as CN66_DEST_LOCATION 										  ,month([CN38_DATE_OF_DEPART]) as [CN66_MONTH] , 										  case when substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) in('U','C') then 'A' else substring(TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS,1,1) end as [CN66_BY] 										  ,substring([CN38_ROUTE],1,3) as [CN66_MAIL_FW_FROM] 										  ,year([CN38_DATE_OF_DEPART]) as [CN66_YEAR] ,'AIR' as [CN66_SERVICE_TYPE] 										  ,case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end as CN66_MAIL_CLASS 										  ,'N' as DEL_FLAG , 'A' as RECORD_STATUS ,2 as [CREATE_USER_ID] 										  ,getdate() as [CREATE_DATE]  										  ,[CN38_AIRPORT_OF_OFFLOADING] as [CN66_AIRPORT_OF_OFFLOADING] 										   ,[CN38_FLIGHTNO] ,[R_AGENT]  as CN66_AGENT , R_CURRENCY		 	   					  FROM					[dbo].[TR_BGS_CN38A_MAIN] 					 inner join				C_OFFICES on C_OFFICES.OFFICE_SEQ = [CN38_OFFICE_ORIGIN] 					 inner join				C_COUNTRIES on C_COUNTRIES.COUNTRY_CD = C_OFFICES.COUNTRY_CD 					 inner join				C_OFFICES as dest_off on dest_off.OFFICE_SEQ = [CN38_OFFICE_DESTINATIONS] 					 inner join				C_COUNTRIES as dest_coun on dest_coun.COUNTRY_CD = dest_off.COUNTRY_CD 					LEFT OUTER JOIN			(SELECT   distinct  [R_DES_CODE] ,[R_DES_FLIGHT_NO],[R_CON_CODE],[R_CON_FLIGHT_NO], 														 [R_AGENT] ,R_CURRENCY ,[R_VALID_DATE], R_INVALID_DATE,R_DAY 														,R_EMS 														,[R_AIRMAIL]  														,case when [R_AIRMAIL] is null then 'E'  															  when R_EMS is null then 'U' 															  when R_EMS is not null and [R_AIRMAIL] is not null then 'EU' else null end R_TYPE 												FROM [dbo].[TR_BGS_RATEA_MAIN] 												where  DEL_FLAG='N' and [R_AGENT] is not null ) as RATE_AIR  					ON						RATE_AIR.R_DES_CODE = (substring([CN38_DEST_LOCATION],1,2)+'-'+[CN38_AIRPORT_OF_OFFLOADING]) 					  and					case when CHARINDEX('/',[CN38_FLIGHTNO])=0 then [CN38_FLIGHTNO] else substring([CN38_FLIGHTNO],1, CHARINDEX('/',[CN38_FLIGHTNO])-1) end = [R_DES_FLIGHT_NO]  					  and					case when CHARINDEX('/',[CN38_FLIGHTNO])=0 then '-' else substring([CN38_FLIGHTNO],CHARINDEX('/',[CN38_FLIGHTNO])+1,6) end = ISNULL([R_CON_FLIGHT_NO],'-')  					  and					convert(date,CN38_DATE_OF_DEPART) between convert(date,R_VALID_DATE) and convert(date,R_INVALID_DATE)  					  and					(case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = R_TYPE  												OR case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = substring(R_TYPE,1,1) 												OR case when TR_BGS_CN38A_MAIN.CN38_MAIL_CATEGORY ='A' then 'U' else 'E' end = substring(R_TYPE,2,1)) 					  and					case when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Monday' then '1' 													when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Tuesday' then '2' 													when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Wednesday' then '3' 													when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Thursday' then '4' 													when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Friday' then '5' 													when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Saturday' then '6' 													when DATENAME(DW,[CN38_DATE_OF_DEPART]) ='Sunday' then '7' 													else '0' 													end = RATE_AIR.R_DAY   					  WHERE						TR_BGS_CN38A_MAIN.DEL_FLAG='N' 					   					  and TR_BGS_CN38A_MAIN.CN38_MAIL_SUBCLASS not like '%T' 					  and year([CN38_DATE_OF_DEPART]) = '2024'   and month([CN38_DATE_OF_DEPART]) in('01','02','03','04') 					  and  TR_BGS_CN38A_MAIN.[CN38_MAIL_CATEGORY] in('A','E') 					  and TR_BGS_CN38A_MAIN.CN38_FLIGHTNO is not null) AS DE 		ON			DE.CN66_DETAIL_PK = M.CN66_MAIN_PK",2184,2182,2,3599,31,2184
SELECT COUNT(DISTINCT MAILITM_PID) AS ct FROM [MonitasDB].[dbo].N_EDI_MAILITMS,2125,7020,-4895,281366,0,4251
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL_TMP1] 					([DISPATCHING_ID],DESPTCH_DT,RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]  	)				  	select		 L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY 						,substring(R.RECPTCL_FID,21,3)   as [BAG_NO] 						, R.RECPTCL_WEIGHT  as RECPTCL_WEIGHT	 						, R.RECPTCL_MAILITMS_NO  as RECPTCL_MAILITMS_NO	 						, R.RECPTCL_FID  as RECPTCL_FID 						,trim(L_MAILITMS.MAILITM_FID) as MAILITM_FID 						,L_MAILITMS.MAILITM_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 										max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 						from			[MonitasDB].[dbo].L_MAILITMS  						--where			trim(MAILITM_FID) = 'EN314572505JP' 						GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-06-01' and '2023-06-30' 			--and			trim(L_MAILITMS.MAILITM_FID) = 'EN314572505JP'			 			order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)",2116,5504,-3388,979234,1022,2116
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL_TMP1] 					([DISPATCHING_ID],RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]  	)				  	select		 L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID , 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY 						,substring(R.RECPTCL_FID,21,3)   as [BAG_NO] 						, R.RECPTCL_WEIGHT  as RECPTCL_WEIGHT	 						, R.RECPTCL_MAILITMS_NO  as RECPTCL_MAILITMS_NO	 						, R.RECPTCL_FID  as RECPTCL_FID 						,trim(L_MAILITMS.MAILITM_FID) as MAILITM_FID 						,L_MAILITMS.MAILITM_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 										max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 						from			[MonitasDB].[dbo].L_MAILITMS  						--where			trim(MAILITM_FID) = 'EN314572505JP' 						GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										L_MAILITMS.CURRENCY_CD , L_MAILITMS.DEST_COUNTRY_CD, L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 			--and			trim(L_MAILITMS.MAILITM_FID) = 'EN314572505JP'			 			order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)",2048,8320,-6272,2414044,2470,2048
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL_TMP1] 					([DISPATCHING_ID],DESPTCH_DT,RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]  	)				  	select		 L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY 						,substring(R.RECPTCL_FID,21,3)   as [BAG_NO] 						, R.RECPTCL_WEIGHT  as RECPTCL_WEIGHT	 						, R.RECPTCL_MAILITMS_NO  as RECPTCL_MAILITMS_NO	 						, R.RECPTCL_FID  as RECPTCL_FID 						,trim(L_MAILITMS.MAILITM_FID) as MAILITM_FID 						,L_MAILITMS.MAILITM_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 										max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 						from			[MonitasDB].[dbo].L_MAILITMS  						--where			trim(MAILITM_FID) = 'EN314572505JP' 						GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD  	INNER JOIN			C_OFFICES as OFFICES_DEST ON OFFICES_DEST.COUNTRY_CD = L_MAILITMS.DEST_COUNTRY_CD collate THAI_CI_AS	 	and					L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD  collate THAI_CI_AS = OFFICES_DEST.OFFICE_FCD 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-05-01' and '2023-05-31' 			--and			trim(L_MAILITMS.MAILITM_FID) = 'EN314572505JP'			 			order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)",2009,4683,-2674,924495,587,2009
"       -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_TR_EMS_CN38_EMS_CLOSE_TRANSIT]  	-- Add the parameters for the stored procedure here 	/*@PYEAR varchar(4),  	@PMONTH int , 	@POFFICE_ORIGIN varchar(6), 	@DEST_OFFICE varchar(6)*/ AS  BEGIN 	 	INSERT INTO [dbo].[TR_EMS_CN38_ECT]            ([OPERATOR_OF_ORIGIN] ,OPERATOR_OF_DESTINATION ,OFFICE_OF_ORIGIN_BILL ,[OFFICE_OF_DESTINATION] 			  ,COUNTRY_ORIGIN ,COUNTRY_TRANSIT,COUNTRY_DESTINATION ,[CN38_DATE] ,[CONSIGNMENT_ID] ,[FLIGHTNO] 			  ,[TYPEOFMAIL] ,[DATE_OF_DEPART],[TIME_OF_DEPART] 			  ,[AIRPORT_OF_DIRECT_TRANSHIPMENT] ,[AIRPORT_OF_OFFLOADING] 			   ,[MAIL_CAT] --,[MAIL_SUBCLASSES] 			  --,[DESP_SERIAL_NO]  			  ,[SERVICE_TYPE] 			  ,[DEL_FLAG] ,[RECORD_STATUS] 			  ,[CREATE_USER_ID] ,[CREATE_DATE] 			   ,[UPDATE_USER_ID] ,[UPDATE_DATE] 			  )    	SELECT				A.CN38_POSTAL_DESIGNATED_OPER_ORIGIN, A.OPERATOR_DEST ,A.OFFICE_OF_ORIGIN_BILL ,A.CN38_OFFICE_DESTINATIONS 						, A.COUNTRY_CD ,A.TRAN_COUNTRY  , A.DEST_COUNTRY 						,A.[DESPTCH_DEPARTURE_DT], A.CONSGNT_FID  						,case when B.FLIGHTS_DEST is null then A.FLIGHTS else concat(A.FLIGHTS,'/',B.FLIGHTS_DEST) end as FLIGHT 						, A.CN38_TYPEOFMAIL ,A.CN38_DATE_OF_DEPART ,A.CN38_TIME_OF_DEPART 						,CASE WHEN B.AIRPORT_OF_DIRECT_TRANSHIPMENT IS NULL THEN A.AIRPORT_OF_DIRECT_TRANSHIPMENT ELSE B.AIRPORT_OF_DIRECT_TRANSHIPMENT END AS AIRPORT_OF_DIRECT_TRANSHIPMENT 						,CASE WHEN B.AIRPORT_OF_OFFLOADING IS NULL THEN A.AIRPORT_OF_OFFLOADING ELSE B.AIRPORT_OF_OFFLOADING END AS AIRPORT_OF_OFFLOADING 						,A.MAIL_CATEGORY_CD --,A.CN38_MAIL_SUBCLASS  						,'1' as SERVICE_TYPE 						,'N' as  [DEL_FLAG] 						,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] 						,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] 						,getdate() as [UPDATE_DATE] 					 					 	FROM 					(select				TRAN_OFF.OPERATOR_CD as CN38_POSTAL_DESIGNATED_OPER_ORIGIN ,DES_OFF.OPERATOR_CD as OPERATOR_DEST 											,TRAN_OFF.OFFICE_FCD as OFFICE_OF_ORIGIN_BILL ,DES_OFF.OFFICE_FCD as CN38_OFFICE_DESTINATIONS 											,C_OFFICES.COUNTRY_CD ,TRAN_OFF.COUNTRY_CD as TRAN_COUNTRY ,DES_OFF.COUNTRY_CD as DEST_COUNTRY  												,L_CONSGNTS.CONSGNT_DEPARTURE_DT as [DESPTCH_DEPARTURE_DT]  												---------L_CONSGNTS--- 												,L_CONSGNTS.CONSGNT_FID as CONSGNT_FID  												,CONCAT(L_LEGS.CARRIER_CD,L_LEGS.CARRIER_NO) AS FLIGHTS 												,CASE WHEN L_CONSGNTS.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end as CN38_TYPEOFMAIL 												,L_CONSGNTS.CONSGNT_DEPARTURE_DT as CN38_DATE_OF_DEPART 												,L_CONSGNTS.CONSGNT_DEPARTURE_DT as CN38_TIME_OF_DEPART 												,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) as AIRPORT_OF_DIRECT_TRANSHIPMENT 												,substring(L_LEGS.DEST_LOCATION_FCD,3,3) as AIRPORT_OF_OFFLOADING 												,SUBSTRING(R.RECPTCL_FID,13,1) as MAIL_CATEGORY_CD  																																	 												,DEST_LOCATION.LOCATION_FCD 												,sum(R.RECPTCL_WEIGHT) as RECPTCL_WEIGHT  						from				[MonitasDB].[dbo].L_RECPTCLS R								 						--inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 						LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 						LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 						INNER JOIN			[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = substring(R.RECPTCL_FID,7,6) 						INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = substring(R.RECPTCL_FID,1,6) collate THAI_CI_AS  						INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = substring(R.RECPTCL_FID,7,6) collate THAI_CI_AS 		 						INNER JOIN          C_OFFICES as TRAN_OFF on TRAN_OFF.OFFICE_FCD ='THBKKC'					 						LEFT OUTER join		[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 						left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID					 						--INNER JOIN			C_COUNTRIES_ADECUVERT ON concat(C_OFFICES.COUNTRY_CD,DES_OFF.COUNTRY_CD)  <> concat(C_COUNTRIES_ADECUVERT.COUNTRIES_CD_ORIGIN , C_COUNTRIES_ADECUVERT.COUNTRIES_CD_DESTINATION) 					   -- and					year(L_CONSGNTS.CONSGNT_DEPARTURE_DT)  = C_COUNTRIES_ADECUVERT.ADECUVERT_YEAR 					 						WHERE				substring(RECPTCL_FID,13,1) = 'A' and substring(RECPTCL_FID,14,2) in('ED','EN','EM') 						--and					L_CONSGNTS.ORIG_OFFICE_FCD = 'THBKKC'  						and					substring(RECPTCL_FID,1,6) not like 'THBKK%' and substring(RECPTCL_FID,7,6) not like 'THBKK%' 						and					substring(R.RECPTCL_FID,14,2) not like ('%T')  and substring(R.RECPTCL_FID,21,3) not like ('T%') 						and					L_ROUTES_LEGS.LEG_ORDER_NO = 0  						and					year(L_CONSGNTS.CONSGNT_DEPARTURE_DT) = year(getdate()) 						and substring(RECPTCL_FID,16,1) = substring(convert(varchar(4),year(L_CONSGNTS.CONSGNT_DEPARTURE_DT)),4,1) 						--and					month(L_CONSGNTS.CONSGNT_DEPARTURE_DT) between '01' and '11' 						--and					R.EVT_TYPE_CD = '178' 						--and					substring(RECPTCL_FID,1,6) = 'MYKULA'   and substring(RECPTCL_FID,7,6) = 'LAVTEA' 						--and L_CONSGNTS.CONSGNT_FID ='THBKKC300151' 						--and					substring(R.RECPTCL_FID,17,4) in('2008' ) 			GROUP BY							TRAN_OFF.OPERATOR_CD  ,DES_OFF.OPERATOR_CD  												,TRAN_OFF.OFFICE_FCD  ,DES_OFF.OFFICE_FCD ,L_LEGS.CARRIER_CD,L_LEGS.CARRIER_NO 												,C_OFFICES.COUNTRY_CD ,TRAN_OFF.COUNTRY_CD  ,DES_OFF.COUNTRY_CD  												,L_CONSGNTS.CONSGNT_FID  												,CASE WHEN L_CONSGNTS.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end  												,L_CONSGNTS.CONSGNT_DEPARTURE_DT 												,substring(L_LEGS.ORIG_LOCATION_FCD,3,3)  												,substring(L_LEGS.DEST_LOCATION_FCD,3,3)  												,substring(R.RECPTCL_FID,13,1)																																	 												,DEST_LOCATION.LOCATION_FCD 					  ) AS A  	LEFT OUTER JOIN 				( select				TRAN_OFF.OPERATOR_CD as CN38_POSTAL_DESIGNATED_OPER_ORIGIN ,DES_OFF.OPERATOR_CD as OPERATOR_DEST 											,TRAN_OFF.OFFICE_FCD as OFFICE_OF_ORIGIN_BILL ,DES_OFF.OFFICE_FCD as CN38_OFFICE_DESTINATIONS 											,C_OFFICES.COUNTRY_CD ,TRAN_OFF.COUNTRY_CD as TRAN_COUNTRY ,DES_OFF.COUNTRY_CD as DEST_COUNTRY  												,L_CONSGNTS.CONSGNT_DEPARTURE_DT as [DESPTCH_DEPARTURE_DT]  												---------L_CONSGNTS--- 												,L_CONSGNTS.CONSGNT_FID as CONSGNT_FID  												,CONCAT(L_LEGS.CARRIER_CD,L_LEGS.CARRIER_NO) AS FLIGHTS_DEST 												,CASE WHEN L_CONSGNTS.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end as CN38_TYPEOFMAIL 												,L_CONSGNTS.CONSGNT_DEPARTURE_DT as CN38_DATE_OF_DEPART 												,L_CONSGNTS.CONSGNT_DEPARTURE_DT as CN38_TIME_OF_DEPART 												,substring(L_LEGS.ORIG_LOCATION_FCD,3,3) as AIRPORT_OF_DIRECT_TRANSHIPMENT 												,substring(L_LEGS.DEST_LOCATION_FCD,3,3) as AIRPORT_OF_OFFLOADING 												,SUBSTRING(R.RECPTCL_FID,13,1) as MAIL_CATEGORY_CD  																																	 												,DEST_LOCATION.LOCATION_FCD 												,sum(R.RECPTCL_WEIGHT) as RECPTCL_WEIGHT  						from				[MonitasDB].[dbo].L_RECPTCLS R								 						--inner join			[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 						LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(R.RECPTCL_FID,1,5) collate THAI_CI_AS 						LEFT OUTER JOIN		[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(R.RECPTCL_FID,7,5) collate THAI_CI_AS 						LEFT OUTER JOIN		[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID and L_CONSGNTS.DEST_OFFICE_FCD = substring(R.RECPTCL_FID,7,6) 						INNER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = substring(R.RECPTCL_FID,1,6) collate THAI_CI_AS  						INNER JOIN			[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = substring(R.RECPTCL_FID,7,6) collate THAI_CI_AS 		 						INNER JOIN          C_OFFICES as TRAN_OFF on TRAN_OFF.OFFICE_FCD ='THBKKC'					 						LEFT OUTER join		[MonitasDB].[dbo].L_ROUTES_LEGS ON L_ROUTES_LEGS.ROUTE_PID = L_CONSGNTS.ROUTE_PID 						left outer join		[MonitasDB].[dbo].L_LEGS  on L_LEGS.LEG_PID = L_ROUTES_LEGS.LEG_PID					 						--INNER JOIN			C_COUNTRIES_ADECUVERT ON concat(C_OFFICES.COUNTRY_CD,DES_OFF.COUNTRY_CD)  <> concat(C_COUNTRIES_ADECUVERT.COUNTRIES_CD_ORIGIN , C_COUNTRIES_ADECUVERT.COUNTRIES_CD_DESTINATION) 					  --  and					year(L_CONSGNTS.CONSGNT_DEPARTURE_DT)  = C_COUNTRIES_ADECUVERT.ADECUVERT_YEAR 					 						WHERE				substring(RECPTCL_FID,13,1) = 'A' and substring(RECPTCL_FID,14,2) in('ED','EN','EM') 						--and					L_CONSGNTS.ORIG_OFFICE_FCD = 'THBKKC'  						and					substring(RECPTCL_FID,1,6) not like 'THBKK%' and substring(RECPTCL_FID,7,6) not like 'THBKK%' 						and					substring(R.RECPTCL_FID,14,2) not like ('%T')  and substring(R.RECPTCL_FID,21,3) not like ('T%') 						and					L_ROUTES_LEGS.LEG_ORDER_NO = 1  						and					year(L_CONSGNTS.CONSGNT_DEPARTURE_DT) = year(getdate())  						and substring(RECPTCL_FID,16,1) = substring(convert(varchar(4),year(L_CONSGNTS.CONSGNT_DEPARTURE_DT)),4,1) 						--and					month(L_CONSGNTS.CONSGNT_DEPARTURE_DT) between '01' and '11' 						--and					R.EVT_TYPE_CD = '178' 						--and					substring(RECPTCL_FID,1,6) = 'MYKULA'   and substring(RECPTCL_FID,7,6) = 'LAVTEA' 						--and L_CONSGNTS.CONSGNT_FID ='THBKKC300151' 						--and					substring(R.RECPTCL_FID,17,4) in('2008' ) 			GROUP BY							TRAN_OFF.OPERATOR_CD  ,DES_OFF.OPERATOR_CD  												,TRAN_OFF.OFFICE_FCD  ,DES_OFF.OFFICE_FCD ,L_LEGS.CARRIER_CD,L_LEGS.CARRIER_NO 												,C_OFFICES.COUNTRY_CD ,TRAN_OFF.COUNTRY_CD  ,DES_OFF.COUNTRY_CD  												,L_CONSGNTS.CONSGNT_FID  												,CASE WHEN L_CONSGNTS.[CONVEYANCE_TYPE_CD] = 'P' then '1' else '2' end  												,L_CONSGNTS.CONSGNT_DEPARTURE_DT 												,substring(L_LEGS.ORIG_LOCATION_FCD,3,3)  												,substring(L_LEGS.DEST_LOCATION_FCD,3,3)  												,substring(R.RECPTCL_FID,13,1)																																	 												,DEST_LOCATION.LOCATION_FCD 			 				) AS B 	ON					A.DESPTCH_DEPARTURE_DT = B.DESPTCH_DEPARTURE_DT  AND A.CONSGNT_FID = B.CONSGNT_FID 	AND					A.MAIL_CATEGORY_CD = B.MAIL_CATEGORY_CD 	AND					A.LOCATION_FCD = B.LOCATION_FCD AND  A.TRAN_COUNTRY = B.TRAN_COUNTRY 	and					A.COUNTRY_CD = B.COUNTRY_CD AND A.DEST_COUNTRY = B.DEST_COUNTRY 	AND					A.CN38_OFFICE_DESTINATIONS = B.CN38_OFFICE_DESTINATIONS 	AND					A.OFFICE_OF_ORIGIN_BILL = B.OFFICE_OF_ORIGIN_BILL  	WHERE				convert(date,A.[DESPTCH_DEPARTURE_DT]) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 	and			        A.CONSGNT_FID collate thai_ci_as not in(select CONSIGNMENT_ID from TR_EMS_CN38_ECT where DEL_FLAG ='N') 	--and                 month(A.[DESPTCH_DEPARTURE_DT]) between '01' and '11' --and A.CONSGNT_FID = 'THBKKC300151'   ORDER BY			A.COUNTRY_CD ,A.DEST_COUNTRY  					,A.[DESPTCH_DEPARTURE_DT] ,A.CONSGNT_FID   END ",1987,1716,271,142445,3,1987
"SELECT * FROM (SELECT CN31EMS_SEQ,DISPATCHING_OPERATOR_SEQ,DIPS_OPER_NAME,DESTINATION_OPERATOR_SEQ,DEST_OPER_NAME,ORIGIN_OFFICE_SEQ,DESTINATION_OFFICE_SEQ,MAIL_CATEGORY_SEQ,MAIL_CATEGORY_CD,MAIL_SUBCLASS_SEQ,MAIL_SUBCLASS_FCD,DISPATCH_NO,DESPTCH_DATE,DESPTCH_DATE_NAME,TRANSIT_OPERATOR,FLIGHT_TRIP_NUMBERS,CN31EMS_YEAR,CN31EMS_QUARTER,CN31EMS_MONTH,MAIL_NO,SERVICE_TYPE,SERVICE_TYPE_NAME,ZONE,ZONE_NAME_EN,COUNTRY_SEQ,COUNTRY_NM,OBSERVATION,DEL_FLAG,RECORD_STATUS,CREATE_USER_ID,CREATE_DATE,UPDATE_DATE,UPDATE_USER_ID,CREATE_DATE_NAME,UPDATE_DATE_NAME FROM VIEW_LIST_EMS_CN33) AS s WHERE DEL_FLAG = 'N' AND (CN31EMS_YEAR like '2023%' AND SERVICE_TYPE_NAME like 'รายได้%')  ORDER BY CREATE_DATE DESC OFFSET 0 ROWS FETCH FIRST 10 ROWS ONLY; ",1926,1926,0,19656,17,21191
"select		 L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID ,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT, 				concat(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(L_MAILITMS.MAILITM_FID)) as RKEY 						,substring(R.RECPTCL_FID,21,3)   as [BAG_NO] 						, R.RECPTCL_WEIGHT  as RECPTCL_WEIGHT	 						, R.RECPTCL_MAILITMS_NO  as RECPTCL_MAILITMS_NO	 						, R.RECPTCL_FID  as RECPTCL_FID 						,trim(L_MAILITMS.MAILITM_FID) as MAILITM_FID 						,L_MAILITMS.MAILITM_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						, C_POSTAL_STATUSES.POSTAL_STATUS_NM as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	 	INNER JOIN			[MonitasDB].[dbo].L_RECPTCLS as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	and					substring(R.RECPTCL_FID,21,3) not like 'T%' 	and					R.RECPTCL_MAILITMS_NO  is not null  	inner join			 [MonitasDB].[dbo].L_MAILITMS ON  L_MAILITMS.EVT_RECPTCL_PID = R.RECPTCL_PID and trim(L_MAILITMS.MAILITM_FID) is not null 	INNER JOIN			(select			L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD,											 										max(L_MAILITMS.EVT_GMT_DT) as EVT_GMT_DT 						from			[MonitasDB].[dbo].L_MAILITMS  						--where			trim(MAILITM_FID) = 'EN314572505JP' 						GROUP BY		L_MAILITMS.MAILITM_FID ,L_MAILITMS.MAIL_CLASS_CD , 										  L_MAILITMS.DUTIABLE_IND , L_MAILITMS.DUTIES_AMOUNT, 										L_MAILITMS.MAILITM_WEIGHT , L_MAILITMS.ORIG_COUNTRY_CD , L_MAILITMS.OPERATOR_CD , L_MAILITMS.POSTAL_STATUS_CD ) AS MAILITMS 	ON					MAILITMS.MAILITM_FID = L_MAILITMS.MAILITM_FID and L_MAILITMS.EVT_GMT_DT = MAILITMS.EVT_GMT_DT 	INNER JOIN			C_OFFICES on C_OFFICES.COUNTRY_CD = MAILITMS.ORIG_COUNTRY_CD collate THAI_CI_AS   	and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN		C_POSTAL_STATUSES on L_MAILITMS.POSTAL_STATUS_CD = C_POSTAL_STATUSES.POSTAL_STATUS_CD 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and   convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-03-01' and '2024-03-26' 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2024' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 			and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2023-02-01' and '2023-02-28' 			--and			trim(L_MAILITMS.MAILITM_FID) = 'EN314572505JP'			 			order by R.RECPTCL_FID ,trim(L_MAILITMS.MAILITM_FID)",1802,4854,-3052,1007651,23,1802
"-- ============================================= -- Author:		Umarin -- Create date: 22 Jan 2024 -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE PROC_INSERT_TR_TDD_CN38  	-- Add the parameters for the stored procedure here 	 AS BEGIN 	  		INSERT INTO [dbo].TR_TDD_CN38( 			  [CONSIGNMENT_NO] 			  ,[IS_PRIORITY] 			  ,[IS_BY_AIRMAIL] 			  ,[IS_BY_TRAIN] 			  ,[IS_BY_SHIP] 			  ,[IS_BY_TRUCK] 			  ,[DATETIME_DEPARTURE]        			  ,[DEL_FLAG] 			  ,[RECORD_STATUS] 			  ,[CREATE_USER_ID] 			  ,[CREATE_DATE] 		) 		SELECT  			MIN(D1.CONSGNT_FID) AS CONSIGNMENT_ID, 			CASE MIN(D1.CONVEYANCE_TYPE_CD) WHEN 'P' THEN 1 ELSE 0 END AS IS_PRIORITY, 			CASE MIN(D1.MAIL_CATEGORY_CD) WHEN 'A' THEN 1 ELSE 0 END AS IS_BY_AIRMAIL, 			CASE MIN(D1.MAIL_CATEGORY_CD) WHEN 'B' THEN 1 ELSE 0 END AS IS_BY_TRAIN, 			CASE MIN(D1.MAIL_CATEGORY_CD) WHEN 'D' THEN 1 ELSE 0 END AS IS_BY_SHIP, 			CASE MIN(D1.MAIL_CATEGORY_CD) WHEN 'C' THEN 1 ELSE 0 END AS IS_BY_TRUCK,  			MIN(D1.EVT_GMT_DT) AS DATETIME_OF_DEPARTURE, 			'N' as DEL_FLAG, 			'A' as RECORD_STATUS, 			1 as CREATE_USER_ID, 		   getdate() as CREATE_DATE      		FROM (SELECT 			C.CONSGNT_FID,C.EVT_GMT_DT, 			C.CONSGNT_PID, 			C.CONVEYANCE_TYPE_CD, 			C.MAIL_CATEGORY_CD, 			RL.LEG_ORDER_NO, 			L.CARRIER_CD,  			L.CARRIER_NO, 			C.CONSGNT_DEPARTURE_DT, 			LO.LOCATION_CD, 			LO.LOCATION_NM, 			LO.COUNTRY_CD,  			ROW_NUMBER() OVER (PARTITION BY C.CONSGNT_FID ORDER BY RL.LEG_ORDER_NO ASC) AS SEQUENCE_ID 			FROM [MonitasDB].[dbo].[L_CONSGNTS] C  			INNER JOIN [MonitasDB].[dbo].[L_ROUTES] RO ON RO.ROUTE_PID = C.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_ROUTES_LEGS] RL ON RL.ROUTE_PID = RO.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_LEGS] L ON L.LEG_PID = RL.LEG_PID 			INNER JOIN [MonitasDB].[dbo].[C_LOCATIONS] LO ON LO.LOCATION_FCD = L.DEST_LOCATION_FCD 			INNER JOIN (select DISTINCT EVT_CONSGNT_PID,SUBSTRING(RECPTCL_FID,7,6) as DEST_OFFICE 					,SUBSTRING(RECPTCL_FID,16,1) as R_YEAR ,SUBSTRING(RECPTCL_FID,14,2) as SUB_CLASS 			from [MonitasDB].[dbo].L_RECPTCLS ) as R ON R.EVT_CONSGNT_PID = C.CONSGNT_PID 			and R.SUB_CLASS like 'U%') AS D1  		WHERE  			YEAR(D1.EVT_GMT_DT) = 2024 			AND D1.CONSGNT_FID collate thai_ci_as not in (select [CONSIGNMENT_NO] from TR_TDD_CN38) 		GROUP BY  			D1.CONSGNT_PID     		UPDATE [dbo].TR_TDD_CN38 		SET  			OFFICE_DESTINATION_OF_THE_BILL = D.LOCATION_NM,  			FLIGHT_NO = CONCAT(D.CARRIER_CD, D.CARRIER_NO), 			AIRPORT_OF_DIRECT_TRANSHIPMENT = D.LOCATION_CD, 			TRANSIT_COUNTRY_CODE = NULL  		FROM [dbo].TR_TDD_CN38 M 		INNER JOIN ( 		  SELECT 			C.CONSGNT_FID, 			L.CARRIER_CD,  			L.CARRIER_NO, 			LO.LOCATION_CD, 			LO.LOCATION_NM, 			LO.COUNTRY_CD,  			ROW_NUMBER() OVER (PARTITION BY C.CONSGNT_FID ORDER BY RL.LEG_ORDER_NO ASC) AS SEQUENCE_ID 			FROM [MonitasDB].[dbo].[L_CONSGNTS] C  			INNER JOIN [MonitasDB].[dbo].[L_ROUTES] RO ON RO.ROUTE_PID = C.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_ROUTES_LEGS] RL ON RL.ROUTE_PID = RO.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_LEGS] L ON L.LEG_PID = RL.LEG_PID 			INNER JOIN [MonitasDB].[dbo].[C_LOCATIONS] LO ON LO.LOCATION_FCD = L.DEST_LOCATION_FCD 			INNER JOIN (select DISTINCT EVT_CONSGNT_PID,SUBSTRING(RECPTCL_FID,7,6) as DEST_OFFICE 					,SUBSTRING(RECPTCL_FID,16,1) as R_YEAR ,SUBSTRING(RECPTCL_FID,14,2) as SUB_CLASS 			from [MonitasDB].[dbo].L_RECPTCLS ) as R ON R.EVT_CONSGNT_PID = C.CONSGNT_PID 			and R.SUB_CLASS like 'U%' 		) AS D ON D.CONSGNT_FID collate thai_ci_as = M.CONSIGNMENT_NO AND SEQUENCE_ID = 1    		UPDATE [dbo].TR_TDD_CN38 		SET  			FLIGHT_NO = CONCAT(D1.CARRIER_CD, D1.CARRIER_NO) + ' / ' + CONCAT(D2.CARRIER_CD, D2.CARRIER_NO), 			OFFICE_DESTINATION_OF_THE_BILL = D2.LOCATION_NM,  			AIRPORT_OFFLOADING = D2.LOCATION_CD, 			TRANSIT_COUNTRY_CODE = D1.COUNTRY_CD 		FROM [dbo].TR_TDD_CN38 M 		INNER JOIN ( 		  SELECT 			C.CONSGNT_FID, 			L.CARRIER_CD,  			L.CARRIER_NO, 			LO.LOCATION_CD, 			LO.LOCATION_NM, 			LO.COUNTRY_CD,  			ROW_NUMBER() OVER (PARTITION BY C.CONSGNT_FID ORDER BY RL.LEG_ORDER_NO ASC) AS SEQUENCE_ID 			FROM [MonitasDB].[dbo].[L_CONSGNTS] C  			INNER JOIN [MonitasDB].[dbo].[L_ROUTES] RO ON RO.ROUTE_PID = C.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_ROUTES_LEGS] RL ON RL.ROUTE_PID = RO.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_LEGS] L ON L.LEG_PID = RL.LEG_PID 			INNER JOIN [MonitasDB].[dbo].[C_LOCATIONS] LO ON LO.LOCATION_FCD = L.DEST_LOCATION_FCD 			INNER JOIN (select DISTINCT EVT_CONSGNT_PID,SUBSTRING(RECPTCL_FID,7,6) as DEST_OFFICE 					,SUBSTRING(RECPTCL_FID,16,1) as R_YEAR ,SUBSTRING(RECPTCL_FID,14,2) as SUB_CLASS 			from [MonitasDB].[dbo].L_RECPTCLS ) as R ON R.EVT_CONSGNT_PID = C.CONSGNT_PID 			and R.SUB_CLASS like 'U%' 		) AS D1 ON D1.CONSGNT_FID collate thai_ci_as = M.CONSIGNMENT_NO AND D1.SEQUENCE_ID = 1 		INNER JOIN ( 		  SELECT 			C.CONSGNT_FID, 			L.CARRIER_CD,  			L.CARRIER_NO, 			LO.LOCATION_CD, 			LO.LOCATION_NM, 			LO.COUNTRY_CD,  			ROW_NUMBER() OVER (PARTITION BY C.CONSGNT_FID ORDER BY RL.LEG_ORDER_NO ASC) AS SEQUENCE_ID 			FROM [MonitasDB].[dbo].[L_CONSGNTS] C  			INNER JOIN [MonitasDB].[dbo].[L_ROUTES] RO ON RO.ROUTE_PID = C.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_ROUTES_LEGS] RL ON RL.ROUTE_PID = RO.ROUTE_PID 			INNER JOIN [MonitasDB].[dbo].[L_LEGS] L ON L.LEG_PID = RL.LEG_PID 			INNER JOIN [MonitasDB].[dbo].[C_LOCATIONS] LO ON LO.LOCATION_FCD = L.DEST_LOCATION_FCD 			INNER JOIN (select DISTINCT EVT_CONSGNT_PID,SUBSTRING(RECPTCL_FID,7,6) as DEST_OFFICE 					,SUBSTRING(RECPTCL_FID,16,1) as R_YEAR ,SUBSTRING(RECPTCL_FID,14,2) as SUB_CLASS 			from [MonitasDB].[dbo].L_RECPTCLS ) as R ON R.EVT_CONSGNT_PID = C.CONSGNT_PID 			and R.SUB_CLASS like 'U%' 		) AS  D2 ON D2.CONSGNT_FID collate thai_ci_as = M.CONSIGNMENT_NO AND D2.SEQUENCE_ID = 2   END ",1791,5430,-3639,362345,6904,1791
"(@1 varchar(8000),@2 varchar(8000))DELETE [IASDB].[dbo].[T_EMS_CN31_CN33_DETAIL]  WHERE CONVERT([date],[CREATE_DATE])>=@1 AND CONVERT([date],[CREATE_DATE])<=@2",1788,2129,-341,949425,18065,1788
"INSERT INTO [dbo].[T_EMS_CN31_CN33_DETAIL_TMP2] 					([DISPATCHING_ID],RKEY 					, [BAG_NO],RECPTCL_WEIGHT,RECPTCL_ITEMS,RECPTCL_FID 					, [ITEMS_ID] ,[ITEM_WEIGHT],[OFFICE_LODGING] 				 					,[OBSERVATION] ,[DEL_FLAG] ,[RECORD_STATUS] 					,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,[UPDATE_DATE]) 	select		T_EMS_CN31_CN33_MAIN.DISPATCHING_ID as DISPATCHING_ID , 				concat( L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,TRIM(EM.MAILITM_FID)) as RKEY 						, substring(RE_EDI.RECPTCL_FID,21,3)  as [BAG_NO] 						--,case when R.RECPTCL_WEIGHT is null then RE_EDI.RECPTCL_WEIGHT else R.RECPTCL_WEIGHT end   as RECPTCL_WEIGHT	 						,RE_EDI.RECPTCL_WEIGHT 						,RE_EDI.RECPTCL_MAILITMS_NO   as RECPTCL_MAILITMS_NO	 						,RE_EDI.RECPTCL_FID   as RECPTCL_FID 						,TRIM(EM.MAILITM_FID)  as MAILITM_FID 						,EM.MAIL_WEIGHT  as MAILITM_WEIGHT 						,C_LOCATIONS.LOCATION_NM as OFFICE_LODGING 						,case when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,2) then 'Normal'  						      when substring(EM.MAILITM_FID,12,2) = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,2) then 'Being returned' 						  else 'Transit' end as Observation  						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA  	INNER JOIN		[MonitasDB].[dbo].N_EDI_RECPTCLS as RE_EDI ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(RE_EDI.RECPTCL_FID,1,20) 	and					substring(RE_EDI.RECPTCL_FID,21,3) not like 'T%' 	and  RE_EDI.RECPTCL_MAILITMS_NO  is not null  	INNER JOIN		[MonitasDB].[dbo].N_EDI_MAILITMS as EM ON RE_EDI.RECPTCL_PID = EM.RECPTCL_PID and trim(EM.MAILITM_FID) is not null 	INNER JOIN			[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD,1,5) collate THAI_CI_AS 	INNER JOIN			T_EMS_CN31_CN33_MAIN ON T_EMS_CN31_CN33_MAIN.DISPATCHING_ID= L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	AND					T_EMS_CN31_CN33_MAIN.CN31EMS_MONTH_ID = MONTH(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'BEBR%' 			and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') and L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A' 		 			--and  YEAR(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)='2023' and month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in(1,2) 			--and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)-1 as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)   -- first day to last day for month 		 and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) between '2024-01-01' and '2024-03-31' 			 			--and   RE_EDI.RECPTCL_FID like '%40025%' 			order by RECPTCL_FID ,TRIM(EM.MAILITM_FID)",1703,7454,-5751,1214985,2490,1703
"   -- ============================================= -- Author:		<Author,,Name> -- Create date: <Create Date,,> -- Description:	<Description,,> -- ============================================= CREATE PROCEDURE [dbo].[PROC_INSERT_T_EMS_CN31_CN33_MAIN]  	 AS BEGIN 	--TRUNCATE TABLE T_EMS_CN31_CN33_MAIN;  	-- +  +  +   +   + รายจ่าย +  +  +  +  +  +  + 	INSERT INTO [dbo].[T_EMS_CN31_CN33_MAIN]            ([DISPATCHING_ID] ,[DISPATCHING_OPERATOR_SEQ] ,[DESTINATION_OPERATOR_SEQ] 		  ,[ORIGIN_OFFICE_SEQ] ,[DESTINATION_OFFICE_SEQ] ,[MAIL_CATEGORY_SEQ] ,[MAIL_SUBCLASS_SEQ] 		  ,[DISPATCH_NO] ,[DESPTCH_DATE],RECEIPT_DT,TRANSIT_OPERATOR ,[FLIGHT_TRIP_NUMBERS] ,[CN31EMS_YEAR] ,[CN31EMS_QUARTER] 		  ,[CN31EMS_MONTH],[CN31EMS_MONTH_ID] ,[MAIL_NO] ,[SERVICE_TYPE] ,[ZONE] ,[COUNTRY_SEQ] --,[BAG_NO]  		  ,TOTAL_ITEM_BAG , TOTAL_WEIGHT_BAG ,TOTAL_NO_BAG 		  ,[TOTAL_ITEM] ,[TOTAL_WEIGHT],[OBSERVATION] ,[DEL_FLAG] 		  ,[RECORD_STATUS] ,[CREATE_USER_ID],[CREATE_DATE],[UPDATE_USER_ID] ,UPDATE_DATE  ,EVT_GMT_DATE                 ) 	SELECT				L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID ,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD 						,C_OFFICES.[OFFICE_FCD] as ORIG_OFFICE_FCD, DES_OFF.OFFICE_FCD as DEST_OFFICE_FCD 						,C_MAIL_CATEGORIES.MAIL_CATEGORY_SEQ, C_MAIL_SUBCLASSES.MAIL_SUBCLASS_SEQ, SUBSTRING(R.RECPTCL_FID,17,4) as DESP_NO 						,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT,L_ACC_DESPTCH_RAW_DATA.RECEIPT_DT ,'-' as TRANSIT_OPERATOR  						,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as [FLIGHT_TRIP_NUMBERS] 						,year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as CN31EMS_YEAR 						,CASE WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('01','02','03') then '1' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('04','05','06') then '2' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('07','08','09') then '3' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('10','11','12') then '4' 						 ELSE '0' END as CN31EMS_QUARTER 						,C_MONTH.MONTH_NAME_EN,month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as [CN31EMS_MONTH]  						, SUBSTRING(R.RECPTCL_FID,17,4) as MAIL_NO  						,'O' as SERVICE_TYPE , ZONE_SEQ , COUNTRY_SEQ 						,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS ,L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS 						,sum(R.RECPTCL_MAILITMS_NO) as TOTAL_ITEM , sum(R.RECPTCL_WEIGHT) as WG  						, '-' as Observation 						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 						,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 						,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 						,max(R.EVT_GMT_DT) as EVT_GMT_DT 	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA  	LEFT OUTER JOIN			(SELECT   SUBSTRING(RECPTCL_FID,1,20) as RECPTCL_FID,max(convert(date,EVT_GMT_DT)) as EVT_GMT_DT,EVT_CONSGNT_PID 									,RECPTCL_MAILITMS_NO ,RECPTCL_WEIGHT 						FROM		[MonitasDB].[dbo].L_RECPTCLS 						GROUP BY SUBSTRING(RECPTCL_FID,1,20),EVT_CONSGNT_PID,RECPTCL_MAILITMS_NO ,RECPTCL_WEIGHT) as R  	ON 					L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = substring(R.RECPTCL_FID,1,20) 	LEFT OUTER JOIN			[dbo].[C_OFFICES] ON C_OFFICES.[OFFICE_FCD] = L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS  	INNER JOIN				[dbo].[C_OFFICES] as DES_OFF on DES_OFF.OFFICE_FCD = L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  	LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS ON C_LOCATIONS.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,1,5) collate THAI_CI_AS 	LEFT OUTER JOIN			[MonitasDB].[dbo].C_LOCATIONS as DEST_LOCATION ON DEST_LOCATION.LOCATION_FCD = substring(L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID,7,5) collate THAI_CI_AS 	INNER JOIN				C_MAIL_CATEGORIES on L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD collate THAI_CI_AS = C_MAIL_CATEGORIES.MAIL_CATEGORY_CD 	INNER JOIN				C_MAIL_SUBCLASSES on L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD collate THAI_CI_AS = C_MAIL_SUBCLASSES.MAIL_SUBCLASS_FCD 	INNER JOIN				C_MONTH on month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  = C_MONTH.MONTH_SEQ 	INNER JOIN				C_COUNTRIES on DES_OFF.COUNTRY_CD = C_COUNTRIES.COUNTRY_CD 	where					L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like('FR%') 	and						L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD= 'A'  and L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	and						convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 	and							L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	not in					(select [DISPATCHING_ID] from T_EMS_CN31_CN33_MAIN where SERVICE_TYPE ='O' and convert(date,[DESPTCH_DATE]) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)) 	--and						convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  between '2024-01-01' and '2024-02-05' 	--and						year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = '2023' 	--and						month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = '12' 	--and						SUBSTRING(R.RECPTCL_FID,17,4)='3158'  	GROUP BY				L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID  ,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD 							,C_OFFICES.[OFFICE_FCD] , DES_OFF.OFFICE_FCD  							,C_MAIL_CATEGORIES.MAIL_CATEGORY_SEQ, C_MAIL_SUBCLASSES.MAIL_SUBCLASS_SEQ, SUBSTRING(R.RECPTCL_FID,17,4)  							,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT ,L_ACC_DESPTCH_RAW_DATA.RECEIPT_DT 							,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','')  							,year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) 							,CASE WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('01','02','03') then '1' 								WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('04','05','06') then '2' 								WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('07','08','09') then '3' 								WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('10','11','12') then '4' 							ELSE '0' END , ZONE_SEQ , COUNTRY_SEQ 							,C_MONTH.MONTH_NAME_EN,month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  							,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS ,L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS  	 ORDER BY			convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT),L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID   -- +  +  +   +   + รายได้ +  +  +  +  +  +  +  	INSERT INTO [dbo].[T_EMS_CN31_CN33_MAIN] 			   ([DISPATCHING_ID] ,[DISPATCHING_OPERATOR_SEQ] ,[DESTINATION_OPERATOR_SEQ] 			  ,[ORIGIN_OFFICE_SEQ] ,[DESTINATION_OFFICE_SEQ] ,[MAIL_CATEGORY_SEQ] ,[MAIL_SUBCLASS_SEQ] 			  ,[DISPATCH_NO] ,[DESPTCH_DATE],RECEIPT_DT,TRANSIT_OPERATOR ,[FLIGHT_TRIP_NUMBERS] ,[CN31EMS_YEAR] ,[CN31EMS_QUARTER] 			  ,[CN31EMS_MONTH],[CN31EMS_MONTH_ID] ,[MAIL_NO] ,[SERVICE_TYPE] ,[ZONE] ,[COUNTRY_SEQ] --,[BAG_NO] 			  ,TOTAL_ITEM_BAG , TOTAL_WEIGHT_BAG ,TOTAL_NO_BAG 			  ,[TOTAL_ITEM] ,[TOTAL_WEIGHT],[OBSERVATION] ,[DEL_FLAG] 			  ,[RECORD_STATUS],[CREATE_USER_ID] ,[CREATE_DATE],[UPDATE_USER_ID] ,UPDATE_DATE  ,EVT_GMT_DATE      			   ) 	SELECT				L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID as DISPATCHING_ID 						,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD 						, L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD, L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 						,C_MAIL_CATEGORIES.MAIL_CATEGORY_SEQ, C_MAIL_SUBCLASSES.MAIL_SUBCLASS_SEQ ,substring(R.RECPTCL_FID,17,4) as DISP_NO 						,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT as DESPTCH_DEPARTURE_DT,L_ACC_DESPTCH_RAW_DATA.RECEIPT_DT ,'-' as TRANSIT_OPERATOR  						,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','') as [FLIGHT_TRIP_NUMBERS] 						,year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as CN31EMS_YEAR 						,CASE WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('01','02','03') then '1' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('04','05','06') then '2' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('07','08','09') then '3' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('10','11','12') then '4' 						 ELSE '0' END as CN31EMS_QUARTER 						 ,C_MONTH.MONTH_NAME_EN,month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) as [CN31EMS_MONTH]  						  ,substring(R.RECPTCL_FID,17,4) as MAIL_NO ,'I' as SERVICE_TYPE , ZONE_SEQ , COUNTRY_SEQ 						  ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS ,L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS 						,sum(R.RECPTCL_MAILITMS_NO) as TOTAL_ITEM , sum(R.RECPTCL_WEIGHT) as WG   						, 'Normal' as Observation 						,'N' as [DEL_FLAG] ,'A' as [RECORD_STATUS] 					  ,99 as [CREATE_USER_ID] ,getdate() as [CREATE_DATE] 					  ,99 as [UPDATE_USER_ID] ,getdate() as [UPDATE_DATE] 					  ,max(R.EVT_GMT_DT) as EVT_GMT_DT  	FROM				[MonitasDB].[dbo].L_ACC_DESPTCH_RAW_DATA 	INNER JOIN			(SELECT   SUBSTRING(RECPTCL_FID,1,20) as RECPTCL_FID,EVT_CONSGNT_PID,max(convert(date,EVT_GMT_DT)) as EVT_GMT_DT 									,RECPTCL_MAILITMS_NO ,RECPTCL_WEIGHT 						FROM		[MonitasDB].[dbo].L_RECPTCLS  						GROUP BY    SUBSTRING(RECPTCL_FID,1,20) ,EVT_CONSGNT_PID,RECPTCL_MAILITMS_NO ,RECPTCL_WEIGHT 						) as R ON L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID = SUBSTRING(R.RECPTCL_FID,1,20) 	INNER JOIN			C_OFFICES ON L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD collate THAI_CI_AS = C_OFFICES.OFFICE_FCD 	INNER JOIN			C_OFFICES as DES_OFF ON L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD collate THAI_CI_AS  = DES_OFF.OFFICE_FCD  	INNER JOIN			C_MAIL_CATEGORIES ON L_ACC_DESPTCH_RAW_DATA.MAIL_CATEGORY_CD collate THAI_CI_AS  = C_MAIL_CATEGORIES.MAIL_CATEGORY_CD 	INNER JOIN			C_MAIL_SUBCLASSES ON L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD collate THAI_CI_AS  = C_MAIL_SUBCLASSES.MAIL_SUBCLASS_FCD 	INNER JOIN			C_MONTH ON month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = C_MONTH.MONTH_SEQ 	INNER JOIN			C_COUNTRIES on C_OFFICES.COUNTRY_CD = C_COUNTRIES.COUNTRY_CD 	LEFT OUTER JOIN		[MonitasDB].[dbo].[L_CONSGNTS] ON L_CONSGNTS.CONSGNT_PID = R.EVT_CONSGNT_PID 	where				L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD like 'THBKK%' --and L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD = 'CZPRGA' 	and					L_ACC_DESPTCH_RAW_DATA.MAIL_SUBCLASS_FCD in('ED','EM','EN') 	and					convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date) 	--and						convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  between '2024-01-01' and '2024-02-05' 	and					L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID collate THAI_CI_AS 	not in				(select [DISPATCHING_ID] from T_EMS_CN31_CN33_MAIN where SERVICE_TYPE ='I' and convert(date,[DESPTCH_DATE]) between cast(DATEADD(mm, DATEDIFF(m,0,GETDATE()),0) as date) and cast(DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE())+1,0)) as date)) 	--and						year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) = '2023' 	--and					R.RECPTCL_FID = 'AEDXBATHBKKBAEM27171' 	GROUP BY			 L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID  						,L_ACC_DESPTCH_RAW_DATA.ORIG_OPERATOR_CD, L_ACC_DESPTCH_RAW_DATA.DEST_OPERATOR_CD 						, L_ACC_DESPTCH_RAW_DATA.ORIG_OFFICE_FCD, L_ACC_DESPTCH_RAW_DATA.DEST_OFFICE_FCD 						,C_MAIL_CATEGORIES.MAIL_CATEGORY_SEQ, C_MAIL_SUBCLASSES.MAIL_SUBCLASS_SEQ ,substring(R.RECPTCL_FID,17,4)  						,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT ,L_ACC_DESPTCH_RAW_DATA.RECEIPT_DT 						,REPLACE(REPLACE(L_ACC_DESPTCH_RAW_DATA.FLIGHTS,'\','/'),' ','')  						,year(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  						,CASE WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('01','02','03') then '1' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('04','05','06') then '2' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('07','08','09') then '3' 							  WHEN month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT) in ('10','11','12') then '4' 						 ELSE '0' END  						 ,C_MONTH.MONTH_NAME_EN,month(L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT)  						 , ZONE_SEQ , COUNTRY_SEQ  						 ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_ITEMS ,L_ACC_DESPTCH_RAW_DATA.TOTAL_WEIGHT_GROSS ,L_ACC_DESPTCH_RAW_DATA.TOTAL_NO_BAGS  	ORDER BY			convert(date,L_ACC_DESPTCH_RAW_DATA.DESPTCH_DT),L_ACC_DESPTCH_RAW_DATA.ACC_DESPTCH_FID  END ",1670,9744,-8074,118919,13,1670
