"(@1 int,@2 int,@3 int,@4 int)select distinct t.ClientPolicyFile, t.ClientPolicyHash, t.LD_TASK_IDN, t.PolicyHash from LD_TASK t inner join LD_TASK_MACHINE tm on tm.LD_TASK_IDN = t.LD_TASK_IDN where tm.SOURCE_TYPE <> 5 and t.Overrides is not null and t.ClientPolicyHash is not null and t.ClientPolicyHash <> '' and INITIAL_START <= GETDATE() and t.ScopeUser_Idn in (select distinct User_Idn ConsoleUser_Idn from ConsoleUserGroup Where Group_Idn in ( 					select ConsoleUserScope.ConsoleUser_Idn 					from ScopeComputer, ConsoleUserScope, Scope  					where ScopeComputer.Scope_Idn = ConsoleUserScope.Scope_Idn 						AND Scope.Scope_Idn = ScopeComputer.Scope_Idn 						AND Computer_Idn = 19654 					union 						select ConsoleUserScope.ConsoleUser_Idn 						from ConsoleUserScope, Scope 						where Scope.Scope_Idn = ConsoleUserScope.Scope_Idn 							AND Scope.ScopeType = 1 					) 					union 						select ConsoleUserScope.ConsoleUser_Idn 						from ScopeComputer, ConsoleUserScope, Scope 						where ScopeComputer.Scope_Idn = ConsoleUserScope.Scope_Idn 							AND Scope.Scope_Idn = ScopeComputer.Scope_Idn 							AND Computer_Idn = 19654 					union 						select ConsoleUserScope.ConsoleUser_Idn 						from ConsoleUserScope, Scope 						where Scope.Scope_Idn = ConsoleUserScope.Scope_Idn 							AND Scope.ScopeType = 1) and t.TASK_STATUS <> @1 and tm.MAC_STATUS <> @2 and tm.COMPUTER_IDN=@3 and (t.LimitByAllowedMachines = 0 or t.LimitByAllowedMachines is null or t.LD_TASK_IDN in (select LD_TASK_IDN from TaskAllowedMachines where COMPUTER_IDN = @4))",1699,2,1697,670,0,1699
"  -- ============================================= -- Author:		< Busisoft > -- Create date: < Thu 9 July 2020 > -- Description:	< New Devices Add > -- ============================================= CREATE TRIGGER [dbo].[NewDevicesAddCPU]    ON  [dbo].[Processor]    AFTER  INSERT AS  BEGIN   	SET NOCOUNT ON;  	INSERT INTO [THP-LDMSNONADDB].DBO.Processor_Revision 	SELECT [Computer_Idn] 		  ,[Type] 		  ,[MhzSpeed] 		  ,[ProcCount] 		  ,[CoresPerPkg] 		  ,[OldType]	= NULL 		  ,[OldMhzSpeed]	= NULL 		  ,[OldProcCount]	= NULL 		  ,[OldCoresPerPkg]	= NULL 		  ,[UpdateTime]	= GETDATE() 		  ,[Revision] = 0  		  ,[Active] = 1 	  FROM [THP-LDMSNONADDB].[dbo].[Processor] 	  WHERE Computer_Idn NOT IN ( SELECT Computer_Idn FROM [THP-LDMSNONADDB].DBO.Processor_Revision )  END  ",1467,9496,-8029,929045,2,92460
"DELETE FROM FILEINFOINSTANCE WHERE FileInfoInstance_Idn IN (303704593,303704592,303704568,303704567,298620091,298620079,298620076,298620068,282633634,285307312,284983764,276525085,303704589,303704577,303704564,298620094,298620077,241661197,303704506,303704503,303704588,303704587,288844671,288844670,303704535,303704533,303704530,303704529,298620088,298620085,298620078,298620065,303704505,241661256,234767566,298620141,288844662,303704579,303704563,303704559,303704537,298620092,298620080,298620075,285307311,303704504,303704562,303704534,298620090,298620089,298620074,303704514,288844600,298620150,303704578,303704569,303704566,303704515,298620060,288844596,303704507,303704538,303704536,298620093,298620083,292912343,292912342,298620061,288844597,303704576,303704560,298620081,234767565,234767564,303704571,303704565,298620067,276525086,276525082,303704561,276525087,270068380,298620072,234767555,276525093,303704539,303704532,298620087,276525084,276525096,282412200,282412199,303704531,298620086,303704570,298620084,298620144,288844665,298620064,303704557,282412198,285307377,298620073,275873760,276525083,288844672,292912436,285307376,285307375,298620166,303704513,278666199,288844669,298620082,303704586,276525095,276525094,282412201,241661255,241661254,298620143,298620142,285307374,284983771,298620163,288844664,288844663,234767563,284983770,284983769,298620165,298620164,241661253)",315,14,301,5553,389,315
"(@P1 int,@P2 int,@P3 nchar(12),@P4 int,@P5 nchar(10))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",185,8,177,946,0,370
"SELECT     DB_NAME (database_id) as [Database Name],     name as [Database File Name],     [Type] = CASE WHEN Type_Desc = 'ROWS' THEN 'Data File(s)'             WHEN Type_Desc = 'LOG'  THEN 'Log File(s)'             ELSE Type_Desc END,     size*8/1024 as 'Size (MB)',     physical_name as [Database_File_Location] FROM sys.master_files ORDER BY 1,3  IF OBJECT_ID('tempdb.dbo.#space') IS NOT NULL     DROP TABLE #space  CREATE TABLE #space (       database_id INT PRIMARY KEY     , data_used_size DECIMAL(18,2)     , log_used_size DECIMAL(18,2) )  DECLARE @SQL NVARCHAR(MAX)  SELECT @SQL = STUFF((     SELECT '     USE [' + d.name + ']     INSERT INTO #space (database_id, data_used_size, log_used_size)     SELECT           DB_ID()         , SUM(CASE WHEN [type] = 0 THEN space_used END)         , SUM(CASE WHEN [type] = 1 THEN space_used END)     FROM (         SELECT s.[type], space_used = SUM(FILEPROPERTY(s.name, ''SpaceUsed'') * 8. / 1024)         FROM sys.database_files s         GROUP BY s.[type]     ) t;'     FROM sys.databases d     WHERE d.[state] = 0     FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')  EXEC sys.sp_executesql @SQL  SELECT       d.database_id     , d.name     , d.state_desc     , d.recovery_model_desc     , t.total_size     , t.data_size     , s.data_used_size     , t.log_size     , s.log_used_size     , bu.full_last_date     , bu.full_size     , bu.log_last_date     , bu.log_size FROM (     SELECT           database_id         , log_size = CAST(SUM(CASE WHEN [type] = 1 THEN size END) * 8. / 1024 AS DECIMAL(18,2))         , data_size = CAST(SUM(CASE WHEN [type] = 0 THEN size END) * 8. / 1024 AS DECIMAL(18,2))         , total_size = CAST(SUM(size) * 8. / 1024 AS DECIMAL(18,2))     FROM sys.master_files     GROUP BY database_id ) t JOIN sys.databases d ON d.database_id = t.database_id LEFT JOIN #space s ON d.database_id = s.database_id LEFT JOIN (     SELECT           database_name         , full_last_date = MAX(CASE WHEN [type] = 'D' THEN backup_finish_date END)         , full_size = MAX(CASE WHEN [type] = 'D' THEN backup_size END)         , log_last_date = MAX(CASE WHEN [type] = 'L' THEN backup_finish_date END)         , log_size = MAX(CASE WHEN [type] = 'L' THEN backup_size END)     FROM (         SELECT               s.database_name             , s.[type]             , s.backup_finish_date             , backup_size =                         CAST(CASE WHEN s.backup_size = s.compressed_backup_size                                     THEN s.backup_size                                     ELSE s.compressed_backup_size                         END / 1048576.0 AS DECIMAL(18,2))             , RowNum = ROW_NUMBER() OVER (PARTITION BY s.database_name, s.[type] ORDER BY s.backup_finish_date DESC)         FROM msdb.dbo.backupset s         WHERE s.[type] IN ('D', 'L')     ) f     WHERE f.RowNum = 1     GROUP BY f.database_name ) bu ON d.name = bu.database_name ORDER BY t.total_size DESC  SELECT      req.session_id     , req.total_elapsed_time AS duration_ms     , req.cpu_time AS cpu_time_ms     , req.total_elapsed_time - req.cpu_time AS wait_time     , req.logical_reads     , SUBSTRING (REPLACE (REPLACE (SUBSTRING (ST.text, (req.statement_start_offset/2) + 1,         ((CASE statement_end_offset            WHEN -1            THEN DATALENGTH(ST.text)              ELSE req.statement_end_offset          END - req.statement_start_offset)/2) + 1) , CHAR(10), ' '), CHAR(13), ' '),        1, 512)  AS statement_text   FROM sys.dm_exec_requests AS req     CROSS APPLY sys.dm_exec_sql_text(req.sql_handle) AS ST ORDER BY total_elapsed_time DESC;  SELECT top 100 t.text,      (qs.total_elapsed_time/1000) / qs.execution_count AS avg_elapsed_time,      (qs.total_worker_time/1000) / qs.execution_count AS avg_cpu_time,      ((qs.total_elapsed_time/1000) / qs.execution_count ) - ((qs.total_worker_time/1000) / qs.execution_count) AS avg_wait_time,      qs.total_logical_reads / qs.execution_count AS avg_logical_reads,      qs.total_logical_writes / qs.execution_count AS avg_writes,      (qs.total_elapsed_time/1000) AS cumulative_elapsed_time_all_executions FROM sys.dm_exec_query_stats qs      CROSS apply sys.Dm_exec_sql_text (sql_handle) t -- WHERE t.text like '<Your Query>%' -- Replace <Your Query> with your query or the beginning part of your query. The special chars like '[','_','%','^' in the query should be escaped. ORDER BY (qs.total_elapsed_time / qs.execution_count) DESC  --Deadlock sql check SELECT     session_id,     start_time,      [status],     command,     blocking_session_id,     wait_type,     wait_time,     open_transaction_count,     transaction_id,     total_elapsed_time,     Definition = CAST(text AS VARCHAR(MAX)) FROM     SYS.DM_EXEC_REQUESTS     CROSS APPLY sys.dm_exec_sql_text(sql_handle)  WHERE blocking_session_id != 0  SELECT sqlserver_start_time, (committed_kb/1024) AS Total_Server_Memory_MB, (committed_target_kb/1024)  AS Target_Server_Memory_MB FROM sys.dm_os_sys_info;",157,157,0,7432,0,157
SELECT target_data 									FROM sys.dm_xe_session_targets xet WITH(nolock) 									JOIN sys.dm_xe_sessions xes WITH(nolock) 									ON xes.address = xet.event_session_address 									WHERE xes.name = 'telemetry_xevents' 									AND xet.target_name = 'ring_buffer',135,89,46,0,0,235892
"(@1 nvarchar(16),@2 nvarchar(5))SELECT DISTINCT A0.DISPLAYNAME, A1.ADDRESS, A0.PRIMARYOWNER, A0.HWLASTSCANDATE, A2.OSTYPE, A3.AGENTVERSION, A0.COMPUTER_IDN, A0.TYPE, A0.DEVICEID, A1.HOSTNAME, A0.HWMONITORINGTYPE, A3.LDMSMANAGED, A4.INSTALLED, A5.VERSION, A6.AVAILABLE, A6.HTML5_ENABLED, A6.RC_ENABLED  FROM Computer A0 (nolock) LEFT OUTER JOIN TCP A1 (nolock) ON A0.Computer_Idn = A1.Computer_Idn LEFT OUTER JOIN Operating_System A2 (nolock) ON A0.Computer_Idn = A2.Computer_Idn LEFT OUTER JOIN LanDesk A3 (nolock) ON A0.Computer_Idn = A3.Computer_Idn LEFT OUTER JOIN WUserAgent A4 (nolock) ON A0.Computer_Idn = A4.Computer_Idn LEFT OUTER JOIN Scanner A5 (nolock) ON A0.Computer_Idn = A5.Computer_Idn LEFT OUTER JOIN AgentState_V A6 (nolock) ON A0.Computer_Idn = A6.Computer_Idn  WHERE (A0.Computer_Idn NOT IN (SELECT Computer_Idn FROM Computer WHERE SCANTYPE=@1) AND A0.Computer_Idn NOT IN (SELECT Computer_Idn FROM Computer WHERE HWMONITORINGTYPE=@2))   ORDER BY  A0.DISPLAYNAME , A1.ADDRESS ",105,272,-167,15966,0,105
"(@_msparam_0 nvarchar(4000))SELECT SCHEMA_NAME(udf.schema_id) AS [Schema], udf.name AS [Name], udf.object_id AS [ID], (case when 'FN' = udf.type then 1 when 'FS' = udf.type then 1 when 'IF' = udf.type then 3 when 'TF' = udf.type then 2 when 'FT' = udf.type then 2 else 0 end) AS [FunctionType], CASE WHEN udf.type IN ('FN','IF','TF') THEN 1 WHEN udf.type IN ('FS','FT') THEN 2 ELSE 1 END AS [ImplementationType], CAST(  case      when udf.is_ms_shipped = 1 then 1     when (         select              major_id          from              sys.extended_properties          where              major_id = udf.object_id and              minor_id = 0 and              class = 1 and              name = N'microsoft_database_tools_support')          is not null then 1     else 0 end                        AS bit) AS [IsSystemObject], CAST(CASE WHEN ISNULL(smudf.definition, ssmudf.definition) IS NULL THEN 1 ELSE 0 END AS bit) AS [IsEncrypted], CAST(ISNULL(OBJECTPROPERTYEX(udf.object_id, N'IsSchemaBound'),0) AS bit) AS [IsSchemaBound], usrt.name AS [DataType] FROM sys.all_objects AS udf LEFT OUTER JOIN sys.sql_modules AS smudf ON smudf.object_id = udf.object_id LEFT OUTER JOIN sys.system_sql_modules AS ssmudf ON ssmudf.object_id = udf.object_id LEFT OUTER JOIN sys.all_parameters AS ret_param ON ret_param.object_id = udf.object_id and ret_param.is_output = @_msparam_0 LEFT OUTER JOIN sys.types AS usrt ON usrt.user_type_id = ret_param.user_type_id WHERE (udf.type in ('TF', 'FN', 'IF', 'FS', 'FT')) ORDER BY [Schema] ASC,[Name] ASC",81,61,20,4185,43,81
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",77,77,0,15392,1,77
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",75,75,0,15395,0,64974
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",74,74,0,15405,0,4471
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",70,61,9,21075,221,74534
"-- ============================================= -- Author:		< Busisoft > -- Create by < Nontawoot Keawka > -- Create date: < Mon 30 Nov 2020 > -- Description:	< Update Department when each user use Remote Control > -- ============================================= CREATE TRIGGER DBO.UPDateDepartment    ON  dbo.RCLog    AFTER INSERT AS  BEGIN 	-- SET NOCOUNT ON added to prevent extra result sets from 	-- interfering with SELECT statements. 	SET NOCOUNT ON;      INSERT INTO [THP-LDMSDB].[dbo].[RCLog_Department] 	SELECT [RCLog_Idn] 		,[RCAction_Idn] 		,[EventTime] 		,[SecurityType] 		,[ViewingComputer] 		,REPLACE([UserName] , 'PRAISANEE\' , '') AS [UserName] 		,[ManagedComputer] 		,[Data] 		,(SELECT [THP-LDMSDB].dbo.GetTHDepartment(REPLACE(T1.UserName , 'PRAISANEE\' , ''))) AS [ThDepartment] 		,(SELECT [THP-LDMSDB].dbo.GetEngDepartment(REPLACE(T1.UserName , 'PRAISANEE\' , ''))) AS [ThDepartment] 	FROM [THP-LDMSDB].[dbo].[RCLog] AS T1 	WHERE CONVERT(VARCHAR(10),EventTime,121) = CONVERT(VARCHAR(10),GETDATE(),121) 	AND RCLog_Idn NOT IN ( 							SELECT	RCLog_Idn  							FROM	[THP-LDMSDB].[dbo].[RCLog_Department] 						 )  END ",62,54,8,1185,0,17593
"(@P1 int,@P2 int,@P3 nchar(10),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",58,15,43,2133,0,116
"(@P1 int,@P2 int,@P3 nchar(12),@P4 int,@P5 nchar(7))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",57,10,47,862,0,115
"DELETE FROM SERVICES WHERE Services_Idn IN (53962809,53962799,53962808,53962812,53962802,53962811,53962815,53962813,53962804,53962803,53962806,53962810,53962814,53962801,53962800,53962798,53962805,53962807,53962816)",45,0,45,364,4,45
(@P1 int)SELECT * FROM FILEINFOINSTANCE (nolock) WHERE COMPUTER_IDN = @P1 ORDER BY PATH,44,39,5,629,0,20671373
"(@1 int,@2 datetime,@3 nvarchar(10),@4 nvarchar(13),@5 nvarchar(10),@6 nvarchar(15),@7 nvarchar(4000))insert into RCLog (RCAction_Idn, EventTime, SecurityType, ViewingComputer, UserName, ManagedComputer, Data)  values( @1, @2, @3, @4, @5, @6, @7)",44,41,3,1270,8,44
"-- ============================================= -- Author:		< Busisoft > -- Create date: < Fri 10 July 2020 > -- Description:	< New Devices Add > -- ============================================= Create TRIGGER [dbo].[NewDevicesAddMainboard]    ON  [dbo].[Motherboard]    AFTER  INSERT AS  BEGIN   	SET NOCOUNT ON;  	INSERT INTO Motherboard_Revision 	SELECT [Computer_Idn] 		  ,[Manufacturer] 		  ,[ProductName] 		  ,[MBVersion] 		  ,[SerialNum] 		  ,[OldManufacturer] = NULL 		  ,[OldProductName] = NULL 		  ,[OldMBVersion] = NULL 		  ,[OldSerialNum] = NULL 		  ,[UpdateTime] = GETDATE() 		  ,[Revision] = 0 		  ,[Active] = 1 	  FROM [THP-LDMSNONADDB].[dbo].[Motherboard] 	  WHERE Computer_Idn NOT IN ( SELECT Computer_Idn FROM Motherboard_Revision )  END ",43,44,-1,22385,1,1906
"(@1 int,@2 datetime,@3 nvarchar(10),@4 nvarchar(12),@5 nvarchar(7),@6 nvarchar(15),@7 nvarchar(4000))insert into RCLog (RCAction_Idn, EventTime, SecurityType, ViewingComputer, UserName, ManagedComputer, Data)  values( @1, @2, @3, @4, @5, @6, @7)",41,38,3,1274,10,83
"select UniqueFilename, URL from Patch where DiscardPeriodHours=43800",37,49,-12,18765,0,4924067
SELECT COUNT(*) FROM Computer WHERE ScanType = 'Barcode',36,13,23,3119,0,1708689
"select UniqueFilename, URL from Patch where DiscardPeriodHours=43800",33,48,-15,17040,0,35466592
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",33,33,0,7528,0,361995143
"(@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000))SELECT udf.name AS [Name], udf.object_id AS [ID], udf.create_date AS [CreateDate], udf.modify_date AS [DateLastModified], ISNULL(sudf.name, N'') AS [Owner], CAST(case when udf.principal_id is null then 1 else 0 end AS bit) AS [IsSchemaOwned], SCHEMA_NAME(udf.schema_id) AS [Schema], CAST(  case      when udf.is_ms_shipped = 1 then 1     when (         select              major_id          from              sys.extended_properties          where              major_id = udf.object_id and              minor_id = 0 and              class = 1 and              name = N'microsoft_database_tools_support')          is not null then 1     else 0 end                        AS bit) AS [IsSystemObject], usrt.name AS [DataType], s1ret_param.name AS [DataTypeSchema], ISNULL(baset.name, N'') AS [SystemType], CAST(CASE WHEN baset.name IN (N'nchar', N'nvarchar') AND ret_param.max_length <> -1 THEN ret_param.max_length/2 ELSE ret_param.max_length END AS int) AS [Length], CAST(ret_param.precision AS int) AS [NumericPrecision], CAST(ret_param.scale AS int) AS [NumericScale], ISNULL(xscret_param.name, N'') AS [XmlSchemaNamespace], ISNULL(s2ret_param.name, N'') AS [XmlSchemaNamespaceSchema], ISNULL( (case ret_param.is_xml_document when 1 then 2 else 1 end), 0) AS [XmlDocumentConstraint], CASE WHEN usrt.is_table_type = 1 THEN N'structured' ELSE N'' END AS [UserType], CAST(ISNULL(OBJECTPROPERTYEX(udf.object_id,N'ExecIsAnsiNullsOn'),0) AS bit) AS [AnsiNullsStatus], CAST(ISNULL(OBJECTPROPERTYEX(udf.object_id, N'IsSchemaBound'),0) AS bit) AS [IsSchemaBound], CAST(CASE WHEN ISNULL(smudf.definition, ssmudf.definition) IS NULL THEN 1 ELSE 0 END AS bit) AS [IsEncrypted], case when amudf.object_id is null then N'' else asmbludf.name end AS [AssemblyName], case when amudf.object_id is null then N'' else amudf.assembly_class end AS [ClassName], case when amudf.object_id is null then N'' else amudf.assembly_method end AS [MethodName], CAST(case when amudf.object_id is null then CAST(smudf.null_on_null_input AS bit) else amudf.null_on_null_input end AS bit) AS [ReturnsNullOnNullInput], case when amudf.object_id is null then case isnull(smudf.execute_as_principal_id, -1) when -1 then 1 when -2 then 2 else 3 end else case isnull(amudf.execute_as_principal_id, -1) when -1 then 1 when -2 then 2 else 3 end end AS [ExecutionContext], case when amudf.object_id is null then ISNULL(user_name(smudf.execute_as_principal_id),N'') else ISNULL(user_name(amudf.execute_as_principal_id), N'') end AS [ExecutionContextPrincipal], CAST(OBJECTPROPERTYEX(udf.object_id, N'IsDeterministic') AS bit) AS [IsDeterministic], (case when 'FN' = udf.type then 1 when 'FS' = udf.type then 1 when 'IF' = udf.type then 3 when 'TF' = udf.type then 2 when 'FT' = udf.type then 2 else 0 end) AS [FunctionType], CASE WHEN udf.type IN ('FN','IF','TF') THEN 1 WHEN udf.type IN ('FS','FT') THEN 2 ELSE 1 END AS [ImplementationType], CAST(ISNULL(OBJECTPROPERTYEX(udf.object_id,N'ExecIsQuotedIdentOn'),0) AS bit) AS [QuotedIdentifierStatus], ret_param.name AS [TableVariableName], ISNULL(sm.uses_native_compilation,0) AS [IsNativelyCompiled], CAST(ISNULL(sm.inline_type,0) AS bit) AS [InlineType], CAST(ISNULL(sm.is_inlineable,0) AS bit) AS [IsInlineable], ISNULL(smudf.definition, ssmudf.definition) AS [Definition] FROM sys.all_objects AS udf LEFT OUTER JOIN sys.database_principals AS sudf ON sudf.principal_id = ISNULL(udf.principal_id, (OBJECTPROPERTY(udf.object_id, 'OwnerId'))) LEFT OUTER JOIN sys.all_parameters AS ret_param ON ret_param.object_id = udf.object_id and ret_param.is_output = @_msparam_0 LEFT OUTER JOIN sys.types AS usrt ON usrt.user_type_id = ret_param.user_type_id LEFT OUTER JOIN sys.schemas AS s1ret_param ON s1ret_param.schema_id = usrt.schema_id LEFT OUTER JOIN sys.types AS baset ON (baset.user_type_id = ret_param.system_type_id and baset.user_type_id = baset.system_type_id) or ((baset.system_type_id = ret_param.system_type_id) and (baset.user_type_id = ret_param.user_type_id) and (baset.is_user_defined = 0) and (baset.is_assembly_type = 1))  LEFT OUTER JOIN sys.xml_schema_collections AS xscret_param ON xscret_param.xml_collection_id = ret_param.xml_collection_id LEFT OUTER JOIN sys.schemas AS s2ret_param ON s2ret_param.schema_id = xscret_param.schema_id LEFT OUTER JOIN sys.sql_modules AS smudf ON smudf.object_id = udf.object_id LEFT OUTER JOIN sys.system_sql_modules AS ssmudf ON ssmudf.object_id = udf.object_id LEFT OUTER JOIN sys.assembly_modules AS amudf ON amudf.object_id = udf.object_id LEFT OUTER JOIN sys.assemblies AS asmbludf ON asmbludf.assembly_id = amudf.assembly_id LEFT OUTER JOIN sys.all_sql_modules AS sm ON sm.object_id = udf.object_id WHERE (udf.type in ('TF', 'FN', 'IF', 'FS', 'FT'))and(udf.name=@_msparam_1 and SCHEMA_NAME(udf.schema_id)=@_msparam_2)",30,30,0,152,0,30
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",28,96,-68,14535,4,2619
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",28,98,-70,14546,6,394
"(@P1 int,@P2 int,@P3 nchar(7),@P4 int,@P5 nchar(5))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",27,10,17,2017,0,109
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",26,97,-71,14544,3,146542
" CREATE FUNCTION .[dbo].[GetTHDepartment] ( 	@UserName	NVARCHAR(128)	 )  RETURNS NVARCHAR(128) AS   BEGIN 	 	DECLARE @THDepartment NVARCHAR(128)  	SELECT  @THDepartment = Department 	FROM	[10.252.71.113].HEATSM.DBO.EMPLOYEE 	WHERE	LoginID = @USERNAME AND Status = 'ACTIVE'  	RETURN @THDepartment  END ",26,23,3,2,0,7397
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",26,93,-67,14591,5,157
SELECT UPPER(BLOCKEDBNF) FROM METABLOCKED  (nolock) ORDER BY BLOCKEDBNF,24,21,3,234,0,746
"(@1 nvarchar(12),@2 nvarchar(1))select b.name from sysobjects a, syscolumns b where a.name = @1 and a.xtype = @2 and a.id = b.id and b.status = 0x80",24,23,1,2113,0,3636331
SELECT COUNT(*) FROM Computer WHERE ScanType = 'Barcode',24,14,10,4362,0,27998394
" -- ============================================= -- Author:		< Busisoft > -- Create date: < Thu 9 July 2020 > -- Description:	< New Devices Add > -- ============================================= CREATE TRIGGER [dbo].[NewDevicesAddCPU]    ON  [dbo].[Processor]    AFTER  INSERT AS  BEGIN   	SET NOCOUNT ON;  	INSERT INTO [THP-LDMSDB].DBO.Processor_Revision 	SELECT [Computer_Idn] 		  ,[Type] 		  ,[MhzSpeed] 		  ,[ProcCount] 		  ,[CoresPerPkg] 		  ,[OldType]	= NULL 		  ,[OldMhzSpeed]	= NULL 		  ,[OldProcCount]	= NULL 		  ,[OldCoresPerPkg]	= NULL 		  ,[UpdateTime]	= GETDATE() 		  ,[Revision] = 0  		  ,[Active] = 1 	  FROM [THP-LDMSDB].[dbo].[Processor] 	  WHERE Computer_Idn NOT IN ( SELECT Computer_Idn FROM [THP-LDMSDB].DBO.Processor_Revision )  END ",24,19,5,13573,1,1086
"(@1 nvarchar(12),@2 nvarchar(1))select b.name from sysobjects a, syscolumns b where a.name = @1 and a.xtype = @2 and a.id = b.id and b.status = 0x80",24,23,1,2059,0,259785
"DELETE FROM PNPDEVICES WHERE PnPDevices_Idn IN (11038457,11038462,11038458,11038460,11038459,10974165)",24,0,24,99,5,24
"(@1 nvarchar(9),@2 nvarchar(1))select b.name from sysobjects a, syscolumns b where a.name = @1 and a.xtype = @2 and a.id = b.id and b.status = 0x80",24,23,1,2059,0,146354
(@P1 int)SELECT * FROM PRODUCTINSTANCE (nolock) WHERE COMPUTER_IDN = @P1 ORDER BY TITLE,24,75,-51,14467,0,11269
"(@P1 int,@P2 int,@P3 nchar(24),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",21,10,11,1754,0,42
"SELECT e.SourceCore,cu.UserType,e.SyncEnabled,e.CVE_ID,e.CVSS,e.PublishDate,e.Vul_ID,e.Title,e.Description,e.Summary,e.Lang,e.MoreInfoURL,e.FAQURL,e.MaxAutoFixTries,e.Severity,e.OrigSeverity,e.Vendor,e.Status,e.Type,e.AutoFix,e.Fixable,e.CanRunSilent,e.Compliance,e.Category,e.SupercededState,e.LastSerialized,e.Alert,e.HasCustomVars,e.Notes,e.Guid,e.Revision,e.LANDeskRevision,e.CacheRetainPatch,e.LastSavedBy,e.ConsoleUser_Idn,cu.UserName as Owner,e.Vulnerability_Idn, cu.UserName as Owner FROM Vulnerability e LEFT OUTER JOIN ConsoleUser cu on e.ConsoleUser_Idn = cu.ConsoleUser_Idn  WHERE e.SyncEnabled = 2 AND e.Vulnerability_Idn not in (Select Member_Idn from CustomGroupVuln Where CustomGroup_Idn in (select CustomGroup_Idn from CustomGroup Where SyncEnabled > 0))",20,19,1,11020,0,263906
"(@P1 int,@P2 int,@P3 nchar(9),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",20,10,10,2091,0,368
"(@P1 int,@P2 int,@P3 int,@P4 int,@P5 int,@P6 int)SELECT Product_Idn FROM ProductComputer (nolock) WHERE Computer_Idn = @P1 AND Product_Idn NOT IN (SELECT Product_Idn FROM Product (nolock) WHERE FileMatching = @P2 AND LDMSProduct = @P3 AND DataSourceType = @P4 AND (Action = @P5 OR Action = @P6))",19,69,-50,14187,0,2112909
"(@P1 int,@P2 int,@P3 nchar(18),@P4 int,@P5 nchar(13))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",18,11,7,1576,0,37
(@P1 int)SELECT * FROM FILEINFOINSTANCE (nolock) WHERE COMPUTER_IDN = @P1 ORDER BY PATH,18,15,3,243,0,6071201
"-- ============================================= -- Author:		< Busisoft > -- Create date: < Fri 10 July 2020 > -- Description:	< New Devices Add > -- ============================================= Create TRIGGER [dbo].[NewDevicesAddMainboard]    ON  [dbo].[Motherboard]    AFTER  INSERT AS  BEGIN   	SET NOCOUNT ON;  	INSERT INTO Motherboard_Revision 	SELECT [Computer_Idn] 		  ,[Manufacturer] 		  ,[ProductName] 		  ,[MBVersion] 		  ,[SerialNum] 		  ,[OldManufacturer] = NULL 		  ,[OldProductName] = NULL 		  ,[OldMBVersion] = NULL 		  ,[OldSerialNum] = NULL 		  ,[UpdateTime] = GETDATE() 		  ,[Revision] = 0 		  ,[Active] = 1 	  FROM [THP-LDMSDB].[dbo].[Motherboard] 	  WHERE Computer_Idn NOT IN ( SELECT Computer_Idn FROM Motherboard_Revision )  END ",18,17,1,12661,1,2045
"SELECT e.SourceCore,cu.UserType,e.SyncEnabled,e.CVE_ID,e.CVSS,e.PublishDate,e.Vul_ID,e.Title,e.Description,e.Summary,e.Lang,e.MoreInfoURL,e.FAQURL,e.MaxAutoFixTries,e.Severity,e.OrigSeverity,e.Vendor,e.Status,e.Type,e.AutoFix,e.Fixable,e.CanRunSilent,e.Compliance,e.Category,e.SupercededState,e.LastSerialized,e.Alert,e.HasCustomVars,e.Notes,e.Guid,e.Revision,e.LANDeskRevision,e.CacheRetainPatch,e.LastSavedBy,e.ConsoleUser_Idn,cu.UserName as Owner,e.Vulnerability_Idn, cu.UserName as Owner FROM Vulnerability e LEFT OUTER JOIN ConsoleUser cu on e.ConsoleUser_Idn = cu.ConsoleUser_Idn  WHERE e.SyncEnabled = 2 AND e.Vulnerability_Idn not in (Select Member_Idn from CustomGroupVuln Where CustomGroup_Idn in (select CustomGroup_Idn from CustomGroup Where SyncEnabled > 0))",18,17,1,9403,0,232031
"(@P1 int,@P2 int,@P3 nchar(16),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",18,10,8,1045,0,36
"(@P1 int,@P2 int,@P3 nchar(11),@P4 int,@P5 nchar(37))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",17,10,7,3466,0,35
"DELETE FROM USBDEVICE WHERE USBDevice_Idn IN (3187270,3187269)",16,0,16,33,3,16
"(@P1 int,@P2 int,@P3 nchar(12),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",16,11,5,5616,0,164
"(@P1 int,@P2 int,@P3 nchar(18),@P4 int,@P5 nchar(5))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",16,9,7,1872,0,97
"(@P1 int,@P2 int,@P3 nchar(7),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",15,9,6,1815,0,31
"(@P1 int,@P2 int,@P3 nchar(10),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",15,10,5,1719,0,94
"(@P1 int,@P2 int,@P3 nchar(22),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",15,11,4,2169,0,31
"DECLARE @Computer_ID      INT,         @DriveNo          INT,         @Model            VARCHAR(255),         @Interface        VARCHAR(64),         @StorageTotal     INT,         @SerialNumber     VARCHAR(64),         @CountChk         INT   DECLARE @Computer_ID_R    INT,         @DriveNo_R        INT,         @Model_R          VARCHAR(255),         @Interface_R      VARCHAR(64),         @StorageTotal_R   INT,         @SerialNumber_R   VARCHAR(64),         @Revision         INT,         @CountChk_R       INT   TRUNCATE TABLE	[FixedDrives_TEMP]  INSERT INTO [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] SELECT  [Computer_Idn]         ,[DriveNo]         ,[Model]         ,[Interface]         ,[StorageTotal]         ,ISNULL(REPLACE([SerialNumber],'NULL','-----'),'-----') FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives] --WHERE   Computer_Idn = 6010-- AND Interface <> 'USB' WHERE Interface <> 'USB'   WHILE ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP] ) > 0     BEGIN          SELECT TOP 1                     @Computer_ID   =   [Computer_Idn]                 ,@DriveNo       =   [DriveNo]                 ,@Model         =   [Model]                 ,@Interface     =   [Interface]                 ,@StorageTotal  =   [StorageTotal]                 ,@SerialNumber  =   [SerialNumber]         FROM    [THP-LDMSNONADDB].[dbo].[FixedDrives_TEMP]         ORDER BY Computer_Idn , DriveNo ASC                  --SELECT @Computer_ID  		IF EXISTS ( SELECT COMPUTER_IDN FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )              BEGIN                                              SET @CountChk   = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID )                 SET @CountChk_R = ( SELECT COUNT(*) FROM [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 WHERE Computer_Idn = @Computer_ID AND Active = 1 )                                  IF @CountChk > @CountChk_R                      BEGIN                                                          DECLARE @CHK_ADD TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,DriveNo2       INT                                                         ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Status         VARCHAR(32)                                 ,Active         BIT                                 ,RevisioinCHK   INT                                                     )                          DECLARE @ComID1A            INT                                 ,@DriveNo1A         INT                                 ,@Model1A           VARCHAR(128)                                 ,@Interface1A       VARCHAR(8)                                 ,@StorageTotal1A    INT                                 ,@SerialNumber1A    VARCHAR(64)                                 ,@SerialNumber2A    VARCHAR(64)                                 ,@StorageTotal2A    INT                                 ,@RevisionCHKA      INT                                 ,@Model2A           VARCHAR(128)                                 ,@Interface2A       VARCHAR(8)                                 ,@StatusA           VARCHAR(32)                                                     ,@DriveNo2A         INT                                                                                                               INSERT INTO @CHK_ADD                                 SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 ,T2.[DriveNo], ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface], ISNULL(T2.Status,'') , T2.Active , T2.Revision                                 FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                                 LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                                 ON T1.Computer_Idn = T2.Computer_Idn                                 WHERE	T1.Computer_Idn = @Computer_ID                                 AND Active = 1                                              WHILE (SELECT COUNT (*) FROM @CHK_ADD) > 0                             BEGIN                                         SELECT TOP 1 @ComID1A = ComID1                                                 ,@DriveNo1A = DriveNo1                                                 ,@Model1A = Model                                                 ,@Interface1A = Interface                                                 ,@StorageTotal1A = StorageTotal1                                                 ,@SerialNumber1A = SerialNumber1                                                 ,@DriveNo2A = DriveNo2                                                 ,@SerialNumber2A = SerialNumber2                                                 ,@StorageTotal2A = StorageTotal2                                                 ,@Model2A = Model2                                                 ,@Interface2A = Interface2                                                 ,@RevisionCHKA = RevisioinCHK                                                 ,@StatusA = [Status]                                         FROM @CHK_ADD                                         ORDER BY DriveNo1                                          IF ( @DriveNo1A = @DriveNo2A AND @SerialNumber1A <> @SerialNumber2A )                                             BEGIN                                                                                                          --SELECT 'CASE AA : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , @Model2A , @Interface2A , @StorageTotal2A , @SerialNumber2A ,'CHANGE' , GETDATE() , @RevisionCHKA + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND Revision = @RevisionCHKA                                                                                                                                             END                                         ELSE IF  @DriveNo1A <> @DriveNo2A                                             BEGIN                                                     --SELECT 'CASE AA : ADD'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1A , @DriveNo1A , @Model1A , @Interface1A ,@StorageTotal1A ,@SerialNumber1A                                                             , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 1 , 1                                              END                                         ELSE                                             BEGIN                                                     IF @StatusA = 'NORMAL' OR @StatusA IS NULL                                                         BEGIN                                                                 --SELECT 'CASE AA : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1A AND DriveNo = @DriveNo1A AND SerialNumber = @SerialNumber1A                                                         END                                             END                                      DELETE FROM @CHK_ADD WHERE ComID1 = @ComID1A AND DriveNo1 = @DriveNo1A                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                                      END                  ELSE IF @CountChk < @CountChk_R                      BEGIN                              DECLARE @CHK_REMOVE TABLE                             (                                 ComID1  INT                                 ,DriveNo1 INT                                 ,Model  VARCHAR(128)                                 ,Interface VARCHAR(8)                                 ,StorageTotal1 INT                                 ,SerialNumber1 VARCHAR(64)                                 ,SerialNumber2 VARCHAR(64)                                 ,StorageTotal2 INT                                 ,Model2  VARCHAR(128)                                 ,Interface2 VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1  INT                                     ,@DriveNo1 INT                                     ,@Model1  VARCHAR(128)                                     ,@Interface1 VARCHAR(8)                                     ,@StorageTotal1 INT                                     ,@SerialNumber1 VARCHAR(64)                                     ,@SerialNumber2 VARCHAR(64)                                     ,@StorageTotal2 INT                                     ,@RevisionCHK   INT                                     ,@Model2  VARCHAR(128)                                     ,@Interface2 VARCHAR(8)                                     ,@Status         VARCHAR(32)                              INSERT INTO @CHK_REMOVE                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                     , ISNULL(T2.[SerialNumber],'-----') , T2.[StorageTotal],T2.[Model],T2.[Interface] , T1.[Active] , T1.[Revision] , ISNULL(T1.[Status],'')                             FROM	[THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_REMOVE) > 0                             BEGIN                                         SELECT TOP 1 @ComID1 = ComID1                                                 ,@DriveNo1 = DriveNo1                                                 ,@Model1 = Model                                                 ,@Interface1 = Interface                                                 ,@StorageTotal1 = StorageTotal1                                                 ,@SerialNumber1 = SerialNumber1                                                 ,@SerialNumber2 = SerialNumber2                                                 ,@StorageTotal2 = StorageTotal2                                                 ,@Model2 = Model2                                                 ,@Interface2 = Interface2                                                 ,@RevisionCHK = RevisioinCHK                                                 ,@Status = [Status]                                         FROM @CHK_REMOVE                                         ORDER BY DriveNo1                                          IF @SerialNumber2 = '-----'                                             BEGIN                                                     IF @Status <> 'REMOVE'                                                     BEGIN                                                         --SELECT 'CASE RR : REMOVE'                                                         INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SELECT @ComID1 , @DriveNo1 , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1                                                                 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2 ,'REMOVE' , GETDATE() , @RevisionCHK + 1 , 1                                                          UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                         SET     Active = 0                                                                  ,UpdateTime = GETDATE()                                                         WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                      END                                              END                                         ELSE IF  @SerialNumber1 <> @SerialNumber2                                             BEGIN                                                     --SELECT 'CASE RR : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1 , @DriveNo1 , @Model2 , @Interface2 ,@StorageTotal2 ,@SerialNumber2                                                             , @Model1 , @Interface1 , @StorageTotal1 , @SerialNumber1 ,'CHANGE' , GETDATE() , @RevisionCHK + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND Revision = @RevisionCHK                                                                                        END                                         ELSE                                             BEGIN                                                     IF @Status = 'NORMAL' OR @Status IS NULL                                                         BEGIN                                                                 --SELECT 'CASE RR : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1 AND DriveNo = @DriveNo1 AND SerialNumber = @SerialNumber1                                                         END                                             END                                      DELETE FROM @CHK_REMOVE WHERE ComID1 = @ComID1 AND DriveNo1 = @DriveNo1                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                      END                  ELSE                      BEGIN                              DECLARE @CHK_EQUAL TABLE                             (                                 ComID1          INT                                 ,DriveNo1       INT                                 ,Model          VARCHAR(128)                                 ,Interface      VARCHAR(8)                                 ,StorageTotal1  INT                                 ,SerialNumber1  VARCHAR(64)                                 ,SerialNumber2  VARCHAR(64)                                 ,StorageTotal2  INT                                 ,Model2         VARCHAR(128)                                 ,Interface2     VARCHAR(8)                                                         ,Active         BIT                                 ,RevisioinCHK   INT                                 ,Status         VARCHAR(32)                             )                              DECLARE @ComID1E            INT                                     ,@DriveNo1E         INT                                     ,@Model1E           VARCHAR(128)                                     ,@Interface1E       VARCHAR(8)                                     ,@StorageTotal1E    INT                                     ,@SerialNumber1E    VARCHAR(64)                                     ,@SerialNumber2E    VARCHAR(64)                                     ,@StorageTotal2E    INT                                     ,@RevisionCHKE      INT                                     ,@Model2E           VARCHAR(128)                                     ,@Interface2E       VARCHAR(8)                                     ,@StatusE           VARCHAR(32)                              INSERT INTO @CHK_EQUAL                             SELECT	T1.[Computer_Idn],T1.[DriveNo],T1.[Model],T1.[Interface],T1.[StorageTotal],ISNULL(T1.[SerialNumber],'-----')                                 , ISNULL(T2.[SerialNumber],'-----') , T2.StorageTotal , T2.[Model],T2.[Interface] , T2.Active , T2.Revision, ISNULL(T2.Status,'')                             FROM	[THP-LDMSNONADDB].DBO.[FixedDrives_TEMP] AS T1                             LEFT JOIN [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2 AS T2                             ON T1.Computer_Idn = T2.Computer_Idn                             AND T1.DriveNo = T2.DriveNo                             WHERE	T1.Computer_Idn = @Computer_ID                             AND Active = 1                                                           WHILE (SELECT COUNT (*) FROM @CHK_EQUAL) > 0                             BEGIN                                         SELECT TOP 1 @ComID1E	= ComID1                                                 ,@DriveNo1E		= DriveNo1                                                 ,@Model1E		= Model                                                 ,@Interface1E	= Interface                                                 ,@StorageTotal1E = StorageTotal1                                                 ,@SerialNumber1E = SerialNumber1                                                 ,@SerialNumber2E = SerialNumber2                                                 ,@StorageTotal2E = StorageTotal2                                                 ,@Model2E		= Model2                                                 ,@Interface2E	= Interface2                                                 ,@RevisionCHKE	= RevisioinCHK                                                 ,@StatusE		= [Status]                                         FROM @CHK_EQUAL                                         ORDER BY DriveNo1                                          IF  @SerialNumber1E <> @SerialNumber2E                                             BEGIN                                                      --SELECT 'CASE EE : CHANGE'                                                                                                 INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SELECT @ComID1E , @DriveNo1E , @Model1E , @Interface1E ,@StorageTotal1E ,@SerialNumber1E                                                            , @Model2E , @Interface2E , @StorageTotal2E , @SerialNumber2E ,'CHANGE' , GETDATE() , @RevisionCHKE + 1 , 1                                                      UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                     SET     Active = 0                                                              ,UpdateTime = GETDATE()                                                     WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND Revision = @RevisionCHKE                                                                                         END                                         ELSE                                             BEGIN                                                     IF @StatusE = 'NORMAL' OR @StatusE IS NULL                                                         BEGIN                                                                 --SELECT 'CASE EE : NORMAL'                                                                 UPDATE  [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                                                                 SET     UpdateTime = GETDATE()                                                                         ,[Status] = 'NORMAL'                                                                 WHERE   Computer_Idn = @ComID1E AND DriveNo = @DriveNo1E AND SerialNumber = @SerialNumber1E                                                         END                                             END                                      DELETE FROM @CHK_EQUAL WHERE ComID1 = @ComID1E AND DriveNo1 = @DriveNo1E                              END                                                      DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID                                       END                     END          ELSE                      BEGIN 					--SELECT 'CASE NN : ADD'                     INSERT INTO [THP-LDMSNONADDB].DBO.FixedDrives_Revision_V2                     SELECT @Computer_ID , @DriveNo , @Model , @Interface ,@StorageTotal ,@SerialNumber                         , NULL , NULL , NULL , NULL ,'ADD' , GETDATE() , 0 , 1                                     DELETE FROM [THP-LDMSNONADDB].DBO.FixedDrives_TEMP WHERE Computer_Idn = @Computer_ID             END     END",15,77,-62,14542,0,170064497
"(@P1 int,@P2 int,@P3 nchar(10),@P4 int,@P5 nchar(8))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",15,9,6,1022,0,30
"(@1 int,@2 int,@3 int,@4 int)select distinct t.ClientPolicyFile, t.ClientPolicyHash, t.LD_TASK_IDN, t.PolicyHash from LD_TASK t inner join LD_TASK_MACHINE tm on tm.LD_TASK_IDN = t.LD_TASK_IDN where tm.SOURCE_TYPE <> 5 and t.Overrides is not null and t.ClientPolicyHash is not null and t.ClientPolicyHash <> '' and INITIAL_START <= GETDATE() and t.ScopeUser_Idn in (select distinct User_Idn ConsoleUser_Idn from ConsoleUserGroup Where Group_Idn in ( 					select ConsoleUserScope.ConsoleUser_Idn 					from ScopeComputer, ConsoleUserScope, Scope  					where ScopeComputer.Scope_Idn = ConsoleUserScope.Scope_Idn 						AND Scope.Scope_Idn = ScopeComputer.Scope_Idn 						AND Computer_Idn = 8594 					union 						select ConsoleUserScope.ConsoleUser_Idn 						from ConsoleUserScope, Scope 						where Scope.Scope_Idn = ConsoleUserScope.Scope_Idn 							AND Scope.ScopeType = 1 					) 					union 						select ConsoleUserScope.ConsoleUser_Idn 						from ScopeComputer, ConsoleUserScope, Scope 						where ScopeComputer.Scope_Idn = ConsoleUserScope.Scope_Idn 							AND Scope.Scope_Idn = ScopeComputer.Scope_Idn 							AND Computer_Idn = 8594 					union 						select ConsoleUserScope.ConsoleUser_Idn 						from ConsoleUserScope, Scope 						where Scope.Scope_Idn = ConsoleUserScope.Scope_Idn 							AND Scope.ScopeType = 1) and t.TASK_STATUS <> @1 and tm.MAC_STATUS <> @2 and tm.COMPUTER_IDN=@3 and (t.LimitByAllowedMachines = 0 or t.LimitByAllowedMachines is null or t.LD_TASK_IDN in (select LD_TASK_IDN from TaskAllowedMachines where COMPUTER_IDN = @4))",15,1,14,670,0,15
SELECT Barcode FROM Computer WHERE ScanType = 'Vendor Import' or ScanType = 'Barcode' GROUP BY Barcode HAVING COUNT(ScanType) > 1,15,13,2,4362,0,17148027
"(@P1 int,@P2 int,@P3 nchar(11),@P4 int,@P5 nchar(35))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",14,11,3,3555,0,29
"(@P1 int,@P2 int,@P3 nchar(31),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",14,9,5,894,0,29
"(@P1 int,@P2 int,@P3 int,@P4 int,@P5 int,@P6 int)SELECT Product_Idn FROM ProductComputer (nolock) WHERE Computer_Idn = @P1 AND Product_Idn NOT IN (SELECT Product_Idn FROM Product (nolock) WHERE FileMatching = @P2 AND LDMSProduct = @P3 AND DataSourceType = @P4 AND (Action = @P5 OR Action = @P6))",14,83,-69,10924,0,830347
select * from METAATTRIBUTES,14,5,9,235,0,430
"CREATE   PROCEDURE sp_sqlagent_has_server_access   @login_name         sysname = NULL,   @job_id             uniqueidentifier = NULL, -- if this is not null, @login_name will be ignored!   @is_sysadmin_member INT     = NULL OUTPUT AS BEGIN   DECLARE @has_server_access BIT   DECLARE @is_sysadmin       BIT   DECLARE @actual_login_name sysname   -- Set only when login_name is actually found. It will be zero when @actual_login_name is (unknown).   DECLARE @login_found BIT   DECLARE @cachedate         DATETIME    SET NOCOUNT ON    SELECT @cachedate = NULL    -- remove expired entries from the cache   DELETE msdb.dbo.syscachedcredentials   WHERE  DATEDIFF(MINUTE, cachedate, GETDATE()) >= 29    -- query the cache   SELECT  @is_sysadmin = is_sysadmin_member,           @has_server_access = has_server_access,           @cachedate = cachedate   FROM    msdb.dbo.syscachedcredentials   WHERE   login_name = @login_name   AND     DATEDIFF(MINUTE, cachedate, GETDATE()) < 29    IF (@cachedate IS NOT NULL)   BEGIN     -- no output variable     IF (@is_sysadmin_member IS NULL)     BEGIN       -- Return result row       SELECT has_server_access = @has_server_access,              is_sysadmin       = @is_sysadmin,              actual_login_name = @login_name       RETURN     END     ELSE     BEGIN       SELECT @is_sysadmin_member = @is_sysadmin       RETURN     END   END -- select from cache    -- Set defaults   SELECT @has_server_access = 0   SELECT @is_sysadmin = 0   SELECT @actual_login_name = FORMATMESSAGE(14205)   SELECT @login_found = 0      -- If @job_id was set, get the current name associated with the job owner sid.   if (@job_id IS NOT NULL)   BEGIN 	SELECT @login_name = dbo.SQLAGENT_SUSER_SNAME(owner_sid) 	FROM msdb.dbo.sysjobs_view 	WHERE @job_id = job_id      -- If the job_id is invalid, return error     IF (@login_name IS NULL)     BEGIN       RETURN 1;     END    END   IF (@login_name IS NULL)   BEGIN     SELECT has_server_access = 1,            is_sysadmin       = IS_SRVROLEMEMBER(N'sysadmin'),            actual_login_name = SUSER_SNAME()     RETURN   END    IF (@login_name LIKE '%\%')   BEGIN     -- Handle the LocalSystem account ('NT AUTHORITY\SYSTEM') as a special case     IF (UPPER(@login_name collate SQL_Latin1_General_CP1_CS_AS) = N'NT AUTHORITY\SYSTEM')     BEGIN       IF (EXISTS (SELECT *                   FROM master.dbo.syslogins                   WHERE (UPPER(loginname collate SQL_Latin1_General_CP1_CS_AS) = N'NT AUTHORITY\SYSTEM')))       BEGIN         SELECT @has_server_access = hasaccess,                @is_sysadmin = sysadmin,                @actual_login_name = loginname         FROM master.dbo.syslogins         WHERE (UPPER(loginname collate SQL_Latin1_General_CP1_CS_AS) = N'NT AUTHORITY\SYSTEM')          SET @login_found = 1       END       ELSE       IF (EXISTS (SELECT *                   FROM master.dbo.syslogins                   WHERE (UPPER(loginname collate SQL_Latin1_General_CP1_CS_AS) = N'BUILTIN\ADMINISTRATORS')))       BEGIN         SELECT @has_server_access = hasaccess,                @is_sysadmin = sysadmin,                @actual_login_name = loginname         FROM master.dbo.syslogins         WHERE (UPPER(loginname collate SQL_Latin1_General_CP1_CS_AS) = N'BUILTIN\ADMINISTRATORS')          SET @login_found = 1       END     END     ELSE     BEGIN       -- Check if the NT login has been explicitly denied access       IF (EXISTS (SELECT *                   FROM master.dbo.syslogins                   WHERE (loginname = @login_name)                     AND (denylogin = 1)))       BEGIN         SELECT @has_server_access = 0,                @is_sysadmin = sysadmin,                @actual_login_name = loginname         FROM master.dbo.syslogins         WHERE (loginname = @login_name)          SET @login_found = 1       END       ELSE       BEGIN         -- declare table variable for storing results         DECLARE @xp_results TABLE         (         account_name      sysname      COLLATE database_default NOT NULL PRIMARY KEY,         type              NVARCHAR(10) COLLATE database_default NOT NULL,         privilege         NVARCHAR(10) COLLATE database_default NOT NULL,         mapped_login_name sysname      COLLATE database_default NOT NULL,         permission_path   sysname      COLLATE database_default NULL         )          -- Call xp_logininfo to determine server access         INSERT INTO @xp_results         EXECUTE master.dbo.xp_logininfo @login_name          IF (SELECT COUNT(*) FROM @xp_results) > 0         BEGIN           SET @has_server_access = 1           SET @login_found = 1         END          SELECT @actual_login_name = mapped_login_name,                @is_sysadmin = CASE UPPER(privilege collate SQL_Latin1_General_CP1_CS_AS)                                 WHEN 'ADMIN' THEN 1                                 ELSE 0                              END         FROM @xp_results       END     END     -- Only cache the NT logins to approximate the behavior of Sql Server and Windows (see bug 323287)     -- update the cache only if something is found     IF  (UPPER(@actual_login_name collate SQL_Latin1_General_CP1_CS_AS) <> '(UNKNOWN)')     BEGIN       -- Procedure starts its own transaction.       BEGIN TRANSACTION;        -- Modify database.       -- use a try catch login to prevent any error when trying       -- to insert/update syscachedcredentials table       -- no need to fail since the job owner has been validated       BEGIN TRY         IF EXISTS (SELECT * FROM msdb.dbo.syscachedcredentials WITH (TABLOCKX) WHERE login_name = @login_name)         BEGIN           UPDATE msdb.dbo.syscachedcredentials           SET    has_server_access = @has_server_access,                 is_sysadmin_member = @is_sysadmin,                 cachedate = GETDATE()           WHERE  login_name = @login_name         END         ELSE         BEGIN           INSERT INTO msdb.dbo.syscachedcredentials(login_name, has_server_access, is_sysadmin_member)           VALUES(@login_name, @has_server_access, @is_sysadmin)         END         END TRY         BEGIN CATCH             -- If an error occurred we want to ignore it         END CATCH          -- The procedure must commit the transaction it started.         COMMIT TRANSACTION;     END    END   ELSE   BEGIN     -- Standard login     IF (EXISTS (SELECT *                 FROM master.dbo.syslogins                 WHERE (loginname = @login_name)))     BEGIN       SELECT @has_server_access = hasaccess,              @is_sysadmin = sysadmin,              @actual_login_name = loginname       FROM master.dbo.syslogins       WHERE (loginname = @login_name)        SET @login_found = 1     END   END    IF (@is_sysadmin_member IS NULL)     -- Return result row     SELECT has_server_access = @has_server_access,            is_sysadmin       = @is_sysadmin,            actual_login_name = @actual_login_name,            login_found       = @login_found   ELSE     -- output variable only     SELECT @is_sysadmin_member = @is_sysadmin END ",14,12,2,169,0,6427
" CREATE FUNCTION .[dbo].[GetTHDepartment] ( 	@UserName	NVARCHAR(128)	 )  RETURNS NVARCHAR(128) AS   BEGIN 	 	DECLARE @THDepartment NVARCHAR(128)  	SELECT  @THDepartment = Department 	FROM	[10.252.71.113].HEATSM.DBO.EMPLOYEE 	WHERE	LoginID = @USERNAME AND Status = 'ACTIVE'  	RETURN @THDepartment  END ",14,13,1,2,0,28
"(@1 nvarchar(16),@2 nvarchar(5))SELECT DISTINCT A0.DISPLAYNAME, A2.ADDRESS, A0.LOGINNAME, A3.STATE, A4.VERSION, A0.HWMONITORINGTYPE, A5.OSTYPE, A5.LASTSTARTUPTIME, A0.COMPUTER_IDN, A6.OID, A4.VERSION, A7.INSTALLED, A7.HTMLACCESS, A8.RTINVENTORY, A0.DEVICEID  FROM Computer A0 (nolock) LEFT OUTER JOIN ScopeComputer A1 (nolock) ON A0.Computer_Idn = A1.Computer_Idn LEFT OUTER JOIN TCP A2 (nolock) ON A0.Computer_Idn = A2.Computer_Idn LEFT OUTER JOIN AlertHealth A3 (nolock) ON A0.Computer_Idn = A3.Computer_Idn LEFT OUTER JOIN Scanner A4 (nolock) ON A0.Computer_Idn = A4.Computer_Idn LEFT OUTER JOIN Operating_System A5 (nolock) ON A0.Computer_Idn = A5.Computer_Idn LEFT OUTER JOIN DSViewClient A6 (nolock) ON A0.Computer_Idn = A6.Computer_Idn LEFT OUTER JOIN WUserAgent A7 (nolock) ON A0.Computer_Idn = A7.Computer_Idn LEFT OUTER JOIN LanDesk A8 (nolock) ON A0.Computer_Idn = A8.Computer_Idn  WHERE ((A0.Computer_Idn NOT IN (SELECT Computer_Idn FROM Computer WHERE SCANTYPE=@1) AND A0.Computer_Idn NOT IN (SELECT Computer_Idn FROM Computer WHERE HWMONITORINGTYPE=@2)) AND A1.SCOPE_IDN IN (233, 1, 218))   ORDER BY  A0.DISPLAYNAME asc",14,12,2,9685,0,14
"(@P1 int,@P2 int,@P3 nchar(11),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",14,10,4,2613,0,168
"(@P1 int,@P2 int,@P3 nchar(17),@P4 int,@P5 nchar(5))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",14,10,4,2376,0,28
"(@P1 int,@P2 int,@P3 nchar(19),@P4 int,@P5 nchar(32),@P6 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash = @P5 AND a.Version = @P6",13,10,3,950,0,27
"(@P1 int,@P2 int,@P3 nchar(22),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",13,8,5,858,0,27
"(@P1 int,@P2 int,@P3 nchar(8),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",13,10,3,2907,0,162
"(@P1 int,@P2 int,@P3 nchar(14),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",13,10,3,2256,0,26
"(@P1 int,@P2 int,@P3 nchar(18),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",13,10,3,2490,0,79
"(@P1 int,@P2 int,@P3 nchar(13),@P4 int,@P5 nchar(6))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",12,11,1,4706,0,25
"  CREATE FUNCTION .[dbo].[GetEngDepartment] ( 	@UserName	NVARCHAR(128)	 )  RETURNS NVARCHAR(128) AS   BEGIN 	 	DECLARE @EngDepartment NVARCHAR(128)  	SELECT	@EngDepartment = EngDepartment 	FROM	[THP-LDMSDB].[dbo].Department 	WHERE	ThDepartment =	( 								SELECT  TOP 10 Department 								FROM	[10.252.71.113].HEATSM.DBO.EMPLOYEE 								WHERE	LoginID = @USERNAME AND Status = 'ACTIVE' 							) 	RETURN @EngDepartment  END  ",12,10,2,7,0,3649
"-- ============================================= -- Author:		< Busisoft > -- Create date: < Wed 22 July 2020 > -- Description:	< Add New Device > -- ============================================= CREATE TRIGGER NewDeviceAdd    ON   [THP-LDMSDB].DBO.FixedDrives    AFTER INSERT AS  BEGIN 	-- SET NOCOUNT ON added to prevent extra result sets from 	-- interfering with SELECT statements. 	SET NOCOUNT ON;      INSERT INTO FixedDrives_Revision_V2 	SELECT [Computer_Idn] 		  ,[DriveNo] 		  ,[Model] 		  ,[Interface] 		  ,[StorageTotal] 		  ,[SerialNumber] 		  ,[OldModel] = NULL 		  ,[OldInterface] = NULL 		  ,[OldStorageTotal] = NULL 		  ,[OldSerialNumber] = NULL 		  ,[Status] = NULL 		  ,[UpdateTime] = GETDATE() 		  ,[Revision] = 0 		  ,[Active] = 1 	FROM [dbo].[FixedDrives] 	WHERE Interface <> 'USB' AND Computer_Idn NOT IN ( SELECT Computer_Idn FROM FixedDrives_Revision_V2 )  END ",12,12,0,1370,0,3426
"(@P1 int,@P2 int,@P3 nchar(12),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",12,10,2,3328,0,355
"(@P1 int,@P2 int,@P3 nchar(11),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",12,10,2,2839,0,125
"(@P1 int,@P2 int,@P3 nchar(9),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",12,10,2,898,0,24
"(@P1 int,@P2 int,@P3 nchar(25),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",12,8,4,1133,0,24
"(@P1 int,@P2 int,@P3 nchar(12),@P4 int,@P5 nchar(32),@P6 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash = @P5 AND a.Version = @P6",12,9,3,1801,0,123
"(@P1 int,@P2 int,@P3 nchar(11),@P4 int,@P5 nchar(4))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",12,9,3,1858,0,73
" ------------------------------- xp_logininfo ----------------------------------  create procedure sys.xp_logininfo 	@acctname		sysname = null,				-- IN: NT login name 	@option			varchar(10) = null,			-- IN: 'all' | 'members' | null 	@privilege		varchar(10) = 'Not wanted' OUTPUT	-- OUT: 'admin' | 'user' | null as 	set nocount on  	declare @ret		int  	-- VALIDATE PARAMETERS -- 	if (@acctname is null AND (@option is not null OR (@privilege is null OR @privilege <> 'Not wanted'))) 		OR ((@option is null OR @option <> 'all') AND (@privilege is null OR @privilege <> 'Not wanted')) 		OR (@option is not null and @option not in ('all', 'members')) 	begin         raiserror(15600,-1,-1,'sys.xp_logininfo')         return 1 	end   	-- HANDLE case where NO @acctname GIVEN -- 	if (@acctname is null) 	begin 		select	'account name' = loginname, 				'type' = convert(varchar(8), case when isntuser = 1 then 'user' else 'group' end), 				'privilege' = convert(varchar(8), case when sysadmin = 1 then 'admin' else 'user' end), 				'mapped login name' = loginname, 				'permission path' = convert(sysname, null) 		from master..syslogins where isntname = 1 and hasaccess = 1 		order by 3, 1 		return @@error 	end  	-- HANDLE 'members' QUERY -- 	if (@option = 'members') 	begin 		declare @priv varchar(8) 		select @priv = case when sysadmin = 1 then 'admin' else 'user' end 			from master..syslogins where isntname = 1 and loginname = @acctname and hasaccess = 1 		if @priv is not null 			select	'account name' = domain+N'\'+name, 					'type' = convert(varchar(8), case when sidtype = 1 then 'user' else 'group' end), 					'privilege' = @priv, 					'mapped login name' = domain+N'\'+name, 					'permission path' = @acctname 			from OpenRowset(TABLE NETGROUPGETMEMBERS, @acctname) order by 3, 1 		else 			select	'account name' = convert(sysname, null), 					'type' = convert(varchar(8), null), 					'privilege' = @priv, 					'mapped login name' = convert(sysname, null), 					'permission path' = convert(sysname, null) 			where 0=1	-- empty result set 		return @@error 	end   	-- CREATE TEMP TABLE AND POPULATE WITH THE REQUIRED DATA -- 	CREATE TABLE #nt (name sysname collate catalog_default, sid varbinary(85), sidtype int) 	insert #nt select loginname, sid, isntgroup + 1 from master..syslogins 			where isntname = 1 and loginname = @acctname 	insert #nt select distinct domain+N'\'+name, sid, sidtype 			from OpenRowset(TABLE NETUSERGETGROUPS, @acctname) 	select @ret = @@error 	if @ret <> 0 		return @ret 	-- IF ANY DENY, THEN NO ACCESS -- 	if exists (select * from master..syslogins where sid in (select #nt.sid from #nt) and denylogin = 1) 		delete #nt   	-- HANDLE case where OUTPUT REQUESTED -- 	if (@privilege is null OR @privilege <> 'Not wanted') 	begin 		select @privilege = case max(sysadmin) 			when 1 then 'admin' 			when 0 then 'user' 			else NULL end 		from master..syslogins where isntname = 1 and hasaccess = 1 			AND sid in (select sid from #nt) 		return @@error 	end   	-- GET NT TYPE FOR NEXT OPTIONS -- 	declare @type varchar(8) 	select @type = case when get_sid('\U'+@acctname) is null then 'group' else 'user' end  	-- HANDLE 'all' QUERY -- 	if (@option = 'all') 	begin 		select	'account name' = @acctname, 				'type' = @type, 				'privilege' = convert(varchar(8), case when sysadmin = 1 then 'admin' else 'user' end), 				'mapped login name' = @acctname, 				'permission path' = case when l.loginname = @acctname then NULL else l.loginname end 		from master..syslogins l join #nt n on l.isntname = 1 and l.sid = n.sid 		where l.loginname = n.name and hasaccess = 1 		order by 3, 5 		return @@error 	end   	-- HANDLE DEFAULT QUERY -- 	select	TOP 1 			'account name' = @acctname, 			'type' = @type, 			'privilege' = convert(varchar(8), case when sysadmin = 1 then 'admin' else 'user' end), 			'mapped login name' = @acctname, 			'permission path' = case when l.loginname = @acctname then NULL else l.loginname end 	from master..syslogins l join #nt n on l.isntname = 1 and l.sid = n.sid 	where l.loginname = n.name and hasaccess = 1 	order by 3, 5 	return @@error ",12,10,2,12,0,5407
"(@P1 int,@P2 int,@P3 nchar(13),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",11,9,2,862,0,23
"(@P1 int,@P2 int,@P3 nchar(12),@P4 int,@P5 nchar(5))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",11,8,3,919,0,23
SELECT Barcode FROM Computer WHERE ScanType = 'Vendor Import' or ScanType = 'Barcode' GROUP BY Barcode HAVING COUNT(ScanType) > 1,11,10,1,3119,0,532898
"(@P1 int,@P2 int,@P3 nchar(38),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",11,8,3,1279,0,22
"(@P1 int,@P2 int,@P3 nchar(8),@P4 int,@P5 nchar(3))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",11,10,1,2245,0,45
"(@P1 int,@P2 int,@P3 nchar(9),@P4 int,@P5 nchar(3))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",11,8,3,1269,0,44
"(@P1 int,@P2 int,@P3 nchar(13),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",11,9,2,2863,0,44
"(@P1 int,@P2 int,@P3 nchar(17),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,8,2,1777,0,43
"(@P1 int,@P2 int,@P3 nchar(14),@P4 int,@P5 nchar(8))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,8,2,841,0,87
"(@P1 int,@P2 int,@P3 nchar(17),@P4 int,@P5 nchar(1))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,10,0,993,0,65
"(@P1 int,@P2 int,@P3 nchar(15),@P4 int,@P5 nchar(3))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,9,1,2168,0,21
"(@P1 int,@P2 int,@P3 nchar(7),@P4 int,@P5 nchar(6))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,10,0,3043,0,21
"(@P1 int,@P2 int,@P3 nchar(20),@P4 int,@P5 nchar(38))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,9,1,1800,0,63
"(@P1 int,@P2 int,@P3 nchar(9),@P4 int,@P5 nchar(9))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,8,2,919,0,21
"(@P1 int,@P2 int,@P3 nchar(9),@P4 int,@P5 nchar(7))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,10,0,1642,0,21
"(@P1 int,@P2 int,@P3 nchar(13),@P4 int,@P5 nchar(3))SELECT a.*, 0 as product_Idn, 0 as DataSourceType, 0 as FileMatching FROM FileInfo a (nolock) LEFT OUTER JOIN productfile b (nolock) on a.fileinfo_idn = b.fileinfo_idn and IsMainExe = @P1 LEFT OUTER JOIN product c (nolock) on c.product_idn = b.product_idn and c.DataSourceType = @P2 WHERE a.FileName = @P3 AND a.FileSize = @P4 AND a.MD5Hash IS NULL AND a.Version = @P5",10,9,1,2305,0,20
"  CREATE FUNCTION .[dbo].[GetEngDepartment] ( 	@UserName	NVARCHAR(128)	 )  RETURNS NVARCHAR(128) AS   BEGIN 	 	DECLARE @EngDepartment NVARCHAR(128)  	SELECT	@EngDepartment = EngDepartment 	FROM	[THP-LDMSDB].[dbo].Department 	WHERE	ThDepartment =	( 								SELECT  Department 								FROM	[10.252.71.113].HEATSM.DBO.EMPLOYEE 								WHERE	LoginID = @USERNAME AND Status = 'ACTIVE' 							) 	RETURN @EngDepartment  END  ",10,9,1,7,0,20
